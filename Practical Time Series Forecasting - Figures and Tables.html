<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Practical Time Series Forecasting - Figures and Tables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/clipboard/clipboard.min.js"></script>
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/quarto-html/quarto.js"></script>
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/quarto-html/popper.min.js"></script>
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/quarto-html/anchor.min.js"></script>
<link href="Practical Time Series Forecasting - Figures and Tables_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Practical Time Series Forecasting - Figures and Tables_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Practical Time Series Forecasting - Figures and Tables_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Practical Time Series Forecasting - Figures and Tables_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="Practical Time Series Forecasting - Figures and Tables_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="Practical Time Series Forecasting - Figures and Tables_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="Practical Time Series Forecasting - Figures and Tables_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#chapter-2---time-series-date" id="toc-chapter-2---time-series-date" class="nav-link" data-scroll-target="#chapter-2---time-series-date">Chapter 2 - Time Series Date</a>
  <ul class="collapse">
  <li><a href="#visualizing-time-series" id="toc-visualizing-time-series" class="nav-link" data-scroll-target="#visualizing-time-series">2.3 Visualizing Time Series</a>
  <ul class="collapse">
  <li><a href="#figure-2.2" id="toc-figure-2.2" class="nav-link" data-scroll-target="#figure-2.2">Figure 2.2</a></li>
  <li><a href="#figure-2.4" id="toc-figure-2.4" class="nav-link" data-scroll-target="#figure-2.4">Figure 2.4</a></li>
  </ul></li>
  <li><a href="#interactive-data-visualizations" id="toc-interactive-data-visualizations" class="nav-link" data-scroll-target="#interactive-data-visualizations">Interactive Data Visualizations</a></li>
  <li><a href="#interactive-visualization-with-plotly" id="toc-interactive-visualization-with-plotly" class="nav-link" data-scroll-target="#interactive-visualization-with-plotly">Interactive Visualization with Plotly</a>
  <ul class="collapse">
  <li><a href="#baregg-tunnel-traffic" id="toc-baregg-tunnel-traffic" class="nav-link" data-scroll-target="#baregg-tunnel-traffic">Baregg Tunnel Traffic</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#chapter-3---performance-evaluation" id="toc-chapter-3---performance-evaluation" class="nav-link" data-scroll-target="#chapter-3---performance-evaluation">Chapter 3 - Performance Evaluation</a>
  <ul class="collapse">
  <li><a href="#data-partitioning" id="toc-data-partitioning" class="nav-link" data-scroll-target="#data-partitioning">3.1 Data Partitioning</a>
  <ul class="collapse">
  <li><a href="#figure-3.1" id="toc-figure-3.1" class="nav-link" data-scroll-target="#figure-3.1">Figure 3.1</a></li>
  <li><a href="#updated-figure-3.1" id="toc-updated-figure-3.1" class="nav-link" data-scroll-target="#updated-figure-3.1">Updated Figure 3.1</a></li>
  <li><a href="#figure-3.2" id="toc-figure-3.2" class="nav-link" data-scroll-target="#figure-3.2">Figure 3.2</a></li>
  <li><a href="#updated-figure-3.2" id="toc-updated-figure-3.2" class="nav-link" data-scroll-target="#updated-figure-3.2">Updated Figure 3.2</a></li>
  </ul></li>
  <li><a href="#measuring-predictive-accuracy" id="toc-measuring-predictive-accuracy" class="nav-link" data-scroll-target="#measuring-predictive-accuracy">3.3 Measuring Predictive Accuracy</a>
  <ul class="collapse">
  <li><a href="#table-3.1" id="toc-table-3.1" class="nav-link" data-scroll-target="#table-3.1">Table 3.1</a></li>
  <li><a href="#updated-table-3.1" id="toc-updated-table-3.1" class="nav-link" data-scroll-target="#updated-table-3.1">Updated Table 3.1</a></li>
  <li><a href="#figure-3.3" id="toc-figure-3.3" class="nav-link" data-scroll-target="#figure-3.3">Figure 3.3</a></li>
  <li><a href="#figure-3.4" id="toc-figure-3.4" class="nav-link" data-scroll-target="#figure-3.4">Figure 3.4</a></li>
  <li><a href="#updated-figures-3.3-3.4" id="toc-updated-figures-3.3-3.4" class="nav-link" data-scroll-target="#updated-figures-3.3-3.4">Updated Figures 3.3 &amp; 3.4</a></li>
  <li><a href="#figure-3.5" id="toc-figure-3.5" class="nav-link" data-scroll-target="#figure-3.5">Figure 3.5</a></li>
  <li><a href="#updated-figure-3.5" id="toc-updated-figure-3.5" class="nav-link" data-scroll-target="#updated-figure-3.5">Updated Figure 3.5</a></li>
  </ul></li>
  <li><a href="#advanced-data-partitioning-roll-forward-validation" id="toc-advanced-data-partitioning-roll-forward-validation" class="nav-link" data-scroll-target="#advanced-data-partitioning-roll-forward-validation">3.5 Advanced Data Partitioning: Roll-Forward Validation</a>
  <ul class="collapse">
  <li><a href="#figure-3.6" id="toc-figure-3.6" class="nav-link" data-scroll-target="#figure-3.6">Figure 3.6</a></li>
  <li><a href="#updated-figure-3.6" id="toc-updated-figure-3.6" class="nav-link" data-scroll-target="#updated-figure-3.6">Updated Figure 3.6</a></li>
  <li><a href="#figure-3.7" id="toc-figure-3.7" class="nav-link" data-scroll-target="#figure-3.7">Figure 3.7</a></li>
  <li><a href="#updated-figure-3.7" id="toc-updated-figure-3.7" class="nav-link" data-scroll-target="#updated-figure-3.7">Updated Figure 3.7</a></li>
  <li><a href="#table-3.3" id="toc-table-3.3" class="nav-link" data-scroll-target="#table-3.3">Table 3.3</a></li>
  <li><a href="#updated-table-3.3" id="toc-updated-table-3.3" class="nav-link" data-scroll-target="#updated-table-3.3">Updated Table 3.3</a></li>
  <li><a href="#table-3.4" id="toc-table-3.4" class="nav-link" data-scroll-target="#table-3.4">Table 3.4</a></li>
  <li><a href="#table-3.5" id="toc-table-3.5" class="nav-link" data-scroll-target="#table-3.5">Table 3.5</a></li>
  <li><a href="#table-3.5-1" id="toc-table-3.5-1" class="nav-link" data-scroll-target="#table-3.5-1">Table 3.5</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#chapter-5---smoothing-methods" id="toc-chapter-5---smoothing-methods" class="nav-link" data-scroll-target="#chapter-5---smoothing-methods">Chapter 5 - Smoothing Methods</a>
  <ul class="collapse">
  <li><a href="#moving-average" id="toc-moving-average" class="nav-link" data-scroll-target="#moving-average">5.2 Moving Average</a>
  <ul class="collapse">
  <li><a href="#amtrak-fig-5-2.r" id="toc-amtrak-fig-5-2.r" class="nav-link" data-scroll-target="#amtrak-fig-5-2.r">Amtrak Fig 5-2.R</a></li>
  </ul></li>
  <li><a href="#amtrak-fig-5-3.r" id="toc-amtrak-fig-5-3.r" class="nav-link" data-scroll-target="#amtrak-fig-5-3.r">Amtrak Fig 5-3.R</a></li>
  <li><a href="#differencing" id="toc-differencing" class="nav-link" data-scroll-target="#differencing">5.3 Differencing</a>
  <ul class="collapse">
  <li><a href="#amtrak-fig-5-4.r" id="toc-amtrak-fig-5-4.r" class="nav-link" data-scroll-target="#amtrak-fig-5-4.r">Amtrak Fig 5-4.R</a></li>
  </ul></li>
  <li><a href="#advance-exponential-smoothing" id="toc-advance-exponential-smoothing" class="nav-link" data-scroll-target="#advance-exponential-smoothing">5.5 Advance Exponential Smoothing</a>
  <ul class="collapse">
  <li><a href="#amtrak-fig-5-5" id="toc-amtrak-fig-5-5" class="nav-link" data-scroll-target="#amtrak-fig-5-5">Amtrak Fig 5-5</a></li>
  <li><a href="#table-5.1" id="toc-table-5.1" class="nav-link" data-scroll-target="#table-5.1">Table 5.1</a></li>
  <li><a href="#figure-5.6" id="toc-figure-5.6" class="nav-link" data-scroll-target="#figure-5.6">Figure 5.6</a></li>
  <li><a href="#table-5.2" id="toc-table-5.2" class="nav-link" data-scroll-target="#table-5.2">Table 5.2</a></li>
  </ul></li>
  <li><a href="#summary-of-exponential-smoothing-in-r-using-ets" id="toc-summary-of-exponential-smoothing-in-r-using-ets" class="nav-link" data-scroll-target="#summary-of-exponential-smoothing-in-r-using-ets">5.6 Summary of Exponential Smoothing in R using <code>ets</code></a>
  <ul class="collapse">
  <li><a href="#automatic-model-selection-in-ets" id="toc-automatic-model-selection-in-ets" class="nav-link" data-scroll-target="#automatic-model-selection-in-ets">Automatic Model Selection in <code>ets</code></a></li>
  <li><a href="#table-5.4" id="toc-table-5.4" class="nav-link" data-scroll-target="#table-5.4">Table 5.4</a></li>
  <li><a href="#table-5.5" id="toc-table-5.5" class="nav-link" data-scroll-target="#table-5.5">Table 5.5</a></li>
  </ul></li>
  <li><a href="#extensions-of-exponential-smoothing" id="toc-extensions-of-exponential-smoothing" class="nav-link" data-scroll-target="#extensions-of-exponential-smoothing">5.7 Extensions of Exponential Smoothing</a>
  <ul class="collapse">
  <li><a href="#figure-5.7" id="toc-figure-5.7" class="nav-link" data-scroll-target="#figure-5.7">Figure 5.7</a></li>
  <li><a href="#figure-5.8" id="toc-figure-5.8" class="nav-link" data-scroll-target="#figure-5.8">Figure 5.8</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#chapter-6---regression-based-models-capturing-trend-and-seasonality" id="toc-chapter-6---regression-based-models-capturing-trend-and-seasonality" class="nav-link" data-scroll-target="#chapter-6---regression-based-models-capturing-trend-and-seasonality">Chapter 6 - Regression-Based Models: Capturing Trend and Seasonality</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#model-with-trend" id="toc-model-with-trend" class="nav-link" data-scroll-target="#model-with-trend">6.1 Model with Trend</a>
  <ul class="collapse">
  <li><a href="#figure-6.2" id="toc-figure-6.2" class="nav-link" data-scroll-target="#figure-6.2">Figure 6.2</a></li>
  <li><a href="#figure-6.3" id="toc-figure-6.3" class="nav-link" data-scroll-target="#figure-6.3">Figure 6.3</a></li>
  <li><a href="#table-6.1" id="toc-table-6.1" class="nav-link" data-scroll-target="#table-6.1">Table 6.1</a></li>
  <li><a href="#figure-6.4" id="toc-figure-6.4" class="nav-link" data-scroll-target="#figure-6.4">Figure 6.4</a></li>
  <li><a href="#table-6.2" id="toc-table-6.2" class="nav-link" data-scroll-target="#table-6.2">Table 6.2</a></li>
  </ul></li>
  <li><a href="#model-with-seasonality" id="toc-model-with-seasonality" class="nav-link" data-scroll-target="#model-with-seasonality">6.2 Model with Seasonality</a>
  <ul class="collapse">
  <li><a href="#table-6.3" id="toc-table-6.3" class="nav-link" data-scroll-target="#table-6.3">Table 6.3</a></li>
  <li><a href="#figure-6.6" id="toc-figure-6.6" class="nav-link" data-scroll-target="#figure-6.6">Figure 6.6</a></li>
  </ul></li>
  <li><a href="#model-with-trend-and-seasonality" id="toc-model-with-trend-and-seasonality" class="nav-link" data-scroll-target="#model-with-trend-and-seasonality">6.3 Model with Trend and Seasonality</a>
  <ul class="collapse">
  <li><a href="#table-6.4" id="toc-table-6.4" class="nav-link" data-scroll-target="#table-6.4">Table 6.4</a></li>
  <li><a href="#figure-6.7" id="toc-figure-6.7" class="nav-link" data-scroll-target="#figure-6.7">Figure 6.7</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#chapter-7---regression-based-models-autocorrelation-external-information" id="toc-chapter-7---regression-based-models-autocorrelation-external-information" class="nav-link" data-scroll-target="#chapter-7---regression-based-models-autocorrelation-external-information">Chapter 7 - Regression-Based Models: Autocorrelation &amp; External Information</a>
  <ul class="collapse">
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#autocorrelation" id="toc-autocorrelation" class="nav-link" data-scroll-target="#autocorrelation">7.1 Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#figure-7.2" id="toc-figure-7.2" class="nav-link" data-scroll-target="#figure-7.2">Figure 7.2</a></li>
  <li><a href="#figure-7.3" id="toc-figure-7.3" class="nav-link" data-scroll-target="#figure-7.3">Figure 7.3</a></li>
  </ul></li>
  <li><a href="#improving-forecasts-by-capturing-autocorrelation-ar-and-arima-models" id="toc-improving-forecasts-by-capturing-autocorrelation-ar-and-arima-models" class="nav-link" data-scroll-target="#improving-forecasts-by-capturing-autocorrelation-ar-and-arima-models">7.2 Improving Forecasts by Capturing Autocorrelation: AR and ARIMA Models</a>
  <ul class="collapse">
  <li><a href="#figure-7.4" id="toc-figure-7.4" class="nav-link" data-scroll-target="#figure-7.4">Figure 7.4</a></li>
  <li><a href="#figure-7.5" id="toc-figure-7.5" class="nav-link" data-scroll-target="#figure-7.5">Figure 7.5</a></li>
  <li><a href="#table-7.2" id="toc-table-7.2" class="nav-link" data-scroll-target="#table-7.2">Table 7.2</a></li>
  <li><a href="#figure-7.6" id="toc-figure-7.6" class="nav-link" data-scroll-target="#figure-7.6">Figure 7.6</a></li>
  <li><a href="#walmart-store-data" id="toc-walmart-store-data" class="nav-link" data-scroll-target="#walmart-store-data">Walmart Store Data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#chapter-8---forecasting-binary-outcomes" id="toc-chapter-8---forecasting-binary-outcomes" class="nav-link" data-scroll-target="#chapter-8---forecasting-binary-outcomes">Chapter 8 - Forecasting Binary Outcomes</a>
  <ul class="collapse">
  <li><a href="#example-rainfall-in-melbourne-australia" id="toc-example-rainfall-in-melbourne-australia" class="nav-link" data-scroll-target="#example-rainfall-in-melbourne-australia">8.4 Example: Rainfall in Melbourne, Australia</a>
  <ul class="collapse">
  <li><a href="#figure-8.1" id="toc-figure-8.1" class="nav-link" data-scroll-target="#figure-8.1">Figure 8.1</a></li>
  <li><a href="#table-8.1" id="toc-table-8.1" class="nav-link" data-scroll-target="#table-8.1">Table 8.1</a></li>
  <li><a href="#table-8.2" id="toc-table-8.2" class="nav-link" data-scroll-target="#table-8.2">Table 8.2</a></li>
  <li><a href="#table-8.3" id="toc-table-8.3" class="nav-link" data-scroll-target="#table-8.3">Table 8.3</a></li>
  </ul></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"></a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practical Time Series Forecasting - Figures and Tables</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This document is a compilation of the of Figures and Tables presented in <strong><em>Practical Time Series With R - A Hands On Guide</em></strong> [2nd edition] by Shmueli, Galit; Lichtendahl Jr, Kenneth. Axelrod Schnall Publishers. Kindle Edition. C. The <a href="https://www.forecastingbook.com/resources/data-and-code">Datasets &amp; R Code</a> supplied with textbook website (with slight tweaks) is presented here to match the textbook as baseline for experimenting with code provided.</p>
<p>Much has changed with both R and the time series frameworks since the book was originally published, so updated R code is also provided to demonstrate alternative, more modern techniques.</p>
<p>Reference: <a href="https://otexts.com/fpp3/">Forecasting: Principles and Practice</a> (<em>Rob J Hyndman and George Athanasopoulos</em>)<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load fpp3 after forecast to prevent masking fabletools::accuracy()</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="chapter-2---time-series-date" class="level1">
<h1>Chapter 2 - Time Series Date</h1>
<section id="visualizing-time-series" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-time-series">2.3 Visualizing Time Series</h2>
<section id="figure-2.2" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.2">Figure 2.2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>amtrak_csv <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Amtrak data.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Amtrak.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(amtrak_csv)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ridership.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Amtrak.data<span class="sc">$</span>Ridership, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2004</span>, <span class="dv">3</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 2-2</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridership.ts, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2300</span>), <span class="at">bty =</span> <span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="update" class="level4">
<h4 class="anchored" data-anchor-id="update">Update</h4>
<p>See [<a href="https://otexts.com/fpp3/">Forecasting: Principles and Practice</a>] https://otexts.com/fpp3/tsibbles.html</p>
<p>We need to reprocess the data. The CSV provided by text website has malformed dates, but there is an <code>.xls</code> file we can use instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ridership <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Amtrak data.xls"</span>), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"numeric"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">yearmonth</span>(Month)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ridership <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Ridership)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Although not called for in the textbook, we can also use <code>seasonal</code> plot to help identify months with peak ridership and confirm a general upward trend in the later years contained in the dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ridership <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(Ridership, <span class="at">labels =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Seasonal plot of Amtrak Ridership"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also look at subseries to see if trends are consistent within each month.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ridership <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(Ridership) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Amtrak Ridership Trends by Month'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="figure-2.4" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.4">Figure 2.4</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Amtrak.data &lt;- read.csv("Amtrak data.csv")</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>ridership.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Amtrak.data<span class="sc">$</span>Ridership, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2004</span>, <span class="dv">3</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>ridership.lm <span class="ot">&lt;-</span> <span class="fu">tslm</span>(ridership.ts <span class="sc">~</span> trend <span class="sc">+</span> <span class="fu">I</span>(trend<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 2-4</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridership.ts, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2300</span>), <span class="at">bty =</span> <span class="st">"l"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ridership.lm<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>ridership.ts.zoom <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1997</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">12</span>))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridership.ts.zoom, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2300</span>), <span class="at">bty =</span> <span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="update-1" class="level4">
<h4 class="anchored" data-anchor-id="update-1">Update</h4>
<p>We’ll leave these as two separate plots, including the trend model on both:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fable)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ridership_lm <span class="ot">&lt;-</span> ridership <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">tslm =</span> <span class="fu">TSLM</span>(Ridership <span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">trend</span>()<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>() </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>ridership_lm <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Ridership, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Zoom into the years 1997-2001</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ridership_lm <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Month <span class="sc">&gt;=</span> <span class="fu">yearmonth</span>(<span class="st">'1997 Jan'</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>         Month <span class="sc">&lt;=</span> <span class="fu">yearmonth</span>(<span class="st">'2001 Dec'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Ridership, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Same as above using the <code>filter_index</code> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ridership_lm <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">'1997 Jan'</span> <span class="sc">~</span> <span class="st">'2001 Dec'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Ridership, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="interactive-data-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="interactive-data-visualizations">Interactive Data Visualizations</h2>
</section>
<section id="interactive-visualization-with-plotly" class="level2">
<h2 class="anchored" data-anchor-id="interactive-visualization-with-plotly">Interactive Visualization with Plotly</h2>
<p>Athought the textbook suggest proprietry programs for interactive data visualizations, there are multiple open source frameworks for this as well. A popular R library is plotly, which can be used to interactively interrogate plots as demonstrated below.</p>
<section id="baregg-tunnel-traffic" class="level3">
<h3 class="anchored" data-anchor-id="baregg-tunnel-traffic">Baregg Tunnel Traffic</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>TunnelTraffic <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"TunnelTraffic.xls"</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"numeric"</span>))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>tt_raw_plt <span class="ot">&lt;-</span> TunnelTraffic <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Day, <span class="st">`</span><span class="at"># Vehicles in tunnel</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">'dark blue'</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(tt_raw_plt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-dc57c014c1eb4ff0c9b5" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-dc57c014c1eb4ff0c9b5">{"x":{"data":[{"x":[1067644800,1067731200,1067817600,1067904000,1067990400,1068076800,1068163200,1068249600,1068336000,1068422400,1068508800,1068595200,1068681600,1068768000,1068854400,1068940800,1069027200,1069113600,1069200000,1069286400,1069372800,1069459200,1069545600,1069632000,1069718400,1069804800,1069891200,1069977600,1070064000,1070150400,1070236800,1070323200,1070409600,1070496000,1070582400,1070668800,1070755200,1070841600,1070928000,1071014400,1071100800,1071187200,1071273600,1071360000,1071446400,1071532800,1071619200,1071705600,1071792000,1071878400,1071964800,1072051200,1072137600,1072224000,1072310400,1072396800,1072483200,1072569600,1072656000,1072742400,1072828800,1072915200,1073001600,1073088000,1073174400,1073260800,1073347200,1073433600,1073520000,1073606400,1073692800,1073779200,1073865600,1073952000,1074038400,1074124800,1074211200,1074297600,1074384000,1074470400,1074556800,1074643200,1074729600,1074816000,1074902400,1074988800,1075075200,1075161600,1075248000,1075334400,1075420800,1075507200,1075593600,1075680000,1075766400,1075852800,1075939200,1076025600,1076112000,1076198400,1076284800,1076371200,1076457600,1076544000,1076630400,1076716800,1076803200,1076889600,1076976000,1077062400,1077148800,1077235200,1077321600,1077408000,1077494400,1077580800,1077667200,1077753600,1077840000,1077926400,1078012800,1078099200,1078185600,1078272000,1078358400,1078444800,1078531200,1078617600,1078704000,1078790400,1078876800,1078963200,1079049600,1079136000,1079222400,1079308800,1079395200,1079481600,1079568000,1079654400,1079740800,1079827200,1079913600,1080000000,1080086400,1080172800,1080259200,1080345600,1080432000,1080518400,1080604800,1080691200,1080777600,1080864000,1080950400,1081036800,1081123200,1081209600,1081296000,1081382400,1081468800,1081555200,1081641600,1081728000,1081814400,1081900800,1081987200,1082073600,1082160000,1082246400,1082332800,1082419200,1082505600,1082592000,1082678400,1082764800,1082851200,1082937600,1083024000,1083110400,1083196800,1083283200,1083369600,1083456000,1083542400,1083628800,1083715200,1083801600,1083888000,1083974400,1084060800,1084147200,1084233600,1084320000,1084406400,1084492800,1084579200,1084665600,1084752000,1084838400,1084924800,1085011200,1085097600,1085184000,1085270400,1085356800,1085443200,1085529600,1085616000,1085702400,1085788800,1085875200,1085961600,1086048000,1086134400,1086220800,1086307200,1086393600,1086480000,1086566400,1086652800,1086739200,1086825600,1086912000,1086998400,1087084800,1087171200,1087257600,1087344000,1087430400,1087516800,1087603200,1087689600,1087776000,1087862400,1087948800,1088035200,1088121600,1088208000,1088294400,1088380800,1088467200,1088553600,1088640000,1088726400,1088812800,1088899200,1088985600,1089072000,1089158400,1089244800,1089331200,1089417600,1089504000,1089590400,1089676800,1089763200,1089849600,1089936000,1090022400,1090108800,1090195200,1090281600,1090368000,1090454400,1090540800,1090627200,1090713600,1090800000,1090886400,1090972800,1091059200,1091145600,1091232000,1091318400,1091404800,1091491200,1091577600,1091664000,1091750400,1091836800,1091923200,1092009600,1092096000,1092182400,1092268800,1092355200,1092441600,1092528000,1092614400,1092700800,1092787200,1092873600,1092960000,1093046400,1093132800,1093219200,1093305600,1093392000,1093478400,1093564800,1093651200,1093737600,1093824000,1093910400,1093996800,1094083200,1094169600,1094256000,1094342400,1094428800,1094515200,1094601600,1094688000,1094774400,1094860800,1094947200,1095033600,1095120000,1095206400,1095292800,1095379200,1095465600,1095552000,1095638400,1095724800,1095811200,1095897600,1095984000,1096070400,1096156800,1096243200,1096329600,1096416000,1096502400,1096588800,1096675200,1096761600,1096848000,1096934400,1097020800,1097107200,1097193600,1097280000,1097366400,1097452800,1097539200,1097625600,1097712000,1097798400,1097884800,1097971200,1098057600,1098144000,1098230400,1098316800,1098403200,1098489600,1098576000,1098662400,1098748800,1098835200,1098921600,1099008000,1099094400,1099180800,1099267200,1099353600,1099440000,1099526400,1099612800,1099699200,1099785600,1099872000,1099958400,1100044800,1100131200,1100217600,1100304000,1100390400,1100476800,1100563200,1100649600,1100736000,1100822400,1100908800,1100995200,1101081600,1101168000,1101254400,1101340800,1101427200,1101513600,1101600000,1101686400,1101772800,1101859200,1101945600,1102032000,1102118400,1102204800,1102291200,1102377600,1102464000,1102550400,1102636800,1102723200,1102809600,1102896000,1102982400,1103068800,1103155200,1103241600,1103328000,1103414400,1103500800,1103587200,1103673600,1103760000,1103846400,1103932800,1104019200,1104105600,1104192000,1104278400,1104364800,1104451200,1104537600,1104624000,1104710400,1104796800,1104883200,1104969600,1105056000,1105142400,1105228800,1105315200,1105401600,1105488000,1105574400,1105660800,1105747200,1105833600,1105920000,1106006400,1106092800,1106179200,1106265600,1106352000,1106438400,1106524800,1106611200,1106697600,1106784000,1106870400,1106956800,1107043200,1107129600,1107216000,1107302400,1107388800,1107475200,1107561600,1107648000,1107734400,1107820800,1107907200,1107993600,1108080000,1108166400,1108252800,1108339200,1108425600,1108512000,1108598400,1108684800,1108771200,1108857600,1108944000,1109030400,1109116800,1109203200,1109289600,1109376000,1109462400,1109548800,1109635200,1109721600,1109808000,1109894400,1109980800,1110067200,1110153600,1110240000,1110326400,1110412800,1110499200,1110585600,1110672000,1110758400,1110844800,1110931200,1111017600,1111104000,1111190400,1111276800,1111363200,1111449600,1111536000,1111622400,1111708800,1111795200,1111881600,1111968000,1112054400,1112140800,1112227200,1112313600,1112400000,1112486400,1112572800,1112659200,1112745600,1112832000,1112918400,1113004800,1113091200,1113177600,1113264000,1113350400,1113436800,1113523200,1113609600,1113696000,1113782400,1113868800,1113955200,1114041600,1114128000,1114214400,1114300800,1114387200,1114473600,1114560000,1114646400,1114732800,1114819200,1114905600,1114992000,1115078400,1115164800,1115251200,1115337600,1115424000,1115510400,1115596800,1115683200,1115769600,1115856000,1115942400,1116028800,1116115200,1116201600,1116288000,1116374400,1116460800,1116547200,1116633600,1116720000,1116806400,1116892800,1116979200,1117065600,1117152000,1117238400,1117324800,1117411200,1117497600,1117584000,1117670400,1117756800,1117843200,1117929600,1118016000,1118102400,1118188800,1118275200,1118361600,1118448000,1118534400,1118620800,1118707200,1118793600,1118880000,1118966400,1119052800,1119139200,1119225600,1119312000,1119398400,1119484800,1119571200,1119657600,1119744000,1119830400,1119916800,1120003200,1120089600,1120176000,1120262400,1120348800,1120435200,1120521600,1120608000,1120694400,1120780800,1120867200,1120953600,1121040000,1121126400,1121212800,1121299200,1121385600,1121472000,1121558400,1121644800,1121731200,1121817600,1121904000,1121990400,1122076800,1122163200,1122249600,1122336000,1122422400,1122508800,1122595200,1122681600,1122768000,1122854400,1122940800,1123027200,1123113600,1123200000,1123286400,1123372800,1123459200,1123545600,1123632000,1123718400,1123804800,1123891200,1123977600,1124064000,1124150400,1124236800,1124323200,1124409600,1124496000,1124582400,1124668800,1124755200,1124841600,1124928000,1125014400,1125100800,1125187200,1125273600,1125360000,1125446400,1125532800,1125619200,1125705600,1125792000,1125878400,1125964800,1126051200,1126137600,1126224000,1126310400,1126396800,1126483200,1126569600,1126656000,1126742400,1126828800,1126915200,1127001600,1127088000,1127174400,1127260800,1127347200,1127433600,1127520000,1127606400,1127692800,1127779200,1127865600,1127952000,1128038400,1128124800,1128211200,1128297600,1128384000,1128470400,1128556800,1128643200,1128729600,1128816000,1128902400,1128988800,1129075200,1129161600,1129248000,1129334400,1129420800,1129507200,1129593600,1129680000,1129766400,1129852800,1129939200,1130025600,1130112000,1130198400,1130284800,1130371200,1130457600,1130544000,1130630400,1130716800,1130803200,1130889600,1130976000,1131062400,1131148800,1131235200,1131321600,1131408000,1131494400,1131580800,1131667200,1131753600,1131840000,1131926400,1132012800,1132099200],"y":[103536,92051,100795,102352,106569,106284,113111,96806,86811,99194,102253,105707,107011,113588,97066,83848,99770,102281,104951,108397,115567,99758,88487,102773,107040,108092,109490,115048,101161,90733,101716,102497,108085,108811,113805,94656,85336,104140,105500,106046,111200,114801,97659,85532,102585,103496,110116,110804,115991,98807,78903,95771,94262,85453,79812,79697,88279,73671,85261,84747,69097,53098,62895,86079,70426,85305,88929,93399,94986,103527,89082,74378,93447,96083,101949,101859,107845,88817,75774,97604,94226,102939,105527,113448,95411,76837,91946,85353,91359,86544,105640,92171,80610,94744,96471,100312,101446,110229,93996,71021,93971,97976,97897,102504,109063,94801,80870,97986,102483,102183,106061,115648,102771,84360,88331,94749,104769,103626,115352,106147,87204,101010,99848,106266,108204,114861,107211,88627,101613,104557,106943,107516,118280,104538,87602,100617,104013,109856,108294,115030,103035,88306,101895,104498,106992,110311,119509,107610,93377,106440,107497,112579,112039,118536,106769,90149,107382,109815,115853,118665,81981,89445,85947,77578,106787,78507,98904,112033,99020,87171,103383,105724,109132,109921,113525,99976,89964,103502,105079,108907,108459,117628,100073,93067,102423,105466,108400,109673,115044,103755,91948,103312,105942,109693,108975,117470,102822,93955,101511,105379,118356,84766,99979,93063,93867,104688,105479,108257,111329,121513,102222,84476,81597,106469,113571,109995,116871,108218,93682,103733,104821,110010,103267,115401,99566,89032,103685,106686,109912,110514,120484,102527,90057,103136,95408,108925,112258,119767,102811,93380,106979,108257,111202,114077,120623,103581,93136,106387,105236,108627,109238,115837,96114,86720,100565,102154,104933,106651,111294,92630,83477,98319,96499,100800,101011,107933,90920,84247,97542,98893,103401,106127,111487,92582,77964,102841,101146,106045,109784,121901,102211,96986,105725,107870,113653,114267,122277,104698,95419,109242,111144,115260,115954,124403,106952,97599,110270,109962,116264,117794,125895,110708,98450,109557,112652,116694,118102,127753,114241,107292,112399,112754,116836,117459,124446,106424,96428,110455,111297,115429,117379,126060,108396,94600,110453,111235,115786,116325,125499,108943,95014,109457,110607,113489,115233,123690,107136,96202,108771,110697,112265,114622,121097,103108,90222,110364,112331,116902,118468,124538,104944,90597,110163,110928,115333,116896,124059,104903,94564,110952,113071,118935,120356,129619,110459,95837,114727,111004,115475,116164,122436,102051,89408,109257,109222,114327,115775,121941,98781,91683,110950,111251,114939,118060,121682,99110,88473,109773,110716,114749,119085,126006,105812,92743,110123,112114,115702,117914,123787,102930,92930,110077,113405,118597,118173,123042,101572,90986,110925,112880,118018,119937,124286,99785,83675,106888,112024,115584,113159,96327,91214,89976,92187,92113,94076,96067,77596,67960,83327,91821,94312,100961,102582,109537,96266,81751,101816,104401,108275,110258,117427,94823,82146,106252,106606,107055,110016,117858,95417,77919,93752,98867,105962,108724,116543,98505,78339,101919,98135,101917,106061,116148,102001,77231,100356,102958,105418,107589,116802,103630,76094,97551,96739,100696,107179,115357,99149,80211,100679,101775,105425,110215,119054,104493,79274,104728,108108,110717,113472,120868,104436,82377,106022,104966,111765,116027,124189,108370,90511,109599,111848,118230,119382,128255,113087,95270,114051,116986,124493,127354,86171,97296,87922,90481,116328,121326,121118,129009,111132,96227,114573,115811,120461,120288,125310,103944,91469,112007,113554,116409,118531,123488,100044,87253,110889,113771,117451,119250,126197,104666,91595,112708,115921,120044,122071,129401,107166,94934,113264,115493,126497,81910,108995,97762,103213,112913,114948,119588,119355,129633,101264,87722,86177,117634,120835,121769,128446,105411,90105,115380,117490,124565,115479,128042,106940,98251,115084,116572,119382,120566,127596,105138,96391,113115,116348,120433,121204,129282,107096,97622,115042,116187,121635,124340,131031,108944,98758,115087,115261,123895,123366,128982,107271,95851,116698,115929,121116,125353,133250,109585,96375,113769,116471,117421,119848,125162,102040,93008,112064,111813,114745,116090,122300,101013,89492,111071,107705,108943,110562,116944,97075,84374,103595,104704,106882,107520,116673,100699,84502,72614,110359,110603,113722,119009,102012,90521,111027,113565,118494,118515,129253,110948,100364,116032,116287,120706,121582,130141,112162,95294,114273,119640,123666,128274,139840,122379,104101,116825,117562,119893,121723,127877,113551,98545,114681,114318,118455,120824,128273,108605,96555,113244,114575,116712,120260,127790,109287,92052,112624,115000,119110,120223,126570,111370,98189,113779,115827,122445,121893,131419,111808,93627,113190,111446,113284,115066,121956,103183,94668,110714,112019,113990,116613,121966,104734,93587,112944,114643,118033,121717,127012,103776,89657,113247,116713,121010,123814,132332,112413,97626,116393,117629,117854,122053,126866,107386,98226,113398,113682,116443,119386,126650,104646,94424,112165,114296,114690],"text":["Day: 2003-11-01<br /># Vehicles in tunnel: 103536","Day: 2003-11-02<br /># Vehicles in tunnel:  92051","Day: 2003-11-03<br /># Vehicles in tunnel: 100795","Day: 2003-11-04<br /># Vehicles in tunnel: 102352","Day: 2003-11-05<br /># Vehicles in tunnel: 106569","Day: 2003-11-06<br /># Vehicles in tunnel: 106284","Day: 2003-11-07<br /># Vehicles in tunnel: 113111","Day: 2003-11-08<br /># Vehicles in tunnel:  96806","Day: 2003-11-09<br /># Vehicles in tunnel:  86811","Day: 2003-11-10<br /># Vehicles in tunnel:  99194","Day: 2003-11-11<br /># Vehicles in tunnel: 102253","Day: 2003-11-12<br /># Vehicles in tunnel: 105707","Day: 2003-11-13<br /># Vehicles in tunnel: 107011","Day: 2003-11-14<br /># Vehicles in tunnel: 113588","Day: 2003-11-15<br /># Vehicles in tunnel:  97066","Day: 2003-11-16<br /># Vehicles in tunnel:  83848","Day: 2003-11-17<br /># Vehicles in tunnel:  99770","Day: 2003-11-18<br /># Vehicles in tunnel: 102281","Day: 2003-11-19<br /># Vehicles in tunnel: 104951","Day: 2003-11-20<br /># Vehicles in tunnel: 108397","Day: 2003-11-21<br /># Vehicles in tunnel: 115567","Day: 2003-11-22<br /># Vehicles in tunnel:  99758","Day: 2003-11-23<br /># Vehicles in tunnel:  88487","Day: 2003-11-24<br /># Vehicles in tunnel: 102773","Day: 2003-11-25<br /># Vehicles in tunnel: 107040","Day: 2003-11-26<br /># Vehicles in tunnel: 108092","Day: 2003-11-27<br /># Vehicles in tunnel: 109490","Day: 2003-11-28<br /># Vehicles in tunnel: 115048","Day: 2003-11-29<br /># Vehicles in tunnel: 101161","Day: 2003-11-30<br /># Vehicles in tunnel:  90733","Day: 2003-12-01<br /># Vehicles in tunnel: 101716","Day: 2003-12-02<br /># Vehicles in tunnel: 102497","Day: 2003-12-03<br /># Vehicles in tunnel: 108085","Day: 2003-12-04<br /># Vehicles in tunnel: 108811","Day: 2003-12-05<br /># Vehicles in tunnel: 113805","Day: 2003-12-06<br /># Vehicles in tunnel:  94656","Day: 2003-12-07<br /># Vehicles in tunnel:  85336","Day: 2003-12-08<br /># Vehicles in tunnel: 104140","Day: 2003-12-09<br /># Vehicles in tunnel: 105500","Day: 2003-12-10<br /># Vehicles in tunnel: 106046","Day: 2003-12-11<br /># Vehicles in tunnel: 111200","Day: 2003-12-12<br /># Vehicles in tunnel: 114801","Day: 2003-12-13<br /># Vehicles in tunnel:  97659","Day: 2003-12-14<br /># Vehicles in tunnel:  85532","Day: 2003-12-15<br /># Vehicles in tunnel: 102585","Day: 2003-12-16<br /># Vehicles in tunnel: 103496","Day: 2003-12-17<br /># Vehicles in tunnel: 110116","Day: 2003-12-18<br /># Vehicles in tunnel: 110804","Day: 2003-12-19<br /># Vehicles in tunnel: 115991","Day: 2003-12-20<br /># Vehicles in tunnel:  98807","Day: 2003-12-21<br /># Vehicles in tunnel:  78903","Day: 2003-12-22<br /># Vehicles in tunnel:  95771","Day: 2003-12-23<br /># Vehicles in tunnel:  94262","Day: 2003-12-24<br /># Vehicles in tunnel:  85453","Day: 2003-12-25<br /># Vehicles in tunnel:  79812","Day: 2003-12-26<br /># Vehicles in tunnel:  79697","Day: 2003-12-27<br /># Vehicles in tunnel:  88279","Day: 2003-12-28<br /># Vehicles in tunnel:  73671","Day: 2003-12-29<br /># Vehicles in tunnel:  85261","Day: 2003-12-30<br /># Vehicles in tunnel:  84747","Day: 2003-12-31<br /># Vehicles in tunnel:  69097","Day: 2004-01-01<br /># Vehicles in tunnel:  53098","Day: 2004-01-02<br /># Vehicles in tunnel:  62895","Day: 2004-01-03<br /># Vehicles in tunnel:  86079","Day: 2004-01-04<br /># Vehicles in tunnel:  70426","Day: 2004-01-05<br /># Vehicles in tunnel:  85305","Day: 2004-01-06<br /># Vehicles in tunnel:  88929","Day: 2004-01-07<br /># Vehicles in tunnel:  93399","Day: 2004-01-08<br /># Vehicles in tunnel:  94986","Day: 2004-01-09<br /># Vehicles in tunnel: 103527","Day: 2004-01-10<br /># Vehicles in tunnel:  89082","Day: 2004-01-11<br /># Vehicles in tunnel:  74378","Day: 2004-01-12<br /># Vehicles in tunnel:  93447","Day: 2004-01-13<br /># Vehicles in tunnel:  96083","Day: 2004-01-14<br /># Vehicles in tunnel: 101949","Day: 2004-01-15<br /># Vehicles in tunnel: 101859","Day: 2004-01-16<br /># Vehicles in tunnel: 107845","Day: 2004-01-17<br /># Vehicles in tunnel:  88817","Day: 2004-01-18<br /># Vehicles in tunnel:  75774","Day: 2004-01-19<br /># Vehicles in tunnel:  97604","Day: 2004-01-20<br /># Vehicles in tunnel:  94226","Day: 2004-01-21<br /># Vehicles in tunnel: 102939","Day: 2004-01-22<br /># Vehicles in tunnel: 105527","Day: 2004-01-23<br /># Vehicles in tunnel: 113448","Day: 2004-01-24<br /># Vehicles in tunnel:  95411","Day: 2004-01-25<br /># Vehicles in tunnel:  76837","Day: 2004-01-26<br /># Vehicles in tunnel:  91946","Day: 2004-01-27<br /># Vehicles in tunnel:  85353","Day: 2004-01-28<br /># Vehicles in tunnel:  91359","Day: 2004-01-29<br /># Vehicles in tunnel:  86544","Day: 2004-01-30<br /># Vehicles in tunnel: 105640","Day: 2004-01-31<br /># Vehicles in tunnel:  92171","Day: 2004-02-01<br /># Vehicles in tunnel:  80610","Day: 2004-02-02<br /># Vehicles in tunnel:  94744","Day: 2004-02-03<br /># Vehicles in tunnel:  96471","Day: 2004-02-04<br /># Vehicles in tunnel: 100312","Day: 2004-02-05<br /># Vehicles in tunnel: 101446","Day: 2004-02-06<br /># Vehicles in tunnel: 110229","Day: 2004-02-07<br /># Vehicles in tunnel:  93996","Day: 2004-02-08<br /># Vehicles in tunnel:  71021","Day: 2004-02-09<br /># Vehicles in tunnel:  93971","Day: 2004-02-10<br /># Vehicles in tunnel:  97976","Day: 2004-02-11<br /># Vehicles in tunnel:  97897","Day: 2004-02-12<br /># Vehicles in tunnel: 102504","Day: 2004-02-13<br /># Vehicles in tunnel: 109063","Day: 2004-02-14<br /># Vehicles in tunnel:  94801","Day: 2004-02-15<br /># Vehicles in tunnel:  80870","Day: 2004-02-16<br /># Vehicles in tunnel:  97986","Day: 2004-02-17<br /># Vehicles in tunnel: 102483","Day: 2004-02-18<br /># Vehicles in tunnel: 102183","Day: 2004-02-19<br /># Vehicles in tunnel: 106061","Day: 2004-02-20<br /># Vehicles in tunnel: 115648","Day: 2004-02-21<br /># Vehicles in tunnel: 102771","Day: 2004-02-22<br /># Vehicles in tunnel:  84360","Day: 2004-02-23<br /># Vehicles in tunnel:  88331","Day: 2004-02-24<br /># Vehicles in tunnel:  94749","Day: 2004-02-25<br /># Vehicles in tunnel: 104769","Day: 2004-02-26<br /># Vehicles in tunnel: 103626","Day: 2004-02-27<br /># Vehicles in tunnel: 115352","Day: 2004-02-28<br /># Vehicles in tunnel: 106147","Day: 2004-02-29<br /># Vehicles in tunnel:  87204","Day: 2004-03-01<br /># Vehicles in tunnel: 101010","Day: 2004-03-02<br /># Vehicles in tunnel:  99848","Day: 2004-03-03<br /># Vehicles in tunnel: 106266","Day: 2004-03-04<br /># Vehicles in tunnel: 108204","Day: 2004-03-05<br /># Vehicles in tunnel: 114861","Day: 2004-03-06<br /># Vehicles in tunnel: 107211","Day: 2004-03-07<br /># Vehicles in tunnel:  88627","Day: 2004-03-08<br /># Vehicles in tunnel: 101613","Day: 2004-03-09<br /># Vehicles in tunnel: 104557","Day: 2004-03-10<br /># Vehicles in tunnel: 106943","Day: 2004-03-11<br /># Vehicles in tunnel: 107516","Day: 2004-03-12<br /># Vehicles in tunnel: 118280","Day: 2004-03-13<br /># Vehicles in tunnel: 104538","Day: 2004-03-14<br /># Vehicles in tunnel:  87602","Day: 2004-03-15<br /># Vehicles in tunnel: 100617","Day: 2004-03-16<br /># Vehicles in tunnel: 104013","Day: 2004-03-17<br /># Vehicles in tunnel: 109856","Day: 2004-03-18<br /># Vehicles in tunnel: 108294","Day: 2004-03-19<br /># Vehicles in tunnel: 115030","Day: 2004-03-20<br /># Vehicles in tunnel: 103035","Day: 2004-03-21<br /># Vehicles in tunnel:  88306","Day: 2004-03-22<br /># Vehicles in tunnel: 101895","Day: 2004-03-23<br /># Vehicles in tunnel: 104498","Day: 2004-03-24<br /># Vehicles in tunnel: 106992","Day: 2004-03-25<br /># Vehicles in tunnel: 110311","Day: 2004-03-26<br /># Vehicles in tunnel: 119509","Day: 2004-03-27<br /># Vehicles in tunnel: 107610","Day: 2004-03-28<br /># Vehicles in tunnel:  93377","Day: 2004-03-29<br /># Vehicles in tunnel: 106440","Day: 2004-03-30<br /># Vehicles in tunnel: 107497","Day: 2004-03-31<br /># Vehicles in tunnel: 112579","Day: 2004-04-01<br /># Vehicles in tunnel: 112039","Day: 2004-04-02<br /># Vehicles in tunnel: 118536","Day: 2004-04-03<br /># Vehicles in tunnel: 106769","Day: 2004-04-04<br /># Vehicles in tunnel:  90149","Day: 2004-04-05<br /># Vehicles in tunnel: 107382","Day: 2004-04-06<br /># Vehicles in tunnel: 109815","Day: 2004-04-07<br /># Vehicles in tunnel: 115853","Day: 2004-04-08<br /># Vehicles in tunnel: 118665","Day: 2004-04-09<br /># Vehicles in tunnel:  81981","Day: 2004-04-10<br /># Vehicles in tunnel:  89445","Day: 2004-04-11<br /># Vehicles in tunnel:  85947","Day: 2004-04-12<br /># Vehicles in tunnel:  77578","Day: 2004-04-13<br /># Vehicles in tunnel: 106787","Day: 2004-04-14<br /># Vehicles in tunnel:  78507","Day: 2004-04-15<br /># Vehicles in tunnel:  98904","Day: 2004-04-16<br /># Vehicles in tunnel: 112033","Day: 2004-04-17<br /># Vehicles in tunnel:  99020","Day: 2004-04-18<br /># Vehicles in tunnel:  87171","Day: 2004-04-19<br /># Vehicles in tunnel: 103383","Day: 2004-04-20<br /># Vehicles in tunnel: 105724","Day: 2004-04-21<br /># Vehicles in tunnel: 109132","Day: 2004-04-22<br /># Vehicles in tunnel: 109921","Day: 2004-04-23<br /># Vehicles in tunnel: 113525","Day: 2004-04-24<br /># Vehicles in tunnel:  99976","Day: 2004-04-25<br /># Vehicles in tunnel:  89964","Day: 2004-04-26<br /># Vehicles in tunnel: 103502","Day: 2004-04-27<br /># Vehicles in tunnel: 105079","Day: 2004-04-28<br /># Vehicles in tunnel: 108907","Day: 2004-04-29<br /># Vehicles in tunnel: 108459","Day: 2004-04-30<br /># Vehicles in tunnel: 117628","Day: 2004-05-01<br /># Vehicles in tunnel: 100073","Day: 2004-05-02<br /># Vehicles in tunnel:  93067","Day: 2004-05-03<br /># Vehicles in tunnel: 102423","Day: 2004-05-04<br /># Vehicles in tunnel: 105466","Day: 2004-05-05<br /># Vehicles in tunnel: 108400","Day: 2004-05-06<br /># Vehicles in tunnel: 109673","Day: 2004-05-07<br /># Vehicles in tunnel: 115044","Day: 2004-05-08<br /># Vehicles in tunnel: 103755","Day: 2004-05-09<br /># Vehicles in tunnel:  91948","Day: 2004-05-10<br /># Vehicles in tunnel: 103312","Day: 2004-05-11<br /># Vehicles in tunnel: 105942","Day: 2004-05-12<br /># Vehicles in tunnel: 109693","Day: 2004-05-13<br /># Vehicles in tunnel: 108975","Day: 2004-05-14<br /># Vehicles in tunnel: 117470","Day: 2004-05-15<br /># Vehicles in tunnel: 102822","Day: 2004-05-16<br /># Vehicles in tunnel:  93955","Day: 2004-05-17<br /># Vehicles in tunnel: 101511","Day: 2004-05-18<br /># Vehicles in tunnel: 105379","Day: 2004-05-19<br /># Vehicles in tunnel: 118356","Day: 2004-05-20<br /># Vehicles in tunnel:  84766","Day: 2004-05-21<br /># Vehicles in tunnel:  99979","Day: 2004-05-22<br /># Vehicles in tunnel:  93063","Day: 2004-05-23<br /># Vehicles in tunnel:  93867","Day: 2004-05-24<br /># Vehicles in tunnel: 104688","Day: 2004-05-25<br /># Vehicles in tunnel: 105479","Day: 2004-05-26<br /># Vehicles in tunnel: 108257","Day: 2004-05-27<br /># Vehicles in tunnel: 111329","Day: 2004-05-28<br /># Vehicles in tunnel: 121513","Day: 2004-05-29<br /># Vehicles in tunnel: 102222","Day: 2004-05-30<br /># Vehicles in tunnel:  84476","Day: 2004-05-31<br /># Vehicles in tunnel:  81597","Day: 2004-06-01<br /># Vehicles in tunnel: 106469","Day: 2004-06-02<br /># Vehicles in tunnel: 113571","Day: 2004-06-03<br /># Vehicles in tunnel: 109995","Day: 2004-06-04<br /># Vehicles in tunnel: 116871","Day: 2004-06-05<br /># Vehicles in tunnel: 108218","Day: 2004-06-06<br /># Vehicles in tunnel:  93682","Day: 2004-06-07<br /># Vehicles in tunnel: 103733","Day: 2004-06-08<br /># Vehicles in tunnel: 104821","Day: 2004-06-09<br /># Vehicles in tunnel: 110010","Day: 2004-06-10<br /># Vehicles in tunnel: 103267","Day: 2004-06-11<br /># Vehicles in tunnel: 115401","Day: 2004-06-12<br /># Vehicles in tunnel:  99566","Day: 2004-06-13<br /># Vehicles in tunnel:  89032","Day: 2004-06-14<br /># Vehicles in tunnel: 103685","Day: 2004-06-15<br /># Vehicles in tunnel: 106686","Day: 2004-06-16<br /># Vehicles in tunnel: 109912","Day: 2004-06-17<br /># Vehicles in tunnel: 110514","Day: 2004-06-18<br /># Vehicles in tunnel: 120484","Day: 2004-06-19<br /># Vehicles in tunnel: 102527","Day: 2004-06-20<br /># Vehicles in tunnel:  90057","Day: 2004-06-21<br /># Vehicles in tunnel: 103136","Day: 2004-06-22<br /># Vehicles in tunnel:  95408","Day: 2004-06-23<br /># Vehicles in tunnel: 108925","Day: 2004-06-24<br /># Vehicles in tunnel: 112258","Day: 2004-06-25<br /># Vehicles in tunnel: 119767","Day: 2004-06-26<br /># Vehicles in tunnel: 102811","Day: 2004-06-27<br /># Vehicles in tunnel:  93380","Day: 2004-06-28<br /># Vehicles in tunnel: 106979","Day: 2004-06-29<br /># Vehicles in tunnel: 108257","Day: 2004-06-30<br /># Vehicles in tunnel: 111202","Day: 2004-07-01<br /># Vehicles in tunnel: 114077","Day: 2004-07-02<br /># Vehicles in tunnel: 120623","Day: 2004-07-03<br /># Vehicles in tunnel: 103581","Day: 2004-07-04<br /># Vehicles in tunnel:  93136","Day: 2004-07-05<br /># Vehicles in tunnel: 106387","Day: 2004-07-06<br /># Vehicles in tunnel: 105236","Day: 2004-07-07<br /># Vehicles in tunnel: 108627","Day: 2004-07-08<br /># Vehicles in tunnel: 109238","Day: 2004-07-09<br /># Vehicles in tunnel: 115837","Day: 2004-07-10<br /># Vehicles in tunnel:  96114","Day: 2004-07-11<br /># Vehicles in tunnel:  86720","Day: 2004-07-12<br /># Vehicles in tunnel: 100565","Day: 2004-07-13<br /># Vehicles in tunnel: 102154","Day: 2004-07-14<br /># Vehicles in tunnel: 104933","Day: 2004-07-15<br /># Vehicles in tunnel: 106651","Day: 2004-07-16<br /># Vehicles in tunnel: 111294","Day: 2004-07-17<br /># Vehicles in tunnel:  92630","Day: 2004-07-18<br /># Vehicles in tunnel:  83477","Day: 2004-07-19<br /># Vehicles in tunnel:  98319","Day: 2004-07-20<br /># Vehicles in tunnel:  96499","Day: 2004-07-21<br /># Vehicles in tunnel: 100800","Day: 2004-07-22<br /># Vehicles in tunnel: 101011","Day: 2004-07-23<br /># Vehicles in tunnel: 107933","Day: 2004-07-24<br /># Vehicles in tunnel:  90920","Day: 2004-07-25<br /># Vehicles in tunnel:  84247","Day: 2004-07-26<br /># Vehicles in tunnel:  97542","Day: 2004-07-27<br /># Vehicles in tunnel:  98893","Day: 2004-07-28<br /># Vehicles in tunnel: 103401","Day: 2004-07-29<br /># Vehicles in tunnel: 106127","Day: 2004-07-30<br /># Vehicles in tunnel: 111487","Day: 2004-07-31<br /># Vehicles in tunnel:  92582","Day: 2004-08-01<br /># Vehicles in tunnel:  77964","Day: 2004-08-02<br /># Vehicles in tunnel: 102841","Day: 2004-08-03<br /># Vehicles in tunnel: 101146","Day: 2004-08-04<br /># Vehicles in tunnel: 106045","Day: 2004-08-05<br /># Vehicles in tunnel: 109784","Day: 2004-08-06<br /># Vehicles in tunnel: 121901","Day: 2004-08-07<br /># Vehicles in tunnel: 102211","Day: 2004-08-08<br /># Vehicles in tunnel:  96986","Day: 2004-08-09<br /># Vehicles in tunnel: 105725","Day: 2004-08-10<br /># Vehicles in tunnel: 107870","Day: 2004-08-11<br /># Vehicles in tunnel: 113653","Day: 2004-08-12<br /># Vehicles in tunnel: 114267","Day: 2004-08-13<br /># Vehicles in tunnel: 122277","Day: 2004-08-14<br /># Vehicles in tunnel: 104698","Day: 2004-08-15<br /># Vehicles in tunnel:  95419","Day: 2004-08-16<br /># Vehicles in tunnel: 109242","Day: 2004-08-17<br /># Vehicles in tunnel: 111144","Day: 2004-08-18<br /># Vehicles in tunnel: 115260","Day: 2004-08-19<br /># Vehicles in tunnel: 115954","Day: 2004-08-20<br /># Vehicles in tunnel: 124403","Day: 2004-08-21<br /># Vehicles in tunnel: 106952","Day: 2004-08-22<br /># Vehicles in tunnel:  97599","Day: 2004-08-23<br /># Vehicles in tunnel: 110270","Day: 2004-08-24<br /># Vehicles in tunnel: 109962","Day: 2004-08-25<br /># Vehicles in tunnel: 116264","Day: 2004-08-26<br /># Vehicles in tunnel: 117794","Day: 2004-08-27<br /># Vehicles in tunnel: 125895","Day: 2004-08-28<br /># Vehicles in tunnel: 110708","Day: 2004-08-29<br /># Vehicles in tunnel:  98450","Day: 2004-08-30<br /># Vehicles in tunnel: 109557","Day: 2004-08-31<br /># Vehicles in tunnel: 112652","Day: 2004-09-01<br /># Vehicles in tunnel: 116694","Day: 2004-09-02<br /># Vehicles in tunnel: 118102","Day: 2004-09-03<br /># Vehicles in tunnel: 127753","Day: 2004-09-04<br /># Vehicles in tunnel: 114241","Day: 2004-09-05<br /># Vehicles in tunnel: 107292","Day: 2004-09-06<br /># Vehicles in tunnel: 112399","Day: 2004-09-07<br /># Vehicles in tunnel: 112754","Day: 2004-09-08<br /># Vehicles in tunnel: 116836","Day: 2004-09-09<br /># Vehicles in tunnel: 117459","Day: 2004-09-10<br /># Vehicles in tunnel: 124446","Day: 2004-09-11<br /># Vehicles in tunnel: 106424","Day: 2004-09-12<br /># Vehicles in tunnel:  96428","Day: 2004-09-13<br /># Vehicles in tunnel: 110455","Day: 2004-09-14<br /># Vehicles in tunnel: 111297","Day: 2004-09-15<br /># Vehicles in tunnel: 115429","Day: 2004-09-16<br /># Vehicles in tunnel: 117379","Day: 2004-09-17<br /># Vehicles in tunnel: 126060","Day: 2004-09-18<br /># Vehicles in tunnel: 108396","Day: 2004-09-19<br /># Vehicles in tunnel:  94600","Day: 2004-09-20<br /># Vehicles in tunnel: 110453","Day: 2004-09-21<br /># Vehicles in tunnel: 111235","Day: 2004-09-22<br /># Vehicles in tunnel: 115786","Day: 2004-09-23<br /># Vehicles in tunnel: 116325","Day: 2004-09-24<br /># Vehicles in tunnel: 125499","Day: 2004-09-25<br /># Vehicles in tunnel: 108943","Day: 2004-09-26<br /># Vehicles in tunnel:  95014","Day: 2004-09-27<br /># Vehicles in tunnel: 109457","Day: 2004-09-28<br /># Vehicles in tunnel: 110607","Day: 2004-09-29<br /># Vehicles in tunnel: 113489","Day: 2004-09-30<br /># Vehicles in tunnel: 115233","Day: 2004-10-01<br /># Vehicles in tunnel: 123690","Day: 2004-10-02<br /># Vehicles in tunnel: 107136","Day: 2004-10-03<br /># Vehicles in tunnel:  96202","Day: 2004-10-04<br /># Vehicles in tunnel: 108771","Day: 2004-10-05<br /># Vehicles in tunnel: 110697","Day: 2004-10-06<br /># Vehicles in tunnel: 112265","Day: 2004-10-07<br /># Vehicles in tunnel: 114622","Day: 2004-10-08<br /># Vehicles in tunnel: 121097","Day: 2004-10-09<br /># Vehicles in tunnel: 103108","Day: 2004-10-10<br /># Vehicles in tunnel:  90222","Day: 2004-10-11<br /># Vehicles in tunnel: 110364","Day: 2004-10-12<br /># Vehicles in tunnel: 112331","Day: 2004-10-13<br /># Vehicles in tunnel: 116902","Day: 2004-10-14<br /># Vehicles in tunnel: 118468","Day: 2004-10-15<br /># Vehicles in tunnel: 124538","Day: 2004-10-16<br /># Vehicles in tunnel: 104944","Day: 2004-10-17<br /># Vehicles in tunnel:  90597","Day: 2004-10-18<br /># Vehicles in tunnel: 110163","Day: 2004-10-19<br /># Vehicles in tunnel: 110928","Day: 2004-10-20<br /># Vehicles in tunnel: 115333","Day: 2004-10-21<br /># Vehicles in tunnel: 116896","Day: 2004-10-22<br /># Vehicles in tunnel: 124059","Day: 2004-10-23<br /># Vehicles in tunnel: 104903","Day: 2004-10-24<br /># Vehicles in tunnel:  94564","Day: 2004-10-25<br /># Vehicles in tunnel: 110952","Day: 2004-10-26<br /># Vehicles in tunnel: 113071","Day: 2004-10-27<br /># Vehicles in tunnel: 118935","Day: 2004-10-28<br /># Vehicles in tunnel: 120356","Day: 2004-10-29<br /># Vehicles in tunnel: 129619","Day: 2004-10-30<br /># Vehicles in tunnel: 110459","Day: 2004-10-31<br /># Vehicles in tunnel:  95837","Day: 2004-11-01<br /># Vehicles in tunnel: 114727","Day: 2004-11-02<br /># Vehicles in tunnel: 111004","Day: 2004-11-03<br /># Vehicles in tunnel: 115475","Day: 2004-11-04<br /># Vehicles in tunnel: 116164","Day: 2004-11-05<br /># Vehicles in tunnel: 122436","Day: 2004-11-06<br /># Vehicles in tunnel: 102051","Day: 2004-11-07<br /># Vehicles in tunnel:  89408","Day: 2004-11-08<br /># Vehicles in tunnel: 109257","Day: 2004-11-09<br /># Vehicles in tunnel: 109222","Day: 2004-11-10<br /># Vehicles in tunnel: 114327","Day: 2004-11-11<br /># Vehicles in tunnel: 115775","Day: 2004-11-12<br /># Vehicles in tunnel: 121941","Day: 2004-11-13<br /># Vehicles in tunnel:  98781","Day: 2004-11-14<br /># Vehicles in tunnel:  91683","Day: 2004-11-15<br /># Vehicles in tunnel: 110950","Day: 2004-11-16<br /># Vehicles in tunnel: 111251","Day: 2004-11-17<br /># Vehicles in tunnel: 114939","Day: 2004-11-18<br /># Vehicles in tunnel: 118060","Day: 2004-11-19<br /># Vehicles in tunnel: 121682","Day: 2004-11-20<br /># Vehicles in tunnel:  99110","Day: 2004-11-21<br /># Vehicles in tunnel:  88473","Day: 2004-11-22<br /># Vehicles in tunnel: 109773","Day: 2004-11-23<br /># Vehicles in tunnel: 110716","Day: 2004-11-24<br /># Vehicles in tunnel: 114749","Day: 2004-11-25<br /># Vehicles in tunnel: 119085","Day: 2004-11-26<br /># Vehicles in tunnel: 126006","Day: 2004-11-27<br /># Vehicles in tunnel: 105812","Day: 2004-11-28<br /># Vehicles in tunnel:  92743","Day: 2004-11-29<br /># Vehicles in tunnel: 110123","Day: 2004-11-30<br /># Vehicles in tunnel: 112114","Day: 2004-12-01<br /># Vehicles in tunnel: 115702","Day: 2004-12-02<br /># Vehicles in tunnel: 117914","Day: 2004-12-03<br /># Vehicles in tunnel: 123787","Day: 2004-12-04<br /># Vehicles in tunnel: 102930","Day: 2004-12-05<br /># Vehicles in tunnel:  92930","Day: 2004-12-06<br /># Vehicles in tunnel: 110077","Day: 2004-12-07<br /># Vehicles in tunnel: 113405","Day: 2004-12-08<br /># Vehicles in tunnel: 118597","Day: 2004-12-09<br /># Vehicles in tunnel: 118173","Day: 2004-12-10<br /># Vehicles in tunnel: 123042","Day: 2004-12-11<br /># Vehicles in tunnel: 101572","Day: 2004-12-12<br /># Vehicles in tunnel:  90986","Day: 2004-12-13<br /># Vehicles in tunnel: 110925","Day: 2004-12-14<br /># Vehicles in tunnel: 112880","Day: 2004-12-15<br /># Vehicles in tunnel: 118018","Day: 2004-12-16<br /># Vehicles in tunnel: 119937","Day: 2004-12-17<br /># Vehicles in tunnel: 124286","Day: 2004-12-18<br /># Vehicles in tunnel:  99785","Day: 2004-12-19<br /># Vehicles in tunnel:  83675","Day: 2004-12-20<br /># Vehicles in tunnel: 106888","Day: 2004-12-21<br /># Vehicles in tunnel: 112024","Day: 2004-12-22<br /># Vehicles in tunnel: 115584","Day: 2004-12-23<br /># Vehicles in tunnel: 113159","Day: 2004-12-24<br /># Vehicles in tunnel:  96327","Day: 2004-12-25<br /># Vehicles in tunnel:  91214","Day: 2004-12-26<br /># Vehicles in tunnel:  89976","Day: 2004-12-27<br /># Vehicles in tunnel:  92187","Day: 2004-12-28<br /># Vehicles in tunnel:  92113","Day: 2004-12-29<br /># Vehicles in tunnel:  94076","Day: 2004-12-30<br /># Vehicles in tunnel:  96067","Day: 2004-12-31<br /># Vehicles in tunnel:  77596","Day: 2005-01-01<br /># Vehicles in tunnel:  67960","Day: 2005-01-02<br /># Vehicles in tunnel:  83327","Day: 2005-01-03<br /># Vehicles in tunnel:  91821","Day: 2005-01-04<br /># Vehicles in tunnel:  94312","Day: 2005-01-05<br /># Vehicles in tunnel: 100961","Day: 2005-01-06<br /># Vehicles in tunnel: 102582","Day: 2005-01-07<br /># Vehicles in tunnel: 109537","Day: 2005-01-08<br /># Vehicles in tunnel:  96266","Day: 2005-01-09<br /># Vehicles in tunnel:  81751","Day: 2005-01-10<br /># Vehicles in tunnel: 101816","Day: 2005-01-11<br /># Vehicles in tunnel: 104401","Day: 2005-01-12<br /># Vehicles in tunnel: 108275","Day: 2005-01-13<br /># Vehicles in tunnel: 110258","Day: 2005-01-14<br /># Vehicles in tunnel: 117427","Day: 2005-01-15<br /># Vehicles in tunnel:  94823","Day: 2005-01-16<br /># Vehicles in tunnel:  82146","Day: 2005-01-17<br /># Vehicles in tunnel: 106252","Day: 2005-01-18<br /># Vehicles in tunnel: 106606","Day: 2005-01-19<br /># Vehicles in tunnel: 107055","Day: 2005-01-20<br /># Vehicles in tunnel: 110016","Day: 2005-01-21<br /># Vehicles in tunnel: 117858","Day: 2005-01-22<br /># Vehicles in tunnel:  95417","Day: 2005-01-23<br /># Vehicles in tunnel:  77919","Day: 2005-01-24<br /># Vehicles in tunnel:  93752","Day: 2005-01-25<br /># Vehicles in tunnel:  98867","Day: 2005-01-26<br /># Vehicles in tunnel: 105962","Day: 2005-01-27<br /># Vehicles in tunnel: 108724","Day: 2005-01-28<br /># Vehicles in tunnel: 116543","Day: 2005-01-29<br /># Vehicles in tunnel:  98505","Day: 2005-01-30<br /># Vehicles in tunnel:  78339","Day: 2005-01-31<br /># Vehicles in tunnel: 101919","Day: 2005-02-01<br /># Vehicles in tunnel:  98135","Day: 2005-02-02<br /># Vehicles in tunnel: 101917","Day: 2005-02-03<br /># Vehicles in tunnel: 106061","Day: 2005-02-04<br /># Vehicles in tunnel: 116148","Day: 2005-02-05<br /># Vehicles in tunnel: 102001","Day: 2005-02-06<br /># Vehicles in tunnel:  77231","Day: 2005-02-07<br /># Vehicles in tunnel: 100356","Day: 2005-02-08<br /># Vehicles in tunnel: 102958","Day: 2005-02-09<br /># Vehicles in tunnel: 105418","Day: 2005-02-10<br /># Vehicles in tunnel: 107589","Day: 2005-02-11<br /># Vehicles in tunnel: 116802","Day: 2005-02-12<br /># Vehicles in tunnel: 103630","Day: 2005-02-13<br /># Vehicles in tunnel:  76094","Day: 2005-02-14<br /># Vehicles in tunnel:  97551","Day: 2005-02-15<br /># Vehicles in tunnel:  96739","Day: 2005-02-16<br /># Vehicles in tunnel: 100696","Day: 2005-02-17<br /># Vehicles in tunnel: 107179","Day: 2005-02-18<br /># Vehicles in tunnel: 115357","Day: 2005-02-19<br /># Vehicles in tunnel:  99149","Day: 2005-02-20<br /># Vehicles in tunnel:  80211","Day: 2005-02-21<br /># Vehicles in tunnel: 100679","Day: 2005-02-22<br /># Vehicles in tunnel: 101775","Day: 2005-02-23<br /># Vehicles in tunnel: 105425","Day: 2005-02-24<br /># Vehicles in tunnel: 110215","Day: 2005-02-25<br /># Vehicles in tunnel: 119054","Day: 2005-02-26<br /># Vehicles in tunnel: 104493","Day: 2005-02-27<br /># Vehicles in tunnel:  79274","Day: 2005-02-28<br /># Vehicles in tunnel: 104728","Day: 2005-03-01<br /># Vehicles in tunnel: 108108","Day: 2005-03-02<br /># Vehicles in tunnel: 110717","Day: 2005-03-03<br /># Vehicles in tunnel: 113472","Day: 2005-03-04<br /># Vehicles in tunnel: 120868","Day: 2005-03-05<br /># Vehicles in tunnel: 104436","Day: 2005-03-06<br /># Vehicles in tunnel:  82377","Day: 2005-03-07<br /># Vehicles in tunnel: 106022","Day: 2005-03-08<br /># Vehicles in tunnel: 104966","Day: 2005-03-09<br /># Vehicles in tunnel: 111765","Day: 2005-03-10<br /># Vehicles in tunnel: 116027","Day: 2005-03-11<br /># Vehicles in tunnel: 124189","Day: 2005-03-12<br /># Vehicles in tunnel: 108370","Day: 2005-03-13<br /># Vehicles in tunnel:  90511","Day: 2005-03-14<br /># Vehicles in tunnel: 109599","Day: 2005-03-15<br /># Vehicles in tunnel: 111848","Day: 2005-03-16<br /># Vehicles in tunnel: 118230","Day: 2005-03-17<br /># Vehicles in tunnel: 119382","Day: 2005-03-18<br /># Vehicles in tunnel: 128255","Day: 2005-03-19<br /># Vehicles in tunnel: 113087","Day: 2005-03-20<br /># Vehicles in tunnel:  95270","Day: 2005-03-21<br /># Vehicles in tunnel: 114051","Day: 2005-03-22<br /># Vehicles in tunnel: 116986","Day: 2005-03-23<br /># Vehicles in tunnel: 124493","Day: 2005-03-24<br /># Vehicles in tunnel: 127354","Day: 2005-03-25<br /># Vehicles in tunnel:  86171","Day: 2005-03-26<br /># Vehicles in tunnel:  97296","Day: 2005-03-27<br /># Vehicles in tunnel:  87922","Day: 2005-03-28<br /># Vehicles in tunnel:  90481","Day: 2005-03-29<br /># Vehicles in tunnel: 116328","Day: 2005-03-30<br /># Vehicles in tunnel: 121326","Day: 2005-03-31<br /># Vehicles in tunnel: 121118","Day: 2005-04-01<br /># Vehicles in tunnel: 129009","Day: 2005-04-02<br /># Vehicles in tunnel: 111132","Day: 2005-04-03<br /># Vehicles in tunnel:  96227","Day: 2005-04-04<br /># Vehicles in tunnel: 114573","Day: 2005-04-05<br /># Vehicles in tunnel: 115811","Day: 2005-04-06<br /># Vehicles in tunnel: 120461","Day: 2005-04-07<br /># Vehicles in tunnel: 120288","Day: 2005-04-08<br /># Vehicles in tunnel: 125310","Day: 2005-04-09<br /># Vehicles in tunnel: 103944","Day: 2005-04-10<br /># Vehicles in tunnel:  91469","Day: 2005-04-11<br /># Vehicles in tunnel: 112007","Day: 2005-04-12<br /># Vehicles in tunnel: 113554","Day: 2005-04-13<br /># Vehicles in tunnel: 116409","Day: 2005-04-14<br /># Vehicles in tunnel: 118531","Day: 2005-04-15<br /># Vehicles in tunnel: 123488","Day: 2005-04-16<br /># Vehicles in tunnel: 100044","Day: 2005-04-17<br /># Vehicles in tunnel:  87253","Day: 2005-04-18<br /># Vehicles in tunnel: 110889","Day: 2005-04-19<br /># Vehicles in tunnel: 113771","Day: 2005-04-20<br /># Vehicles in tunnel: 117451","Day: 2005-04-21<br /># Vehicles in tunnel: 119250","Day: 2005-04-22<br /># Vehicles in tunnel: 126197","Day: 2005-04-23<br /># Vehicles in tunnel: 104666","Day: 2005-04-24<br /># Vehicles in tunnel:  91595","Day: 2005-04-25<br /># Vehicles in tunnel: 112708","Day: 2005-04-26<br /># Vehicles in tunnel: 115921","Day: 2005-04-27<br /># Vehicles in tunnel: 120044","Day: 2005-04-28<br /># Vehicles in tunnel: 122071","Day: 2005-04-29<br /># Vehicles in tunnel: 129401","Day: 2005-04-30<br /># Vehicles in tunnel: 107166","Day: 2005-05-01<br /># Vehicles in tunnel:  94934","Day: 2005-05-02<br /># Vehicles in tunnel: 113264","Day: 2005-05-03<br /># Vehicles in tunnel: 115493","Day: 2005-05-04<br /># Vehicles in tunnel: 126497","Day: 2005-05-05<br /># Vehicles in tunnel:  81910","Day: 2005-05-06<br /># Vehicles in tunnel: 108995","Day: 2005-05-07<br /># Vehicles in tunnel:  97762","Day: 2005-05-08<br /># Vehicles in tunnel: 103213","Day: 2005-05-09<br /># Vehicles in tunnel: 112913","Day: 2005-05-10<br /># Vehicles in tunnel: 114948","Day: 2005-05-11<br /># Vehicles in tunnel: 119588","Day: 2005-05-12<br /># Vehicles in tunnel: 119355","Day: 2005-05-13<br /># Vehicles in tunnel: 129633","Day: 2005-05-14<br /># Vehicles in tunnel: 101264","Day: 2005-05-15<br /># Vehicles in tunnel:  87722","Day: 2005-05-16<br /># Vehicles in tunnel:  86177","Day: 2005-05-17<br /># Vehicles in tunnel: 117634","Day: 2005-05-18<br /># Vehicles in tunnel: 120835","Day: 2005-05-19<br /># Vehicles in tunnel: 121769","Day: 2005-05-20<br /># Vehicles in tunnel: 128446","Day: 2005-05-21<br /># Vehicles in tunnel: 105411","Day: 2005-05-22<br /># Vehicles in tunnel:  90105","Day: 2005-05-23<br /># Vehicles in tunnel: 115380","Day: 2005-05-24<br /># Vehicles in tunnel: 117490","Day: 2005-05-25<br /># Vehicles in tunnel: 124565","Day: 2005-05-26<br /># Vehicles in tunnel: 115479","Day: 2005-05-27<br /># Vehicles in tunnel: 128042","Day: 2005-05-28<br /># Vehicles in tunnel: 106940","Day: 2005-05-29<br /># Vehicles in tunnel:  98251","Day: 2005-05-30<br /># Vehicles in tunnel: 115084","Day: 2005-05-31<br /># Vehicles in tunnel: 116572","Day: 2005-06-01<br /># Vehicles in tunnel: 119382","Day: 2005-06-02<br /># Vehicles in tunnel: 120566","Day: 2005-06-03<br /># Vehicles in tunnel: 127596","Day: 2005-06-04<br /># Vehicles in tunnel: 105138","Day: 2005-06-05<br /># Vehicles in tunnel:  96391","Day: 2005-06-06<br /># Vehicles in tunnel: 113115","Day: 2005-06-07<br /># Vehicles in tunnel: 116348","Day: 2005-06-08<br /># Vehicles in tunnel: 120433","Day: 2005-06-09<br /># Vehicles in tunnel: 121204","Day: 2005-06-10<br /># Vehicles in tunnel: 129282","Day: 2005-06-11<br /># Vehicles in tunnel: 107096","Day: 2005-06-12<br /># Vehicles in tunnel:  97622","Day: 2005-06-13<br /># Vehicles in tunnel: 115042","Day: 2005-06-14<br /># Vehicles in tunnel: 116187","Day: 2005-06-15<br /># Vehicles in tunnel: 121635","Day: 2005-06-16<br /># Vehicles in tunnel: 124340","Day: 2005-06-17<br /># Vehicles in tunnel: 131031","Day: 2005-06-18<br /># Vehicles in tunnel: 108944","Day: 2005-06-19<br /># Vehicles in tunnel:  98758","Day: 2005-06-20<br /># Vehicles in tunnel: 115087","Day: 2005-06-21<br /># Vehicles in tunnel: 115261","Day: 2005-06-22<br /># Vehicles in tunnel: 123895","Day: 2005-06-23<br /># Vehicles in tunnel: 123366","Day: 2005-06-24<br /># Vehicles in tunnel: 128982","Day: 2005-06-25<br /># Vehicles in tunnel: 107271","Day: 2005-06-26<br /># Vehicles in tunnel:  95851","Day: 2005-06-27<br /># Vehicles in tunnel: 116698","Day: 2005-06-28<br /># Vehicles in tunnel: 115929","Day: 2005-06-29<br /># Vehicles in tunnel: 121116","Day: 2005-06-30<br /># Vehicles in tunnel: 125353","Day: 2005-07-01<br /># Vehicles in tunnel: 133250","Day: 2005-07-02<br /># Vehicles in tunnel: 109585","Day: 2005-07-03<br /># Vehicles in tunnel:  96375","Day: 2005-07-04<br /># Vehicles in tunnel: 113769","Day: 2005-07-05<br /># Vehicles in tunnel: 116471","Day: 2005-07-06<br /># Vehicles in tunnel: 117421","Day: 2005-07-07<br /># Vehicles in tunnel: 119848","Day: 2005-07-08<br /># Vehicles in tunnel: 125162","Day: 2005-07-09<br /># Vehicles in tunnel: 102040","Day: 2005-07-10<br /># Vehicles in tunnel:  93008","Day: 2005-07-11<br /># Vehicles in tunnel: 112064","Day: 2005-07-12<br /># Vehicles in tunnel: 111813","Day: 2005-07-13<br /># Vehicles in tunnel: 114745","Day: 2005-07-14<br /># Vehicles in tunnel: 116090","Day: 2005-07-15<br /># Vehicles in tunnel: 122300","Day: 2005-07-16<br /># Vehicles in tunnel: 101013","Day: 2005-07-17<br /># Vehicles in tunnel:  89492","Day: 2005-07-18<br /># Vehicles in tunnel: 111071","Day: 2005-07-19<br /># Vehicles in tunnel: 107705","Day: 2005-07-20<br /># Vehicles in tunnel: 108943","Day: 2005-07-21<br /># Vehicles in tunnel: 110562","Day: 2005-07-22<br /># Vehicles in tunnel: 116944","Day: 2005-07-23<br /># Vehicles in tunnel:  97075","Day: 2005-07-24<br /># Vehicles in tunnel:  84374","Day: 2005-07-25<br /># Vehicles in tunnel: 103595","Day: 2005-07-26<br /># Vehicles in tunnel: 104704","Day: 2005-07-27<br /># Vehicles in tunnel: 106882","Day: 2005-07-28<br /># Vehicles in tunnel: 107520","Day: 2005-07-29<br /># Vehicles in tunnel: 116673","Day: 2005-07-30<br /># Vehicles in tunnel: 100699","Day: 2005-07-31<br /># Vehicles in tunnel:  84502","Day: 2005-08-01<br /># Vehicles in tunnel:  72614","Day: 2005-08-02<br /># Vehicles in tunnel: 110359","Day: 2005-08-03<br /># Vehicles in tunnel: 110603","Day: 2005-08-04<br /># Vehicles in tunnel: 113722","Day: 2005-08-05<br /># Vehicles in tunnel: 119009","Day: 2005-08-06<br /># Vehicles in tunnel: 102012","Day: 2005-08-07<br /># Vehicles in tunnel:  90521","Day: 2005-08-08<br /># Vehicles in tunnel: 111027","Day: 2005-08-09<br /># Vehicles in tunnel: 113565","Day: 2005-08-10<br /># Vehicles in tunnel: 118494","Day: 2005-08-11<br /># Vehicles in tunnel: 118515","Day: 2005-08-12<br /># Vehicles in tunnel: 129253","Day: 2005-08-13<br /># Vehicles in tunnel: 110948","Day: 2005-08-14<br /># Vehicles in tunnel: 100364","Day: 2005-08-15<br /># Vehicles in tunnel: 116032","Day: 2005-08-16<br /># Vehicles in tunnel: 116287","Day: 2005-08-17<br /># Vehicles in tunnel: 120706","Day: 2005-08-18<br /># Vehicles in tunnel: 121582","Day: 2005-08-19<br /># Vehicles in tunnel: 130141","Day: 2005-08-20<br /># Vehicles in tunnel: 112162","Day: 2005-08-21<br /># Vehicles in tunnel:  95294","Day: 2005-08-22<br /># Vehicles in tunnel: 114273","Day: 2005-08-23<br /># Vehicles in tunnel: 119640","Day: 2005-08-24<br /># Vehicles in tunnel: 123666","Day: 2005-08-25<br /># Vehicles in tunnel: 128274","Day: 2005-08-26<br /># Vehicles in tunnel: 139840","Day: 2005-08-27<br /># Vehicles in tunnel: 122379","Day: 2005-08-28<br /># Vehicles in tunnel: 104101","Day: 2005-08-29<br /># Vehicles in tunnel: 116825","Day: 2005-08-30<br /># Vehicles in tunnel: 117562","Day: 2005-08-31<br /># Vehicles in tunnel: 119893","Day: 2005-09-01<br /># Vehicles in tunnel: 121723","Day: 2005-09-02<br /># Vehicles in tunnel: 127877","Day: 2005-09-03<br /># Vehicles in tunnel: 113551","Day: 2005-09-04<br /># Vehicles in tunnel:  98545","Day: 2005-09-05<br /># Vehicles in tunnel: 114681","Day: 2005-09-06<br /># Vehicles in tunnel: 114318","Day: 2005-09-07<br /># Vehicles in tunnel: 118455","Day: 2005-09-08<br /># Vehicles in tunnel: 120824","Day: 2005-09-09<br /># Vehicles in tunnel: 128273","Day: 2005-09-10<br /># Vehicles in tunnel: 108605","Day: 2005-09-11<br /># Vehicles in tunnel:  96555","Day: 2005-09-12<br /># Vehicles in tunnel: 113244","Day: 2005-09-13<br /># Vehicles in tunnel: 114575","Day: 2005-09-14<br /># Vehicles in tunnel: 116712","Day: 2005-09-15<br /># Vehicles in tunnel: 120260","Day: 2005-09-16<br /># Vehicles in tunnel: 127790","Day: 2005-09-17<br /># Vehicles in tunnel: 109287","Day: 2005-09-18<br /># Vehicles in tunnel:  92052","Day: 2005-09-19<br /># Vehicles in tunnel: 112624","Day: 2005-09-20<br /># Vehicles in tunnel: 115000","Day: 2005-09-21<br /># Vehicles in tunnel: 119110","Day: 2005-09-22<br /># Vehicles in tunnel: 120223","Day: 2005-09-23<br /># Vehicles in tunnel: 126570","Day: 2005-09-24<br /># Vehicles in tunnel: 111370","Day: 2005-09-25<br /># Vehicles in tunnel:  98189","Day: 2005-09-26<br /># Vehicles in tunnel: 113779","Day: 2005-09-27<br /># Vehicles in tunnel: 115827","Day: 2005-09-28<br /># Vehicles in tunnel: 122445","Day: 2005-09-29<br /># Vehicles in tunnel: 121893","Day: 2005-09-30<br /># Vehicles in tunnel: 131419","Day: 2005-10-01<br /># Vehicles in tunnel: 111808","Day: 2005-10-02<br /># Vehicles in tunnel:  93627","Day: 2005-10-03<br /># Vehicles in tunnel: 113190","Day: 2005-10-04<br /># Vehicles in tunnel: 111446","Day: 2005-10-05<br /># Vehicles in tunnel: 113284","Day: 2005-10-06<br /># Vehicles in tunnel: 115066","Day: 2005-10-07<br /># Vehicles in tunnel: 121956","Day: 2005-10-08<br /># Vehicles in tunnel: 103183","Day: 2005-10-09<br /># Vehicles in tunnel:  94668","Day: 2005-10-10<br /># Vehicles in tunnel: 110714","Day: 2005-10-11<br /># Vehicles in tunnel: 112019","Day: 2005-10-12<br /># Vehicles in tunnel: 113990","Day: 2005-10-13<br /># Vehicles in tunnel: 116613","Day: 2005-10-14<br /># Vehicles in tunnel: 121966","Day: 2005-10-15<br /># Vehicles in tunnel: 104734","Day: 2005-10-16<br /># Vehicles in tunnel:  93587","Day: 2005-10-17<br /># Vehicles in tunnel: 112944","Day: 2005-10-18<br /># Vehicles in tunnel: 114643","Day: 2005-10-19<br /># Vehicles in tunnel: 118033","Day: 2005-10-20<br /># Vehicles in tunnel: 121717","Day: 2005-10-21<br /># Vehicles in tunnel: 127012","Day: 2005-10-22<br /># Vehicles in tunnel: 103776","Day: 2005-10-23<br /># Vehicles in tunnel:  89657","Day: 2005-10-24<br /># Vehicles in tunnel: 113247","Day: 2005-10-25<br /># Vehicles in tunnel: 116713","Day: 2005-10-26<br /># Vehicles in tunnel: 121010","Day: 2005-10-27<br /># Vehicles in tunnel: 123814","Day: 2005-10-28<br /># Vehicles in tunnel: 132332","Day: 2005-10-29<br /># Vehicles in tunnel: 112413","Day: 2005-10-30<br /># Vehicles in tunnel:  97626","Day: 2005-10-31<br /># Vehicles in tunnel: 116393","Day: 2005-11-01<br /># Vehicles in tunnel: 117629","Day: 2005-11-02<br /># Vehicles in tunnel: 117854","Day: 2005-11-03<br /># Vehicles in tunnel: 122053","Day: 2005-11-04<br /># Vehicles in tunnel: 126866","Day: 2005-11-05<br /># Vehicles in tunnel: 107386","Day: 2005-11-06<br /># Vehicles in tunnel:  98226","Day: 2005-11-07<br /># Vehicles in tunnel: 113398","Day: 2005-11-08<br /># Vehicles in tunnel: 113682","Day: 2005-11-09<br /># Vehicles in tunnel: 116443","Day: 2005-11-10<br /># Vehicles in tunnel: 119386","Day: 2005-11-11<br /># Vehicles in tunnel: 126650","Day: 2005-11-12<br /># Vehicles in tunnel: 104646","Day: 2005-11-13<br /># Vehicles in tunnel:  94424","Day: 2005-11-14<br /># Vehicles in tunnel: 112165","Day: 2005-11-15<br /># Vehicles in tunnel: 114296","Day: 2005-11-16<br /># Vehicles in tunnel: 114690"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,139,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":60.639269406392714},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1064422080,1135321920],"tickmode":"array","ticktext":["2004-01","2004-07","2005-01","2005-07"],"tickvals":[1072915200,1088640000,1104537600,1120176000],"categoryorder":"array","categoryarray":["2004-01","2004-07","2005-01","2005-07"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"y","title":{"text":"Day","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[48760.900000000001,144177.10000000001],"tickmode":"array","ticktext":["50000","75000","100000","125000"],"tickvals":[50000,75000,100000,125000],"categoryorder":"array","categoryarray":["50000","75000","100000","125000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"x","title":{"text":"# Vehicles in tunnel","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"55883adbcff7":{"x":{},"y":{},"type":"scatter"}},"cur_data":"55883adbcff7","visdat":{"55883adbcff7":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>This plot doesn’t match the one in the textbook, but I’ve chosen it because it is also effective for comparing the annual traffic volumes, and is easy to produce using the <code>gg_season</code> function from the fpp3 library. The text bookplot can be reproduced using standard ggplot2 functions (with <code>facet_wrap()</code>). ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>monthly_traffic <span class="ot">&lt;-</span> TunnelTraffic <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">yearmonth</span>(Day)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">vehicles =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at"># Vehicles in tunnel</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Month) </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>traffic_plt <span class="ot">&lt;-</span> monthly_traffic <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(vehicles) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Baregg Tunnel Traffic'</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Average # of Vehicles/Month'</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(traffic_plt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-94a3d15ffb3ff58edc2b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-94a3d15ffb3ff58edc2b">{"x":{"data":[{"x":[1400,1430],"y":[102351,96662.451612903227],"text":["Month: 1973 Nov<br />vehicles: 102351.00<br />unclass(id): 1<br />id: 2003","Month: 1973 Dec<br />vehicles:  96662.45<br />unclass(id): 1<br />id: 2003"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1096,1127,1155,1186,1216,1247,1277,1308,1339,1369,1400,1430],"y":[90544.612903225803,97847.620689655174,105062.41935483871,102392.7,102854.83870967742,106020.8,101646.48387096774,108867.51612903226,112882.83333333333,111033.19354838709,109927.89999999999,105672],"text":["Month: 1973 Jan<br />vehicles:  90544.61<br />unclass(id): 2<br />id: 2004","Month: 1973 Feb<br />vehicles:  97847.62<br />unclass(id): 2<br />id: 2004","Month: 1973 Mar<br />vehicles: 105062.42<br />unclass(id): 2<br />id: 2004","Month: 1973 Apr<br />vehicles: 102392.70<br />unclass(id): 2<br />id: 2004","Month: 1973 May<br />vehicles: 102854.84<br />unclass(id): 2<br />id: 2004","Month: 1973 Jun<br />vehicles: 106020.80<br />unclass(id): 2<br />id: 2004","Month: 1973 Jul<br />vehicles: 101646.48<br />unclass(id): 2<br />id: 2004","Month: 1973 Aug<br />vehicles: 108867.52<br />unclass(id): 2<br />id: 2004","Month: 1973 Sep<br />vehicles: 112882.83<br />unclass(id): 2<br />id: 2004","Month: 1973 Oct<br />vehicles: 111033.19<br />unclass(id): 2<br />id: 2004","Month: 1973 Nov<br />vehicles: 109927.90<br />unclass(id): 2<br />id: 2004","Month: 1973 Dec<br />vehicles: 105672.00<br />unclass(id): 2<br />id: 2004"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,193,159,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1096,1127,1155,1186,1216,1247,1277,1308,1339,1369,1400],"y":[99077.322580645166,101316.60714285714,109710.48387096774,113021.33333333333,110828.09677419355,115963.96666666666,108248.22580645161,114182.67741935483,115525.86666666667,112038.09677419355,113737.125],"text":["Month: 1973 Jan<br />vehicles:  99077.32<br />unclass(id): 3<br />id: 2005","Month: 1973 Feb<br />vehicles: 101316.61<br />unclass(id): 3<br />id: 2005","Month: 1973 Mar<br />vehicles: 109710.48<br />unclass(id): 3<br />id: 2005","Month: 1973 Apr<br />vehicles: 113021.33<br />unclass(id): 3<br />id: 2005","Month: 1973 May<br />vehicles: 110828.10<br />unclass(id): 3<br />id: 2005","Month: 1973 Jun<br />vehicles: 115963.97<br />unclass(id): 3<br />id: 2005","Month: 1973 Jul<br />vehicles: 108248.23<br />unclass(id): 3<br />id: 2005","Month: 1973 Aug<br />vehicles: 114182.68<br />unclass(id): 3<br />id: 2005","Month: 1973 Sep<br />vehicles: 115525.87<br />unclass(id): 3<br />id: 2005","Month: 1973 Oct<br />vehicles: 112038.10<br />unclass(id): 3<br />id: 2005","Month: 1973 Nov<br />vehicles: 113737.12<br />unclass(id): 3<br />id: 2005"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,97,195,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826498,"l":60.639269406392714},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Baregg Tunnel Traffic","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1079.3,1446.7],"tickmode":"array","ticktext":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"tickvals":[1096,1127,1155,1186,1216,1247,1277,1308,1339,1369,1400,1430],"categoryorder":"array","categoryarray":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Month","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[89273.645215053766,117234.9343548387],"tickmode":"array","ticktext":["90000","100000","110000"],"tickvals":[90000,100000,110000],"categoryorder":"array","categoryarray":["90000","100000","110000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Average # of Vehicles/Month","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"558810718d2e":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"558810718d2e","visdat":{"558810718d2e":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<p>:::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tt_wday_plt <span class="ot">&lt;-</span> TunnelTraffic <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Day of Week</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">weekdays</span>(Day)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Day, <span class="st">`</span><span class="at"># Vehicles in tunnel</span><span class="st">`</span>, <span class="at">color =</span> <span class="st">`</span><span class="at">Day of Week</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(tt_wday_plt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-189a52697a7aea72742a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-189a52697a7aea72742a">{"x":{"data":[{"x":[1068163200,1068768000,1069372800,1069977600,1070582400,1071187200,1071792000,1072396800,1073001600,1073606400,1074211200,1074816000,1075420800,1076025600,1076630400,1077235200,1077840000,1078444800,1079049600,1079654400,1080259200,1080864000,1081468800,1082073600,1082678400,1083283200,1083888000,1084492800,1085097600,1085702400,1086307200,1086912000,1087516800,1088121600,1088726400,1089331200,1089936000,1090540800,1091145600,1091750400,1092355200,1092960000,1093564800,1094169600,1094774400,1095379200,1095984000,1096588800,1097193600,1097798400,1098403200,1099008000,1099612800,1100217600,1100822400,1101427200,1102032000,1102636800,1103241600,1103846400,1104451200,1105056000,1105660800,1106265600,1106870400,1107475200,1108080000,1108684800,1109289600,1109894400,1110499200,1111104000,1111708800,1112313600,1112918400,1113523200,1114128000,1114732800,1115337600,1115942400,1116547200,1117152000,1117756800,1118361600,1118966400,1119571200,1120176000,1120780800,1121385600,1121990400,1122595200,1123200000,1123804800,1124409600,1125014400,1125619200,1126224000,1126828800,1127433600,1128038400,1128643200,1129248000,1129852800,1130457600,1131062400,1131667200],"y":[113111,113588,115567,115048,113805,114801,115991,79697,62895,103527,107845,113448,105640,110229,109063,115648,115352,114861,118280,115030,119509,118536,81981,112033,113525,117628,115044,117470,99979,121513,116871,115401,120484,119767,120623,115837,111294,107933,111487,121901,122277,124403,125895,127753,124446,126060,125499,123690,121097,124538,124059,129619,122436,121941,121682,126006,123787,123042,124286,96327,77596,109537,117427,117858,116543,116148,116802,115357,119054,120868,124189,128255,86171,129009,125310,123488,126197,129401,108995,129633,128446,128042,127596,129282,131031,128982,133250,125162,122300,116944,116673,119009,129253,130141,139840,127877,128273,127790,126570,131419,121956,121966,127012,132332,126866,126650],"text":["Day: 2003-11-07<br /># Vehicles in tunnel: 113111<br />Day of Week: Friday","Day: 2003-11-14<br /># Vehicles in tunnel: 113588<br />Day of Week: Friday","Day: 2003-11-21<br /># Vehicles in tunnel: 115567<br />Day of Week: Friday","Day: 2003-11-28<br /># Vehicles in tunnel: 115048<br />Day of Week: Friday","Day: 2003-12-05<br /># Vehicles in tunnel: 113805<br />Day of Week: Friday","Day: 2003-12-12<br /># Vehicles in tunnel: 114801<br />Day of Week: Friday","Day: 2003-12-19<br /># Vehicles in tunnel: 115991<br />Day of Week: Friday","Day: 2003-12-26<br /># Vehicles in tunnel:  79697<br />Day of Week: Friday","Day: 2004-01-02<br /># Vehicles in tunnel:  62895<br />Day of Week: Friday","Day: 2004-01-09<br /># Vehicles in tunnel: 103527<br />Day of Week: Friday","Day: 2004-01-16<br /># Vehicles in tunnel: 107845<br />Day of Week: Friday","Day: 2004-01-23<br /># Vehicles in tunnel: 113448<br />Day of Week: Friday","Day: 2004-01-30<br /># Vehicles in tunnel: 105640<br />Day of Week: Friday","Day: 2004-02-06<br /># Vehicles in tunnel: 110229<br />Day of Week: Friday","Day: 2004-02-13<br /># Vehicles in tunnel: 109063<br />Day of Week: Friday","Day: 2004-02-20<br /># Vehicles in tunnel: 115648<br />Day of Week: Friday","Day: 2004-02-27<br /># Vehicles in tunnel: 115352<br />Day of Week: Friday","Day: 2004-03-05<br /># Vehicles in tunnel: 114861<br />Day of Week: Friday","Day: 2004-03-12<br /># Vehicles in tunnel: 118280<br />Day of Week: Friday","Day: 2004-03-19<br /># Vehicles in tunnel: 115030<br />Day of Week: Friday","Day: 2004-03-26<br /># Vehicles in tunnel: 119509<br />Day of Week: Friday","Day: 2004-04-02<br /># Vehicles in tunnel: 118536<br />Day of Week: Friday","Day: 2004-04-09<br /># Vehicles in tunnel:  81981<br />Day of Week: Friday","Day: 2004-04-16<br /># Vehicles in tunnel: 112033<br />Day of Week: Friday","Day: 2004-04-23<br /># Vehicles in tunnel: 113525<br />Day of Week: Friday","Day: 2004-04-30<br /># Vehicles in tunnel: 117628<br />Day of Week: Friday","Day: 2004-05-07<br /># Vehicles in tunnel: 115044<br />Day of Week: Friday","Day: 2004-05-14<br /># Vehicles in tunnel: 117470<br />Day of Week: Friday","Day: 2004-05-21<br /># Vehicles in tunnel:  99979<br />Day of Week: Friday","Day: 2004-05-28<br /># Vehicles in tunnel: 121513<br />Day of Week: Friday","Day: 2004-06-04<br /># Vehicles in tunnel: 116871<br />Day of Week: Friday","Day: 2004-06-11<br /># Vehicles in tunnel: 115401<br />Day of Week: Friday","Day: 2004-06-18<br /># Vehicles in tunnel: 120484<br />Day of Week: Friday","Day: 2004-06-25<br /># Vehicles in tunnel: 119767<br />Day of Week: Friday","Day: 2004-07-02<br /># Vehicles in tunnel: 120623<br />Day of Week: Friday","Day: 2004-07-09<br /># Vehicles in tunnel: 115837<br />Day of Week: Friday","Day: 2004-07-16<br /># Vehicles in tunnel: 111294<br />Day of Week: Friday","Day: 2004-07-23<br /># Vehicles in tunnel: 107933<br />Day of Week: Friday","Day: 2004-07-30<br /># Vehicles in tunnel: 111487<br />Day of Week: Friday","Day: 2004-08-06<br /># Vehicles in tunnel: 121901<br />Day of Week: Friday","Day: 2004-08-13<br /># Vehicles in tunnel: 122277<br />Day of Week: Friday","Day: 2004-08-20<br /># Vehicles in tunnel: 124403<br />Day of Week: Friday","Day: 2004-08-27<br /># Vehicles in tunnel: 125895<br />Day of Week: Friday","Day: 2004-09-03<br /># Vehicles in tunnel: 127753<br />Day of Week: Friday","Day: 2004-09-10<br /># Vehicles in tunnel: 124446<br />Day of Week: Friday","Day: 2004-09-17<br /># Vehicles in tunnel: 126060<br />Day of Week: Friday","Day: 2004-09-24<br /># Vehicles in tunnel: 125499<br />Day of Week: Friday","Day: 2004-10-01<br /># Vehicles in tunnel: 123690<br />Day of Week: Friday","Day: 2004-10-08<br /># Vehicles in tunnel: 121097<br />Day of Week: Friday","Day: 2004-10-15<br /># Vehicles in tunnel: 124538<br />Day of Week: Friday","Day: 2004-10-22<br /># Vehicles in tunnel: 124059<br />Day of Week: Friday","Day: 2004-10-29<br /># Vehicles in tunnel: 129619<br />Day of Week: Friday","Day: 2004-11-05<br /># Vehicles in tunnel: 122436<br />Day of Week: Friday","Day: 2004-11-12<br /># Vehicles in tunnel: 121941<br />Day of Week: Friday","Day: 2004-11-19<br /># Vehicles in tunnel: 121682<br />Day of Week: Friday","Day: 2004-11-26<br /># Vehicles in tunnel: 126006<br />Day of Week: Friday","Day: 2004-12-03<br /># Vehicles in tunnel: 123787<br />Day of Week: Friday","Day: 2004-12-10<br /># Vehicles in tunnel: 123042<br />Day of Week: Friday","Day: 2004-12-17<br /># Vehicles in tunnel: 124286<br />Day of Week: Friday","Day: 2004-12-24<br /># Vehicles in tunnel:  96327<br />Day of Week: Friday","Day: 2004-12-31<br /># Vehicles in tunnel:  77596<br />Day of Week: Friday","Day: 2005-01-07<br /># Vehicles in tunnel: 109537<br />Day of Week: Friday","Day: 2005-01-14<br /># Vehicles in tunnel: 117427<br />Day of Week: Friday","Day: 2005-01-21<br /># Vehicles in tunnel: 117858<br />Day of Week: Friday","Day: 2005-01-28<br /># Vehicles in tunnel: 116543<br />Day of Week: Friday","Day: 2005-02-04<br /># Vehicles in tunnel: 116148<br />Day of Week: Friday","Day: 2005-02-11<br /># Vehicles in tunnel: 116802<br />Day of Week: Friday","Day: 2005-02-18<br /># Vehicles in tunnel: 115357<br />Day of Week: Friday","Day: 2005-02-25<br /># Vehicles in tunnel: 119054<br />Day of Week: Friday","Day: 2005-03-04<br /># Vehicles in tunnel: 120868<br />Day of Week: Friday","Day: 2005-03-11<br /># Vehicles in tunnel: 124189<br />Day of Week: Friday","Day: 2005-03-18<br /># Vehicles in tunnel: 128255<br />Day of Week: Friday","Day: 2005-03-25<br /># Vehicles in tunnel:  86171<br />Day of Week: Friday","Day: 2005-04-01<br /># Vehicles in tunnel: 129009<br />Day of Week: Friday","Day: 2005-04-08<br /># Vehicles in tunnel: 125310<br />Day of Week: Friday","Day: 2005-04-15<br /># Vehicles in tunnel: 123488<br />Day of Week: Friday","Day: 2005-04-22<br /># Vehicles in tunnel: 126197<br />Day of Week: Friday","Day: 2005-04-29<br /># Vehicles in tunnel: 129401<br />Day of Week: Friday","Day: 2005-05-06<br /># Vehicles in tunnel: 108995<br />Day of Week: Friday","Day: 2005-05-13<br /># Vehicles in tunnel: 129633<br />Day of Week: Friday","Day: 2005-05-20<br /># Vehicles in tunnel: 128446<br />Day of Week: Friday","Day: 2005-05-27<br /># Vehicles in tunnel: 128042<br />Day of Week: Friday","Day: 2005-06-03<br /># Vehicles in tunnel: 127596<br />Day of Week: Friday","Day: 2005-06-10<br /># Vehicles in tunnel: 129282<br />Day of Week: Friday","Day: 2005-06-17<br /># Vehicles in tunnel: 131031<br />Day of Week: Friday","Day: 2005-06-24<br /># Vehicles in tunnel: 128982<br />Day of Week: Friday","Day: 2005-07-01<br /># Vehicles in tunnel: 133250<br />Day of Week: Friday","Day: 2005-07-08<br /># Vehicles in tunnel: 125162<br />Day of Week: Friday","Day: 2005-07-15<br /># Vehicles in tunnel: 122300<br />Day of Week: Friday","Day: 2005-07-22<br /># Vehicles in tunnel: 116944<br />Day of Week: Friday","Day: 2005-07-29<br /># Vehicles in tunnel: 116673<br />Day of Week: Friday","Day: 2005-08-05<br /># Vehicles in tunnel: 119009<br />Day of Week: Friday","Day: 2005-08-12<br /># Vehicles in tunnel: 129253<br />Day of Week: Friday","Day: 2005-08-19<br /># Vehicles in tunnel: 130141<br />Day of Week: Friday","Day: 2005-08-26<br /># Vehicles in tunnel: 139840<br />Day of Week: Friday","Day: 2005-09-02<br /># Vehicles in tunnel: 127877<br />Day of Week: Friday","Day: 2005-09-09<br /># Vehicles in tunnel: 128273<br />Day of Week: Friday","Day: 2005-09-16<br /># Vehicles in tunnel: 127790<br />Day of Week: Friday","Day: 2005-09-23<br /># Vehicles in tunnel: 126570<br />Day of Week: Friday","Day: 2005-09-30<br /># Vehicles in tunnel: 131419<br />Day of Week: Friday","Day: 2005-10-07<br /># Vehicles in tunnel: 121956<br />Day of Week: Friday","Day: 2005-10-14<br /># Vehicles in tunnel: 121966<br />Day of Week: Friday","Day: 2005-10-21<br /># Vehicles in tunnel: 127012<br />Day of Week: Friday","Day: 2005-10-28<br /># Vehicles in tunnel: 132332<br />Day of Week: Friday","Day: 2005-11-04<br /># Vehicles in tunnel: 126866<br />Day of Week: Friday","Day: 2005-11-11<br /># Vehicles in tunnel: 126650<br />Day of Week: Friday"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Friday","legendgroup":"Friday","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1067817600,1068422400,1069027200,1069632000,1070236800,1070841600,1071446400,1072051200,1072656000,1073260800,1073865600,1074470400,1075075200,1075680000,1076284800,1076889600,1077494400,1078099200,1078704000,1079308800,1079913600,1080518400,1081123200,1081728000,1082332800,1082937600,1083542400,1084147200,1084752000,1085356800,1085961600,1086566400,1087171200,1087776000,1088380800,1088985600,1089590400,1090195200,1090800000,1091404800,1092009600,1092614400,1093219200,1093824000,1094428800,1095033600,1095638400,1096243200,1096848000,1097452800,1098057600,1098662400,1099267200,1099872000,1100476800,1101081600,1101686400,1102291200,1102896000,1103500800,1104105600,1104710400,1105315200,1105920000,1106524800,1107129600,1107734400,1108339200,1108944000,1109548800,1110153600,1110758400,1111363200,1111968000,1112572800,1113177600,1113782400,1114387200,1114992000,1115596800,1116201600,1116806400,1117411200,1118016000,1118620800,1119225600,1119830400,1120435200,1121040000,1121644800,1122249600,1122854400,1123459200,1124064000,1124668800,1125273600,1125878400,1126483200,1127088000,1127692800,1128297600,1128902400,1129507200,1130112000,1130716800,1131321600,1131926400],"y":[100795,99194,99770,102773,101716,104140,102585,95771,85261,85305,93447,97604,91946,94744,93971,97986,88331,101010,101613,100617,101895,106440,107382,77578,103383,103502,102423,103312,101511,104688,81597,103733,103685,103136,106979,106387,100565,98319,97542,102841,105725,109242,110270,109557,112399,110455,110453,109457,108771,110364,110163,110952,114727,109257,110950,109773,110123,110077,110925,106888,92187,91821,101816,106252,93752,101919,100356,97551,100679,104728,106022,109599,114051,90481,114573,112007,110889,112708,113264,112913,86177,115380,115084,113115,115042,115087,116698,113769,112064,111071,103595,72614,111027,116032,114273,116825,114681,113244,112624,113779,113190,110714,112944,113247,116393,113398,112165],"text":["Day: 2003-11-03<br /># Vehicles in tunnel: 100795<br />Day of Week: Monday","Day: 2003-11-10<br /># Vehicles in tunnel:  99194<br />Day of Week: Monday","Day: 2003-11-17<br /># Vehicles in tunnel:  99770<br />Day of Week: Monday","Day: 2003-11-24<br /># Vehicles in tunnel: 102773<br />Day of Week: Monday","Day: 2003-12-01<br /># Vehicles in tunnel: 101716<br />Day of Week: Monday","Day: 2003-12-08<br /># Vehicles in tunnel: 104140<br />Day of Week: Monday","Day: 2003-12-15<br /># Vehicles in tunnel: 102585<br />Day of Week: Monday","Day: 2003-12-22<br /># Vehicles in tunnel:  95771<br />Day of Week: Monday","Day: 2003-12-29<br /># Vehicles in tunnel:  85261<br />Day of Week: Monday","Day: 2004-01-05<br /># Vehicles in tunnel:  85305<br />Day of Week: Monday","Day: 2004-01-12<br /># Vehicles in tunnel:  93447<br />Day of Week: Monday","Day: 2004-01-19<br /># Vehicles in tunnel:  97604<br />Day of Week: Monday","Day: 2004-01-26<br /># Vehicles in tunnel:  91946<br />Day of Week: Monday","Day: 2004-02-02<br /># Vehicles in tunnel:  94744<br />Day of Week: Monday","Day: 2004-02-09<br /># Vehicles in tunnel:  93971<br />Day of Week: Monday","Day: 2004-02-16<br /># Vehicles in tunnel:  97986<br />Day of Week: Monday","Day: 2004-02-23<br /># Vehicles in tunnel:  88331<br />Day of Week: Monday","Day: 2004-03-01<br /># Vehicles in tunnel: 101010<br />Day of Week: Monday","Day: 2004-03-08<br /># Vehicles in tunnel: 101613<br />Day of Week: Monday","Day: 2004-03-15<br /># Vehicles in tunnel: 100617<br />Day of Week: Monday","Day: 2004-03-22<br /># Vehicles in tunnel: 101895<br />Day of Week: Monday","Day: 2004-03-29<br /># Vehicles in tunnel: 106440<br />Day of Week: Monday","Day: 2004-04-05<br /># Vehicles in tunnel: 107382<br />Day of Week: Monday","Day: 2004-04-12<br /># Vehicles in tunnel:  77578<br />Day of Week: Monday","Day: 2004-04-19<br /># Vehicles in tunnel: 103383<br />Day of Week: Monday","Day: 2004-04-26<br /># Vehicles in tunnel: 103502<br />Day of Week: Monday","Day: 2004-05-03<br /># Vehicles in tunnel: 102423<br />Day of Week: Monday","Day: 2004-05-10<br /># Vehicles in tunnel: 103312<br />Day of Week: Monday","Day: 2004-05-17<br /># Vehicles in tunnel: 101511<br />Day of Week: Monday","Day: 2004-05-24<br /># Vehicles in tunnel: 104688<br />Day of Week: Monday","Day: 2004-05-31<br /># Vehicles in tunnel:  81597<br />Day of Week: Monday","Day: 2004-06-07<br /># Vehicles in tunnel: 103733<br />Day of Week: Monday","Day: 2004-06-14<br /># Vehicles in tunnel: 103685<br />Day of Week: Monday","Day: 2004-06-21<br /># Vehicles in tunnel: 103136<br />Day of Week: Monday","Day: 2004-06-28<br /># Vehicles in tunnel: 106979<br />Day of Week: Monday","Day: 2004-07-05<br /># Vehicles in tunnel: 106387<br />Day of Week: Monday","Day: 2004-07-12<br /># Vehicles in tunnel: 100565<br />Day of Week: Monday","Day: 2004-07-19<br /># Vehicles in tunnel:  98319<br />Day of Week: Monday","Day: 2004-07-26<br /># Vehicles in tunnel:  97542<br />Day of Week: Monday","Day: 2004-08-02<br /># Vehicles in tunnel: 102841<br />Day of Week: Monday","Day: 2004-08-09<br /># Vehicles in tunnel: 105725<br />Day of Week: Monday","Day: 2004-08-16<br /># Vehicles in tunnel: 109242<br />Day of Week: Monday","Day: 2004-08-23<br /># Vehicles in tunnel: 110270<br />Day of Week: Monday","Day: 2004-08-30<br /># Vehicles in tunnel: 109557<br />Day of Week: Monday","Day: 2004-09-06<br /># Vehicles in tunnel: 112399<br />Day of Week: Monday","Day: 2004-09-13<br /># Vehicles in tunnel: 110455<br />Day of Week: Monday","Day: 2004-09-20<br /># Vehicles in tunnel: 110453<br />Day of Week: Monday","Day: 2004-09-27<br /># Vehicles in tunnel: 109457<br />Day of Week: Monday","Day: 2004-10-04<br /># Vehicles in tunnel: 108771<br />Day of Week: Monday","Day: 2004-10-11<br /># Vehicles in tunnel: 110364<br />Day of Week: Monday","Day: 2004-10-18<br /># Vehicles in tunnel: 110163<br />Day of Week: Monday","Day: 2004-10-25<br /># Vehicles in tunnel: 110952<br />Day of Week: Monday","Day: 2004-11-01<br /># Vehicles in tunnel: 114727<br />Day of Week: Monday","Day: 2004-11-08<br /># Vehicles in tunnel: 109257<br />Day of Week: Monday","Day: 2004-11-15<br /># Vehicles in tunnel: 110950<br />Day of Week: Monday","Day: 2004-11-22<br /># Vehicles in tunnel: 109773<br />Day of Week: Monday","Day: 2004-11-29<br /># Vehicles in tunnel: 110123<br />Day of Week: Monday","Day: 2004-12-06<br /># Vehicles in tunnel: 110077<br />Day of Week: Monday","Day: 2004-12-13<br /># Vehicles in tunnel: 110925<br />Day of Week: Monday","Day: 2004-12-20<br /># Vehicles in tunnel: 106888<br />Day of Week: Monday","Day: 2004-12-27<br /># Vehicles in tunnel:  92187<br />Day of Week: Monday","Day: 2005-01-03<br /># Vehicles in tunnel:  91821<br />Day of Week: Monday","Day: 2005-01-10<br /># Vehicles in tunnel: 101816<br />Day of Week: Monday","Day: 2005-01-17<br /># Vehicles in tunnel: 106252<br />Day of Week: Monday","Day: 2005-01-24<br /># Vehicles in tunnel:  93752<br />Day of Week: Monday","Day: 2005-01-31<br /># Vehicles in tunnel: 101919<br />Day of Week: Monday","Day: 2005-02-07<br /># Vehicles in tunnel: 100356<br />Day of Week: Monday","Day: 2005-02-14<br /># Vehicles in tunnel:  97551<br />Day of Week: Monday","Day: 2005-02-21<br /># Vehicles in tunnel: 100679<br />Day of Week: Monday","Day: 2005-02-28<br /># Vehicles in tunnel: 104728<br />Day of Week: Monday","Day: 2005-03-07<br /># Vehicles in tunnel: 106022<br />Day of Week: Monday","Day: 2005-03-14<br /># Vehicles in tunnel: 109599<br />Day of Week: Monday","Day: 2005-03-21<br /># Vehicles in tunnel: 114051<br />Day of Week: Monday","Day: 2005-03-28<br /># Vehicles in tunnel:  90481<br />Day of Week: Monday","Day: 2005-04-04<br /># Vehicles in tunnel: 114573<br />Day of Week: Monday","Day: 2005-04-11<br /># Vehicles in tunnel: 112007<br />Day of Week: Monday","Day: 2005-04-18<br /># Vehicles in tunnel: 110889<br />Day of Week: Monday","Day: 2005-04-25<br /># Vehicles in tunnel: 112708<br />Day of Week: Monday","Day: 2005-05-02<br /># Vehicles in tunnel: 113264<br />Day of Week: Monday","Day: 2005-05-09<br /># Vehicles in tunnel: 112913<br />Day of Week: Monday","Day: 2005-05-16<br /># Vehicles in tunnel:  86177<br />Day of Week: Monday","Day: 2005-05-23<br /># Vehicles in tunnel: 115380<br />Day of Week: Monday","Day: 2005-05-30<br /># Vehicles in tunnel: 115084<br />Day of Week: Monday","Day: 2005-06-06<br /># Vehicles in tunnel: 113115<br />Day of Week: Monday","Day: 2005-06-13<br /># Vehicles in tunnel: 115042<br />Day of Week: Monday","Day: 2005-06-20<br /># Vehicles in tunnel: 115087<br />Day of Week: Monday","Day: 2005-06-27<br /># Vehicles in tunnel: 116698<br />Day of Week: Monday","Day: 2005-07-04<br /># Vehicles in tunnel: 113769<br />Day of Week: Monday","Day: 2005-07-11<br /># Vehicles in tunnel: 112064<br />Day of Week: Monday","Day: 2005-07-18<br /># Vehicles in tunnel: 111071<br />Day of Week: Monday","Day: 2005-07-25<br /># Vehicles in tunnel: 103595<br />Day of Week: Monday","Day: 2005-08-01<br /># Vehicles in tunnel:  72614<br />Day of Week: Monday","Day: 2005-08-08<br /># Vehicles in tunnel: 111027<br />Day of Week: Monday","Day: 2005-08-15<br /># Vehicles in tunnel: 116032<br />Day of Week: Monday","Day: 2005-08-22<br /># Vehicles in tunnel: 114273<br />Day of Week: Monday","Day: 2005-08-29<br /># Vehicles in tunnel: 116825<br />Day of Week: Monday","Day: 2005-09-05<br /># Vehicles in tunnel: 114681<br />Day of Week: Monday","Day: 2005-09-12<br /># Vehicles in tunnel: 113244<br />Day of Week: Monday","Day: 2005-09-19<br /># Vehicles in tunnel: 112624<br />Day of Week: Monday","Day: 2005-09-26<br /># Vehicles in tunnel: 113779<br />Day of Week: Monday","Day: 2005-10-03<br /># Vehicles in tunnel: 113190<br />Day of Week: Monday","Day: 2005-10-10<br /># Vehicles in tunnel: 110714<br />Day of Week: Monday","Day: 2005-10-17<br /># Vehicles in tunnel: 112944<br />Day of Week: Monday","Day: 2005-10-24<br /># Vehicles in tunnel: 113247<br />Day of Week: Monday","Day: 2005-10-31<br /># Vehicles in tunnel: 116393<br />Day of Week: Monday","Day: 2005-11-07<br /># Vehicles in tunnel: 113398<br />Day of Week: Monday","Day: 2005-11-14<br /># Vehicles in tunnel: 112165<br />Day of Week: Monday"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(196,154,0,1)","dash":"solid"},"hoveron":"points","name":"Monday","legendgroup":"Monday","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1067644800,1068249600,1068854400,1069459200,1070064000,1070668800,1071273600,1071878400,1072483200,1073088000,1073692800,1074297600,1074902400,1075507200,1076112000,1076716800,1077321600,1077926400,1078531200,1079136000,1079740800,1080345600,1080950400,1081555200,1082160000,1082764800,1083369600,1083974400,1084579200,1085184000,1085788800,1086393600,1086998400,1087603200,1088208000,1088812800,1089417600,1090022400,1090627200,1091232000,1091836800,1092441600,1093046400,1093651200,1094256000,1094860800,1095465600,1096070400,1096675200,1097280000,1097884800,1098489600,1099094400,1099699200,1100304000,1100908800,1101513600,1102118400,1102723200,1103328000,1103932800,1104537600,1105142400,1105747200,1106352000,1106956800,1107561600,1108166400,1108771200,1109376000,1109980800,1110585600,1111190400,1111795200,1112400000,1113004800,1113609600,1114214400,1114819200,1115424000,1116028800,1116633600,1117238400,1117843200,1118448000,1119052800,1119657600,1120262400,1120867200,1121472000,1122076800,1122681600,1123286400,1123891200,1124496000,1125100800,1125705600,1126310400,1126915200,1127520000,1128124800,1128729600,1129334400,1129939200,1130544000,1131148800,1131753600],"y":[103536,96806,97066,99758,101161,94656,97659,98807,88279,86079,89082,88817,95411,92171,93996,94801,102771,106147,107211,104538,103035,107610,106769,89445,99020,99976,100073,103755,102822,93063,102222,108218,99566,102527,102811,103581,96114,92630,90920,92582,102211,104698,106952,110708,114241,106424,108396,108943,107136,103108,104944,104903,110459,102051,98781,99110,105812,102930,101572,99785,91214,67960,96266,94823,95417,98505,102001,103630,99149,104493,104436,108370,113087,97296,111132,103944,100044,104666,107166,97762,101264,105411,106940,105138,107096,108944,107271,109585,102040,101013,97075,100699,102012,110948,112162,122379,113551,108605,109287,111370,111808,103183,104734,103776,112413,107386,104646],"text":["Day: 2003-11-01<br /># Vehicles in tunnel: 103536<br />Day of Week: Saturday","Day: 2003-11-08<br /># Vehicles in tunnel:  96806<br />Day of Week: Saturday","Day: 2003-11-15<br /># Vehicles in tunnel:  97066<br />Day of Week: Saturday","Day: 2003-11-22<br /># Vehicles in tunnel:  99758<br />Day of Week: Saturday","Day: 2003-11-29<br /># Vehicles in tunnel: 101161<br />Day of Week: Saturday","Day: 2003-12-06<br /># Vehicles in tunnel:  94656<br />Day of Week: Saturday","Day: 2003-12-13<br /># Vehicles in tunnel:  97659<br />Day of Week: Saturday","Day: 2003-12-20<br /># Vehicles in tunnel:  98807<br />Day of Week: Saturday","Day: 2003-12-27<br /># Vehicles in tunnel:  88279<br />Day of Week: Saturday","Day: 2004-01-03<br /># Vehicles in tunnel:  86079<br />Day of Week: Saturday","Day: 2004-01-10<br /># Vehicles in tunnel:  89082<br />Day of Week: Saturday","Day: 2004-01-17<br /># Vehicles in tunnel:  88817<br />Day of Week: Saturday","Day: 2004-01-24<br /># Vehicles in tunnel:  95411<br />Day of Week: Saturday","Day: 2004-01-31<br /># Vehicles in tunnel:  92171<br />Day of Week: Saturday","Day: 2004-02-07<br /># Vehicles in tunnel:  93996<br />Day of Week: Saturday","Day: 2004-02-14<br /># Vehicles in tunnel:  94801<br />Day of Week: Saturday","Day: 2004-02-21<br /># Vehicles in tunnel: 102771<br />Day of Week: Saturday","Day: 2004-02-28<br /># Vehicles in tunnel: 106147<br />Day of Week: Saturday","Day: 2004-03-06<br /># Vehicles in tunnel: 107211<br />Day of Week: Saturday","Day: 2004-03-13<br /># Vehicles in tunnel: 104538<br />Day of Week: Saturday","Day: 2004-03-20<br /># Vehicles in tunnel: 103035<br />Day of Week: Saturday","Day: 2004-03-27<br /># Vehicles in tunnel: 107610<br />Day of Week: Saturday","Day: 2004-04-03<br /># Vehicles in tunnel: 106769<br />Day of Week: Saturday","Day: 2004-04-10<br /># Vehicles in tunnel:  89445<br />Day of Week: Saturday","Day: 2004-04-17<br /># Vehicles in tunnel:  99020<br />Day of Week: Saturday","Day: 2004-04-24<br /># Vehicles in tunnel:  99976<br />Day of Week: Saturday","Day: 2004-05-01<br /># Vehicles in tunnel: 100073<br />Day of Week: Saturday","Day: 2004-05-08<br /># Vehicles in tunnel: 103755<br />Day of Week: Saturday","Day: 2004-05-15<br /># Vehicles in tunnel: 102822<br />Day of Week: Saturday","Day: 2004-05-22<br /># Vehicles in tunnel:  93063<br />Day of Week: Saturday","Day: 2004-05-29<br /># Vehicles in tunnel: 102222<br />Day of Week: Saturday","Day: 2004-06-05<br /># Vehicles in tunnel: 108218<br />Day of Week: Saturday","Day: 2004-06-12<br /># Vehicles in tunnel:  99566<br />Day of Week: Saturday","Day: 2004-06-19<br /># Vehicles in tunnel: 102527<br />Day of Week: Saturday","Day: 2004-06-26<br /># Vehicles in tunnel: 102811<br />Day of Week: Saturday","Day: 2004-07-03<br /># Vehicles in tunnel: 103581<br />Day of Week: Saturday","Day: 2004-07-10<br /># Vehicles in tunnel:  96114<br />Day of Week: Saturday","Day: 2004-07-17<br /># Vehicles in tunnel:  92630<br />Day of Week: Saturday","Day: 2004-07-24<br /># Vehicles in tunnel:  90920<br />Day of Week: Saturday","Day: 2004-07-31<br /># Vehicles in tunnel:  92582<br />Day of Week: Saturday","Day: 2004-08-07<br /># Vehicles in tunnel: 102211<br />Day of Week: Saturday","Day: 2004-08-14<br /># Vehicles in tunnel: 104698<br />Day of Week: Saturday","Day: 2004-08-21<br /># Vehicles in tunnel: 106952<br />Day of Week: Saturday","Day: 2004-08-28<br /># Vehicles in tunnel: 110708<br />Day of Week: Saturday","Day: 2004-09-04<br /># Vehicles in tunnel: 114241<br />Day of Week: Saturday","Day: 2004-09-11<br /># Vehicles in tunnel: 106424<br />Day of Week: Saturday","Day: 2004-09-18<br /># Vehicles in tunnel: 108396<br />Day of Week: Saturday","Day: 2004-09-25<br /># Vehicles in tunnel: 108943<br />Day of Week: Saturday","Day: 2004-10-02<br /># Vehicles in tunnel: 107136<br />Day of Week: Saturday","Day: 2004-10-09<br /># Vehicles in tunnel: 103108<br />Day of Week: Saturday","Day: 2004-10-16<br /># Vehicles in tunnel: 104944<br />Day of Week: Saturday","Day: 2004-10-23<br /># Vehicles in tunnel: 104903<br />Day of Week: Saturday","Day: 2004-10-30<br /># Vehicles in tunnel: 110459<br />Day of Week: Saturday","Day: 2004-11-06<br /># Vehicles in tunnel: 102051<br />Day of Week: Saturday","Day: 2004-11-13<br /># Vehicles in tunnel:  98781<br />Day of Week: Saturday","Day: 2004-11-20<br /># Vehicles in tunnel:  99110<br />Day of Week: Saturday","Day: 2004-11-27<br /># Vehicles in tunnel: 105812<br />Day of Week: Saturday","Day: 2004-12-04<br /># Vehicles in tunnel: 102930<br />Day of Week: Saturday","Day: 2004-12-11<br /># Vehicles in tunnel: 101572<br />Day of Week: Saturday","Day: 2004-12-18<br /># Vehicles in tunnel:  99785<br />Day of Week: Saturday","Day: 2004-12-25<br /># Vehicles in tunnel:  91214<br />Day of Week: Saturday","Day: 2005-01-01<br /># Vehicles in tunnel:  67960<br />Day of Week: Saturday","Day: 2005-01-08<br /># Vehicles in tunnel:  96266<br />Day of Week: Saturday","Day: 2005-01-15<br /># Vehicles in tunnel:  94823<br />Day of Week: Saturday","Day: 2005-01-22<br /># Vehicles in tunnel:  95417<br />Day of Week: Saturday","Day: 2005-01-29<br /># Vehicles in tunnel:  98505<br />Day of Week: Saturday","Day: 2005-02-05<br /># Vehicles in tunnel: 102001<br />Day of Week: Saturday","Day: 2005-02-12<br /># Vehicles in tunnel: 103630<br />Day of Week: Saturday","Day: 2005-02-19<br /># Vehicles in tunnel:  99149<br />Day of Week: Saturday","Day: 2005-02-26<br /># Vehicles in tunnel: 104493<br />Day of Week: Saturday","Day: 2005-03-05<br /># Vehicles in tunnel: 104436<br />Day of Week: Saturday","Day: 2005-03-12<br /># Vehicles in tunnel: 108370<br />Day of Week: Saturday","Day: 2005-03-19<br /># Vehicles in tunnel: 113087<br />Day of Week: Saturday","Day: 2005-03-26<br /># Vehicles in tunnel:  97296<br />Day of Week: Saturday","Day: 2005-04-02<br /># Vehicles in tunnel: 111132<br />Day of Week: Saturday","Day: 2005-04-09<br /># Vehicles in tunnel: 103944<br />Day of Week: Saturday","Day: 2005-04-16<br /># Vehicles in tunnel: 100044<br />Day of Week: Saturday","Day: 2005-04-23<br /># Vehicles in tunnel: 104666<br />Day of Week: Saturday","Day: 2005-04-30<br /># Vehicles in tunnel: 107166<br />Day of Week: Saturday","Day: 2005-05-07<br /># Vehicles in tunnel:  97762<br />Day of Week: Saturday","Day: 2005-05-14<br /># Vehicles in tunnel: 101264<br />Day of Week: Saturday","Day: 2005-05-21<br /># Vehicles in tunnel: 105411<br />Day of Week: Saturday","Day: 2005-05-28<br /># Vehicles in tunnel: 106940<br />Day of Week: Saturday","Day: 2005-06-04<br /># Vehicles in tunnel: 105138<br />Day of Week: Saturday","Day: 2005-06-11<br /># Vehicles in tunnel: 107096<br />Day of Week: Saturday","Day: 2005-06-18<br /># Vehicles in tunnel: 108944<br />Day of Week: Saturday","Day: 2005-06-25<br /># Vehicles in tunnel: 107271<br />Day of Week: Saturday","Day: 2005-07-02<br /># Vehicles in tunnel: 109585<br />Day of Week: Saturday","Day: 2005-07-09<br /># Vehicles in tunnel: 102040<br />Day of Week: Saturday","Day: 2005-07-16<br /># Vehicles in tunnel: 101013<br />Day of Week: Saturday","Day: 2005-07-23<br /># Vehicles in tunnel:  97075<br />Day of Week: Saturday","Day: 2005-07-30<br /># Vehicles in tunnel: 100699<br />Day of Week: Saturday","Day: 2005-08-06<br /># Vehicles in tunnel: 102012<br />Day of Week: Saturday","Day: 2005-08-13<br /># Vehicles in tunnel: 110948<br />Day of Week: Saturday","Day: 2005-08-20<br /># Vehicles in tunnel: 112162<br />Day of Week: Saturday","Day: 2005-08-27<br /># Vehicles in tunnel: 122379<br />Day of Week: Saturday","Day: 2005-09-03<br /># Vehicles in tunnel: 113551<br />Day of Week: Saturday","Day: 2005-09-10<br /># Vehicles in tunnel: 108605<br />Day of Week: Saturday","Day: 2005-09-17<br /># Vehicles in tunnel: 109287<br />Day of Week: Saturday","Day: 2005-09-24<br /># Vehicles in tunnel: 111370<br />Day of Week: Saturday","Day: 2005-10-01<br /># Vehicles in tunnel: 111808<br />Day of Week: Saturday","Day: 2005-10-08<br /># Vehicles in tunnel: 103183<br />Day of Week: Saturday","Day: 2005-10-15<br /># Vehicles in tunnel: 104734<br />Day of Week: Saturday","Day: 2005-10-22<br /># Vehicles in tunnel: 103776<br />Day of Week: Saturday","Day: 2005-10-29<br /># Vehicles in tunnel: 112413<br />Day of Week: Saturday","Day: 2005-11-05<br /># Vehicles in tunnel: 107386<br />Day of Week: Saturday","Day: 2005-11-12<br /># Vehicles in tunnel: 104646<br />Day of Week: Saturday"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(83,180,0,1)","dash":"solid"},"hoveron":"points","name":"Saturday","legendgroup":"Saturday","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1067731200,1068336000,1068940800,1069545600,1070150400,1070755200,1071360000,1071964800,1072569600,1073174400,1073779200,1074384000,1074988800,1075593600,1076198400,1076803200,1077408000,1078012800,1078617600,1079222400,1079827200,1080432000,1081036800,1081641600,1082246400,1082851200,1083456000,1084060800,1084665600,1085270400,1085875200,1086480000,1087084800,1087689600,1088294400,1088899200,1089504000,1090108800,1090713600,1091318400,1091923200,1092528000,1093132800,1093737600,1094342400,1094947200,1095552000,1096156800,1096761600,1097366400,1097971200,1098576000,1099180800,1099785600,1100390400,1100995200,1101600000,1102204800,1102809600,1103414400,1104019200,1104624000,1105228800,1105833600,1106438400,1107043200,1107648000,1108252800,1108857600,1109462400,1110067200,1110672000,1111276800,1111881600,1112486400,1113091200,1113696000,1114300800,1114905600,1115510400,1116115200,1116720000,1117324800,1117929600,1118534400,1119139200,1119744000,1120348800,1120953600,1121558400,1122163200,1122768000,1123372800,1123977600,1124582400,1125187200,1125792000,1126396800,1127001600,1127606400,1128211200,1128816000,1129420800,1130025600,1130630400,1131235200,1131840000],"y":[92051,86811,83848,88487,90733,85336,85532,78903,73671,70426,74378,75774,76837,80610,71021,80870,84360,87204,88627,87602,88306,93377,90149,85947,87171,89964,93067,91948,93955,93867,84476,93682,89032,90057,93380,93136,86720,83477,84247,77964,96986,95419,97599,98450,107292,96428,94600,95014,96202,90222,90597,94564,95837,89408,91683,88473,92743,92930,90986,83675,89976,83327,81751,82146,77919,78339,77231,76094,80211,79274,82377,90511,95270,87922,96227,91469,87253,91595,94934,103213,87722,90105,98251,96391,97622,98758,95851,96375,93008,89492,84374,84502,90521,100364,95294,104101,98545,96555,92052,98189,93627,94668,93587,89657,97626,98226,94424],"text":["Day: 2003-11-02<br /># Vehicles in tunnel:  92051<br />Day of Week: Sunday","Day: 2003-11-09<br /># Vehicles in tunnel:  86811<br />Day of Week: Sunday","Day: 2003-11-16<br /># Vehicles in tunnel:  83848<br />Day of Week: Sunday","Day: 2003-11-23<br /># Vehicles in tunnel:  88487<br />Day of Week: Sunday","Day: 2003-11-30<br /># Vehicles in tunnel:  90733<br />Day of Week: Sunday","Day: 2003-12-07<br /># Vehicles in tunnel:  85336<br />Day of Week: Sunday","Day: 2003-12-14<br /># Vehicles in tunnel:  85532<br />Day of Week: Sunday","Day: 2003-12-21<br /># Vehicles in tunnel:  78903<br />Day of Week: Sunday","Day: 2003-12-28<br /># Vehicles in tunnel:  73671<br />Day of Week: Sunday","Day: 2004-01-04<br /># Vehicles in tunnel:  70426<br />Day of Week: Sunday","Day: 2004-01-11<br /># Vehicles in tunnel:  74378<br />Day of Week: Sunday","Day: 2004-01-18<br /># Vehicles in tunnel:  75774<br />Day of Week: Sunday","Day: 2004-01-25<br /># Vehicles in tunnel:  76837<br />Day of Week: Sunday","Day: 2004-02-01<br /># Vehicles in tunnel:  80610<br />Day of Week: Sunday","Day: 2004-02-08<br /># Vehicles in tunnel:  71021<br />Day of Week: Sunday","Day: 2004-02-15<br /># Vehicles in tunnel:  80870<br />Day of Week: Sunday","Day: 2004-02-22<br /># Vehicles in tunnel:  84360<br />Day of Week: Sunday","Day: 2004-02-29<br /># Vehicles in tunnel:  87204<br />Day of Week: Sunday","Day: 2004-03-07<br /># Vehicles in tunnel:  88627<br />Day of Week: Sunday","Day: 2004-03-14<br /># Vehicles in tunnel:  87602<br />Day of Week: Sunday","Day: 2004-03-21<br /># Vehicles in tunnel:  88306<br />Day of Week: Sunday","Day: 2004-03-28<br /># Vehicles in tunnel:  93377<br />Day of Week: Sunday","Day: 2004-04-04<br /># Vehicles in tunnel:  90149<br />Day of Week: Sunday","Day: 2004-04-11<br /># Vehicles in tunnel:  85947<br />Day of Week: Sunday","Day: 2004-04-18<br /># Vehicles in tunnel:  87171<br />Day of Week: Sunday","Day: 2004-04-25<br /># Vehicles in tunnel:  89964<br />Day of Week: Sunday","Day: 2004-05-02<br /># Vehicles in tunnel:  93067<br />Day of Week: Sunday","Day: 2004-05-09<br /># Vehicles in tunnel:  91948<br />Day of Week: Sunday","Day: 2004-05-16<br /># Vehicles in tunnel:  93955<br />Day of Week: Sunday","Day: 2004-05-23<br /># Vehicles in tunnel:  93867<br />Day of Week: Sunday","Day: 2004-05-30<br /># Vehicles in tunnel:  84476<br />Day of Week: Sunday","Day: 2004-06-06<br /># Vehicles in tunnel:  93682<br />Day of Week: Sunday","Day: 2004-06-13<br /># Vehicles in tunnel:  89032<br />Day of Week: Sunday","Day: 2004-06-20<br /># Vehicles in tunnel:  90057<br />Day of Week: Sunday","Day: 2004-06-27<br /># Vehicles in tunnel:  93380<br />Day of Week: Sunday","Day: 2004-07-04<br /># Vehicles in tunnel:  93136<br />Day of Week: Sunday","Day: 2004-07-11<br /># Vehicles in tunnel:  86720<br />Day of Week: Sunday","Day: 2004-07-18<br /># Vehicles in tunnel:  83477<br />Day of Week: Sunday","Day: 2004-07-25<br /># Vehicles in tunnel:  84247<br />Day of Week: Sunday","Day: 2004-08-01<br /># Vehicles in tunnel:  77964<br />Day of Week: Sunday","Day: 2004-08-08<br /># Vehicles in tunnel:  96986<br />Day of Week: Sunday","Day: 2004-08-15<br /># Vehicles in tunnel:  95419<br />Day of Week: Sunday","Day: 2004-08-22<br /># Vehicles in tunnel:  97599<br />Day of Week: Sunday","Day: 2004-08-29<br /># Vehicles in tunnel:  98450<br />Day of Week: Sunday","Day: 2004-09-05<br /># Vehicles in tunnel: 107292<br />Day of Week: Sunday","Day: 2004-09-12<br /># Vehicles in tunnel:  96428<br />Day of Week: Sunday","Day: 2004-09-19<br /># Vehicles in tunnel:  94600<br />Day of Week: Sunday","Day: 2004-09-26<br /># Vehicles in tunnel:  95014<br />Day of Week: Sunday","Day: 2004-10-03<br /># Vehicles in tunnel:  96202<br />Day of Week: Sunday","Day: 2004-10-10<br /># Vehicles in tunnel:  90222<br />Day of Week: Sunday","Day: 2004-10-17<br /># Vehicles in tunnel:  90597<br />Day of Week: Sunday","Day: 2004-10-24<br /># Vehicles in tunnel:  94564<br />Day of Week: Sunday","Day: 2004-10-31<br /># Vehicles in tunnel:  95837<br />Day of Week: Sunday","Day: 2004-11-07<br /># Vehicles in tunnel:  89408<br />Day of Week: Sunday","Day: 2004-11-14<br /># Vehicles in tunnel:  91683<br />Day of Week: Sunday","Day: 2004-11-21<br /># Vehicles in tunnel:  88473<br />Day of Week: Sunday","Day: 2004-11-28<br /># Vehicles in tunnel:  92743<br />Day of Week: Sunday","Day: 2004-12-05<br /># Vehicles in tunnel:  92930<br />Day of Week: Sunday","Day: 2004-12-12<br /># Vehicles in tunnel:  90986<br />Day of Week: Sunday","Day: 2004-12-19<br /># Vehicles in tunnel:  83675<br />Day of Week: Sunday","Day: 2004-12-26<br /># Vehicles in tunnel:  89976<br />Day of Week: Sunday","Day: 2005-01-02<br /># Vehicles in tunnel:  83327<br />Day of Week: Sunday","Day: 2005-01-09<br /># Vehicles in tunnel:  81751<br />Day of Week: Sunday","Day: 2005-01-16<br /># Vehicles in tunnel:  82146<br />Day of Week: Sunday","Day: 2005-01-23<br /># Vehicles in tunnel:  77919<br />Day of Week: Sunday","Day: 2005-01-30<br /># Vehicles in tunnel:  78339<br />Day of Week: Sunday","Day: 2005-02-06<br /># Vehicles in tunnel:  77231<br />Day of Week: Sunday","Day: 2005-02-13<br /># Vehicles in tunnel:  76094<br />Day of Week: Sunday","Day: 2005-02-20<br /># Vehicles in tunnel:  80211<br />Day of Week: Sunday","Day: 2005-02-27<br /># Vehicles in tunnel:  79274<br />Day of Week: Sunday","Day: 2005-03-06<br /># Vehicles in tunnel:  82377<br />Day of Week: Sunday","Day: 2005-03-13<br /># Vehicles in tunnel:  90511<br />Day of Week: Sunday","Day: 2005-03-20<br /># Vehicles in tunnel:  95270<br />Day of Week: Sunday","Day: 2005-03-27<br /># Vehicles in tunnel:  87922<br />Day of Week: Sunday","Day: 2005-04-03<br /># Vehicles in tunnel:  96227<br />Day of Week: Sunday","Day: 2005-04-10<br /># Vehicles in tunnel:  91469<br />Day of Week: Sunday","Day: 2005-04-17<br /># Vehicles in tunnel:  87253<br />Day of Week: Sunday","Day: 2005-04-24<br /># Vehicles in tunnel:  91595<br />Day of Week: Sunday","Day: 2005-05-01<br /># Vehicles in tunnel:  94934<br />Day of Week: Sunday","Day: 2005-05-08<br /># Vehicles in tunnel: 103213<br />Day of Week: Sunday","Day: 2005-05-15<br /># Vehicles in tunnel:  87722<br />Day of Week: Sunday","Day: 2005-05-22<br /># Vehicles in tunnel:  90105<br />Day of Week: Sunday","Day: 2005-05-29<br /># Vehicles in tunnel:  98251<br />Day of Week: Sunday","Day: 2005-06-05<br /># Vehicles in tunnel:  96391<br />Day of Week: Sunday","Day: 2005-06-12<br /># Vehicles in tunnel:  97622<br />Day of Week: Sunday","Day: 2005-06-19<br /># Vehicles in tunnel:  98758<br />Day of Week: Sunday","Day: 2005-06-26<br /># Vehicles in tunnel:  95851<br />Day of Week: Sunday","Day: 2005-07-03<br /># Vehicles in tunnel:  96375<br />Day of Week: Sunday","Day: 2005-07-10<br /># Vehicles in tunnel:  93008<br />Day of Week: Sunday","Day: 2005-07-17<br /># Vehicles in tunnel:  89492<br />Day of Week: Sunday","Day: 2005-07-24<br /># Vehicles in tunnel:  84374<br />Day of Week: Sunday","Day: 2005-07-31<br /># Vehicles in tunnel:  84502<br />Day of Week: Sunday","Day: 2005-08-07<br /># Vehicles in tunnel:  90521<br />Day of Week: Sunday","Day: 2005-08-14<br /># Vehicles in tunnel: 100364<br />Day of Week: Sunday","Day: 2005-08-21<br /># Vehicles in tunnel:  95294<br />Day of Week: Sunday","Day: 2005-08-28<br /># Vehicles in tunnel: 104101<br />Day of Week: Sunday","Day: 2005-09-04<br /># Vehicles in tunnel:  98545<br />Day of Week: Sunday","Day: 2005-09-11<br /># Vehicles in tunnel:  96555<br />Day of Week: Sunday","Day: 2005-09-18<br /># Vehicles in tunnel:  92052<br />Day of Week: Sunday","Day: 2005-09-25<br /># Vehicles in tunnel:  98189<br />Day of Week: Sunday","Day: 2005-10-02<br /># Vehicles in tunnel:  93627<br />Day of Week: Sunday","Day: 2005-10-09<br /># Vehicles in tunnel:  94668<br />Day of Week: Sunday","Day: 2005-10-16<br /># Vehicles in tunnel:  93587<br />Day of Week: Sunday","Day: 2005-10-23<br /># Vehicles in tunnel:  89657<br />Day of Week: Sunday","Day: 2005-10-30<br /># Vehicles in tunnel:  97626<br />Day of Week: Sunday","Day: 2005-11-06<br /># Vehicles in tunnel:  98226<br />Day of Week: Sunday","Day: 2005-11-13<br /># Vehicles in tunnel:  94424<br />Day of Week: Sunday"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,192,148,1)","dash":"solid"},"hoveron":"points","name":"Sunday","legendgroup":"Sunday","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1068076800,1068681600,1069286400,1069891200,1070496000,1071100800,1071705600,1072310400,1072915200,1073520000,1074124800,1074729600,1075334400,1075939200,1076544000,1077148800,1077753600,1078358400,1078963200,1079568000,1080172800,1080777600,1081382400,1081987200,1082592000,1083196800,1083801600,1084406400,1085011200,1085616000,1086220800,1086825600,1087430400,1088035200,1088640000,1089244800,1089849600,1090454400,1091059200,1091664000,1092268800,1092873600,1093478400,1094083200,1094688000,1095292800,1095897600,1096502400,1097107200,1097712000,1098316800,1098921600,1099526400,1100131200,1100736000,1101340800,1101945600,1102550400,1103155200,1103760000,1104364800,1104969600,1105574400,1106179200,1106784000,1107388800,1107993600,1108598400,1109203200,1109808000,1110412800,1111017600,1111622400,1112227200,1112832000,1113436800,1114041600,1114646400,1115251200,1115856000,1116460800,1117065600,1117670400,1118275200,1118880000,1119484800,1120089600,1120694400,1121299200,1121904000,1122508800,1123113600,1123718400,1124323200,1124928000,1125532800,1126137600,1126742400,1127347200,1127952000,1128556800,1129161600,1129766400,1130371200,1130976000,1131580800],"y":[106284,107011,108397,109490,108811,111200,110804,79812,53098,94986,101859,105527,86544,101446,102504,106061,103626,108204,107516,108294,110311,112039,118665,98904,109921,108459,109673,108975,84766,111329,109995,103267,110514,112258,114077,109238,106651,101011,106127,109784,114267,115954,117794,118102,117459,117379,116325,115233,114622,118468,116896,120356,116164,115775,118060,119085,117914,118173,119937,113159,96067,102582,110258,110016,108724,106061,107589,107179,110215,113472,116027,119382,127354,121118,120288,118531,119250,122071,81910,119355,121769,115479,120566,121204,124340,123366,125353,119848,116090,110562,107520,113722,118515,121582,128274,121723,120824,120260,120223,121893,115066,116613,121717,123814,122053,119386],"text":["Day: 2003-11-06<br /># Vehicles in tunnel: 106284<br />Day of Week: Thursday","Day: 2003-11-13<br /># Vehicles in tunnel: 107011<br />Day of Week: Thursday","Day: 2003-11-20<br /># Vehicles in tunnel: 108397<br />Day of Week: Thursday","Day: 2003-11-27<br /># Vehicles in tunnel: 109490<br />Day of Week: Thursday","Day: 2003-12-04<br /># Vehicles in tunnel: 108811<br />Day of Week: Thursday","Day: 2003-12-11<br /># Vehicles in tunnel: 111200<br />Day of Week: Thursday","Day: 2003-12-18<br /># Vehicles in tunnel: 110804<br />Day of Week: Thursday","Day: 2003-12-25<br /># Vehicles in tunnel:  79812<br />Day of Week: Thursday","Day: 2004-01-01<br /># Vehicles in tunnel:  53098<br />Day of Week: Thursday","Day: 2004-01-08<br /># Vehicles in tunnel:  94986<br />Day of Week: Thursday","Day: 2004-01-15<br /># Vehicles in tunnel: 101859<br />Day of Week: Thursday","Day: 2004-01-22<br /># Vehicles in tunnel: 105527<br />Day of Week: Thursday","Day: 2004-01-29<br /># Vehicles in tunnel:  86544<br />Day of Week: Thursday","Day: 2004-02-05<br /># Vehicles in tunnel: 101446<br />Day of Week: Thursday","Day: 2004-02-12<br /># Vehicles in tunnel: 102504<br />Day of Week: Thursday","Day: 2004-02-19<br /># Vehicles in tunnel: 106061<br />Day of Week: Thursday","Day: 2004-02-26<br /># Vehicles in tunnel: 103626<br />Day of Week: Thursday","Day: 2004-03-04<br /># Vehicles in tunnel: 108204<br />Day of Week: Thursday","Day: 2004-03-11<br /># Vehicles in tunnel: 107516<br />Day of Week: Thursday","Day: 2004-03-18<br /># Vehicles in tunnel: 108294<br />Day of Week: Thursday","Day: 2004-03-25<br /># Vehicles in tunnel: 110311<br />Day of Week: Thursday","Day: 2004-04-01<br /># Vehicles in tunnel: 112039<br />Day of Week: Thursday","Day: 2004-04-08<br /># Vehicles in tunnel: 118665<br />Day of Week: Thursday","Day: 2004-04-15<br /># Vehicles in tunnel:  98904<br />Day of Week: Thursday","Day: 2004-04-22<br /># Vehicles in tunnel: 109921<br />Day of Week: Thursday","Day: 2004-04-29<br /># Vehicles in tunnel: 108459<br />Day of Week: Thursday","Day: 2004-05-06<br /># Vehicles in tunnel: 109673<br />Day of Week: Thursday","Day: 2004-05-13<br /># Vehicles in tunnel: 108975<br />Day of Week: Thursday","Day: 2004-05-20<br /># Vehicles in tunnel:  84766<br />Day of Week: Thursday","Day: 2004-05-27<br /># Vehicles in tunnel: 111329<br />Day of Week: Thursday","Day: 2004-06-03<br /># Vehicles in tunnel: 109995<br />Day of Week: Thursday","Day: 2004-06-10<br /># Vehicles in tunnel: 103267<br />Day of Week: Thursday","Day: 2004-06-17<br /># Vehicles in tunnel: 110514<br />Day of Week: Thursday","Day: 2004-06-24<br /># Vehicles in tunnel: 112258<br />Day of Week: Thursday","Day: 2004-07-01<br /># Vehicles in tunnel: 114077<br />Day of Week: Thursday","Day: 2004-07-08<br /># Vehicles in tunnel: 109238<br />Day of Week: Thursday","Day: 2004-07-15<br /># Vehicles in tunnel: 106651<br />Day of Week: Thursday","Day: 2004-07-22<br /># Vehicles in tunnel: 101011<br />Day of Week: Thursday","Day: 2004-07-29<br /># Vehicles in tunnel: 106127<br />Day of Week: Thursday","Day: 2004-08-05<br /># Vehicles in tunnel: 109784<br />Day of Week: Thursday","Day: 2004-08-12<br /># Vehicles in tunnel: 114267<br />Day of Week: Thursday","Day: 2004-08-19<br /># Vehicles in tunnel: 115954<br />Day of Week: Thursday","Day: 2004-08-26<br /># Vehicles in tunnel: 117794<br />Day of Week: Thursday","Day: 2004-09-02<br /># Vehicles in tunnel: 118102<br />Day of Week: Thursday","Day: 2004-09-09<br /># Vehicles in tunnel: 117459<br />Day of Week: Thursday","Day: 2004-09-16<br /># Vehicles in tunnel: 117379<br />Day of Week: Thursday","Day: 2004-09-23<br /># Vehicles in tunnel: 116325<br />Day of Week: Thursday","Day: 2004-09-30<br /># Vehicles in tunnel: 115233<br />Day of Week: Thursday","Day: 2004-10-07<br /># Vehicles in tunnel: 114622<br />Day of Week: Thursday","Day: 2004-10-14<br /># Vehicles in tunnel: 118468<br />Day of Week: Thursday","Day: 2004-10-21<br /># Vehicles in tunnel: 116896<br />Day of Week: Thursday","Day: 2004-10-28<br /># Vehicles in tunnel: 120356<br />Day of Week: Thursday","Day: 2004-11-04<br /># Vehicles in tunnel: 116164<br />Day of Week: Thursday","Day: 2004-11-11<br /># Vehicles in tunnel: 115775<br />Day of Week: Thursday","Day: 2004-11-18<br /># Vehicles in tunnel: 118060<br />Day of Week: Thursday","Day: 2004-11-25<br /># Vehicles in tunnel: 119085<br />Day of Week: Thursday","Day: 2004-12-02<br /># Vehicles in tunnel: 117914<br />Day of Week: Thursday","Day: 2004-12-09<br /># Vehicles in tunnel: 118173<br />Day of Week: Thursday","Day: 2004-12-16<br /># Vehicles in tunnel: 119937<br />Day of Week: Thursday","Day: 2004-12-23<br /># Vehicles in tunnel: 113159<br />Day of Week: Thursday","Day: 2004-12-30<br /># Vehicles in tunnel:  96067<br />Day of Week: Thursday","Day: 2005-01-06<br /># Vehicles in tunnel: 102582<br />Day of Week: Thursday","Day: 2005-01-13<br /># Vehicles in tunnel: 110258<br />Day of Week: Thursday","Day: 2005-01-20<br /># Vehicles in tunnel: 110016<br />Day of Week: Thursday","Day: 2005-01-27<br /># Vehicles in tunnel: 108724<br />Day of Week: Thursday","Day: 2005-02-03<br /># Vehicles in tunnel: 106061<br />Day of Week: Thursday","Day: 2005-02-10<br /># Vehicles in tunnel: 107589<br />Day of Week: Thursday","Day: 2005-02-17<br /># Vehicles in tunnel: 107179<br />Day of Week: Thursday","Day: 2005-02-24<br /># Vehicles in tunnel: 110215<br />Day of Week: Thursday","Day: 2005-03-03<br /># Vehicles in tunnel: 113472<br />Day of Week: Thursday","Day: 2005-03-10<br /># Vehicles in tunnel: 116027<br />Day of Week: Thursday","Day: 2005-03-17<br /># Vehicles in tunnel: 119382<br />Day of Week: Thursday","Day: 2005-03-24<br /># Vehicles in tunnel: 127354<br />Day of Week: Thursday","Day: 2005-03-31<br /># Vehicles in tunnel: 121118<br />Day of Week: Thursday","Day: 2005-04-07<br /># Vehicles in tunnel: 120288<br />Day of Week: Thursday","Day: 2005-04-14<br /># Vehicles in tunnel: 118531<br />Day of Week: Thursday","Day: 2005-04-21<br /># Vehicles in tunnel: 119250<br />Day of Week: Thursday","Day: 2005-04-28<br /># Vehicles in tunnel: 122071<br />Day of Week: Thursday","Day: 2005-05-05<br /># Vehicles in tunnel:  81910<br />Day of Week: Thursday","Day: 2005-05-12<br /># Vehicles in tunnel: 119355<br />Day of Week: Thursday","Day: 2005-05-19<br /># Vehicles in tunnel: 121769<br />Day of Week: Thursday","Day: 2005-05-26<br /># Vehicles in tunnel: 115479<br />Day of Week: Thursday","Day: 2005-06-02<br /># Vehicles in tunnel: 120566<br />Day of Week: Thursday","Day: 2005-06-09<br /># Vehicles in tunnel: 121204<br />Day of Week: Thursday","Day: 2005-06-16<br /># Vehicles in tunnel: 124340<br />Day of Week: Thursday","Day: 2005-06-23<br /># Vehicles in tunnel: 123366<br />Day of Week: Thursday","Day: 2005-06-30<br /># Vehicles in tunnel: 125353<br />Day of Week: Thursday","Day: 2005-07-07<br /># Vehicles in tunnel: 119848<br />Day of Week: Thursday","Day: 2005-07-14<br /># Vehicles in tunnel: 116090<br />Day of Week: Thursday","Day: 2005-07-21<br /># Vehicles in tunnel: 110562<br />Day of Week: Thursday","Day: 2005-07-28<br /># Vehicles in tunnel: 107520<br />Day of Week: Thursday","Day: 2005-08-04<br /># Vehicles in tunnel: 113722<br />Day of Week: Thursday","Day: 2005-08-11<br /># Vehicles in tunnel: 118515<br />Day of Week: Thursday","Day: 2005-08-18<br /># Vehicles in tunnel: 121582<br />Day of Week: Thursday","Day: 2005-08-25<br /># Vehicles in tunnel: 128274<br />Day of Week: Thursday","Day: 2005-09-01<br /># Vehicles in tunnel: 121723<br />Day of Week: Thursday","Day: 2005-09-08<br /># Vehicles in tunnel: 120824<br />Day of Week: Thursday","Day: 2005-09-15<br /># Vehicles in tunnel: 120260<br />Day of Week: Thursday","Day: 2005-09-22<br /># Vehicles in tunnel: 120223<br />Day of Week: Thursday","Day: 2005-09-29<br /># Vehicles in tunnel: 121893<br />Day of Week: Thursday","Day: 2005-10-06<br /># Vehicles in tunnel: 115066<br />Day of Week: Thursday","Day: 2005-10-13<br /># Vehicles in tunnel: 116613<br />Day of Week: Thursday","Day: 2005-10-20<br /># Vehicles in tunnel: 121717<br />Day of Week: Thursday","Day: 2005-10-27<br /># Vehicles in tunnel: 123814<br />Day of Week: Thursday","Day: 2005-11-03<br /># Vehicles in tunnel: 122053<br />Day of Week: Thursday","Day: 2005-11-10<br /># Vehicles in tunnel: 119386<br />Day of Week: Thursday"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,182,235,1)","dash":"solid"},"hoveron":"points","name":"Thursday","legendgroup":"Thursday","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1067904000,1068508800,1069113600,1069718400,1070323200,1070928000,1071532800,1072137600,1072742400,1073347200,1073952000,1074556800,1075161600,1075766400,1076371200,1076976000,1077580800,1078185600,1078790400,1079395200,1080000000,1080604800,1081209600,1081814400,1082419200,1083024000,1083628800,1084233600,1084838400,1085443200,1086048000,1086652800,1087257600,1087862400,1088467200,1089072000,1089676800,1090281600,1090886400,1091491200,1092096000,1092700800,1093305600,1093910400,1094515200,1095120000,1095724800,1096329600,1096934400,1097539200,1098144000,1098748800,1099353600,1099958400,1100563200,1101168000,1101772800,1102377600,1102982400,1103587200,1104192000,1104796800,1105401600,1106006400,1106611200,1107216000,1107820800,1108425600,1109030400,1109635200,1110240000,1110844800,1111449600,1112054400,1112659200,1113264000,1113868800,1114473600,1115078400,1115683200,1116288000,1116892800,1117497600,1118102400,1118707200,1119312000,1119916800,1120521600,1121126400,1121731200,1122336000,1122940800,1123545600,1124150400,1124755200,1125360000,1125964800,1126569600,1127174400,1127779200,1128384000,1128988800,1129593600,1130198400,1130803200,1131408000,1132012800],"y":[102352,102253,102281,107040,102497,105500,103496,94262,84747,88929,96083,94226,85353,96471,97976,102483,94749,99848,104557,104013,104498,107497,109815,106787,105724,105079,105466,105942,105379,105479,106469,104821,106686,95408,108257,105236,102154,96499,98893,101146,107870,111144,109962,112652,112754,111297,111235,110607,110697,112331,110928,113071,111004,109222,111251,110716,112114,113405,112880,112024,92113,94312,104401,106606,98867,98135,102958,96739,101775,108108,104966,111848,116986,116328,115811,113554,113771,115921,115493,114948,117634,117490,116572,116348,116187,115261,115929,116471,111813,107705,104704,110359,113565,116287,119640,117562,114318,114575,115000,115827,111446,112019,114643,116713,117629,113682,114296],"text":["Day: 2003-11-04<br /># Vehicles in tunnel: 102352<br />Day of Week: Tuesday","Day: 2003-11-11<br /># Vehicles in tunnel: 102253<br />Day of Week: Tuesday","Day: 2003-11-18<br /># Vehicles in tunnel: 102281<br />Day of Week: Tuesday","Day: 2003-11-25<br /># Vehicles in tunnel: 107040<br />Day of Week: Tuesday","Day: 2003-12-02<br /># Vehicles in tunnel: 102497<br />Day of Week: Tuesday","Day: 2003-12-09<br /># Vehicles in tunnel: 105500<br />Day of Week: Tuesday","Day: 2003-12-16<br /># Vehicles in tunnel: 103496<br />Day of Week: Tuesday","Day: 2003-12-23<br /># Vehicles in tunnel:  94262<br />Day of Week: Tuesday","Day: 2003-12-30<br /># Vehicles in tunnel:  84747<br />Day of Week: Tuesday","Day: 2004-01-06<br /># Vehicles in tunnel:  88929<br />Day of Week: Tuesday","Day: 2004-01-13<br /># Vehicles in tunnel:  96083<br />Day of Week: Tuesday","Day: 2004-01-20<br /># Vehicles in tunnel:  94226<br />Day of Week: Tuesday","Day: 2004-01-27<br /># Vehicles in tunnel:  85353<br />Day of Week: Tuesday","Day: 2004-02-03<br /># Vehicles in tunnel:  96471<br />Day of Week: Tuesday","Day: 2004-02-10<br /># Vehicles in tunnel:  97976<br />Day of Week: Tuesday","Day: 2004-02-17<br /># Vehicles in tunnel: 102483<br />Day of Week: Tuesday","Day: 2004-02-24<br /># Vehicles in tunnel:  94749<br />Day of Week: Tuesday","Day: 2004-03-02<br /># Vehicles in tunnel:  99848<br />Day of Week: Tuesday","Day: 2004-03-09<br /># Vehicles in tunnel: 104557<br />Day of Week: Tuesday","Day: 2004-03-16<br /># Vehicles in tunnel: 104013<br />Day of Week: Tuesday","Day: 2004-03-23<br /># Vehicles in tunnel: 104498<br />Day of Week: Tuesday","Day: 2004-03-30<br /># Vehicles in tunnel: 107497<br />Day of Week: Tuesday","Day: 2004-04-06<br /># Vehicles in tunnel: 109815<br />Day of Week: Tuesday","Day: 2004-04-13<br /># Vehicles in tunnel: 106787<br />Day of Week: Tuesday","Day: 2004-04-20<br /># Vehicles in tunnel: 105724<br />Day of Week: Tuesday","Day: 2004-04-27<br /># Vehicles in tunnel: 105079<br />Day of Week: Tuesday","Day: 2004-05-04<br /># Vehicles in tunnel: 105466<br />Day of Week: Tuesday","Day: 2004-05-11<br /># Vehicles in tunnel: 105942<br />Day of Week: Tuesday","Day: 2004-05-18<br /># Vehicles in tunnel: 105379<br />Day of Week: Tuesday","Day: 2004-05-25<br /># Vehicles in tunnel: 105479<br />Day of Week: Tuesday","Day: 2004-06-01<br /># Vehicles in tunnel: 106469<br />Day of Week: Tuesday","Day: 2004-06-08<br /># Vehicles in tunnel: 104821<br />Day of Week: Tuesday","Day: 2004-06-15<br /># Vehicles in tunnel: 106686<br />Day of Week: Tuesday","Day: 2004-06-22<br /># Vehicles in tunnel:  95408<br />Day of Week: Tuesday","Day: 2004-06-29<br /># Vehicles in tunnel: 108257<br />Day of Week: Tuesday","Day: 2004-07-06<br /># Vehicles in tunnel: 105236<br />Day of Week: Tuesday","Day: 2004-07-13<br /># Vehicles in tunnel: 102154<br />Day of Week: Tuesday","Day: 2004-07-20<br /># Vehicles in tunnel:  96499<br />Day of Week: Tuesday","Day: 2004-07-27<br /># Vehicles in tunnel:  98893<br />Day of Week: Tuesday","Day: 2004-08-03<br /># Vehicles in tunnel: 101146<br />Day of Week: Tuesday","Day: 2004-08-10<br /># Vehicles in tunnel: 107870<br />Day of Week: Tuesday","Day: 2004-08-17<br /># Vehicles in tunnel: 111144<br />Day of Week: Tuesday","Day: 2004-08-24<br /># Vehicles in tunnel: 109962<br />Day of Week: Tuesday","Day: 2004-08-31<br /># Vehicles in tunnel: 112652<br />Day of Week: Tuesday","Day: 2004-09-07<br /># Vehicles in tunnel: 112754<br />Day of Week: Tuesday","Day: 2004-09-14<br /># Vehicles in tunnel: 111297<br />Day of Week: Tuesday","Day: 2004-09-21<br /># Vehicles in tunnel: 111235<br />Day of Week: Tuesday","Day: 2004-09-28<br /># Vehicles in tunnel: 110607<br />Day of Week: Tuesday","Day: 2004-10-05<br /># Vehicles in tunnel: 110697<br />Day of Week: Tuesday","Day: 2004-10-12<br /># Vehicles in tunnel: 112331<br />Day of Week: Tuesday","Day: 2004-10-19<br /># Vehicles in tunnel: 110928<br />Day of Week: Tuesday","Day: 2004-10-26<br /># Vehicles in tunnel: 113071<br />Day of Week: Tuesday","Day: 2004-11-02<br /># Vehicles in tunnel: 111004<br />Day of Week: Tuesday","Day: 2004-11-09<br /># Vehicles in tunnel: 109222<br />Day of Week: Tuesday","Day: 2004-11-16<br /># Vehicles in tunnel: 111251<br />Day of Week: Tuesday","Day: 2004-11-23<br /># Vehicles in tunnel: 110716<br />Day of Week: Tuesday","Day: 2004-11-30<br /># Vehicles in tunnel: 112114<br />Day of Week: Tuesday","Day: 2004-12-07<br /># Vehicles in tunnel: 113405<br />Day of Week: Tuesday","Day: 2004-12-14<br /># Vehicles in tunnel: 112880<br />Day of Week: Tuesday","Day: 2004-12-21<br /># Vehicles in tunnel: 112024<br />Day of Week: Tuesday","Day: 2004-12-28<br /># Vehicles in tunnel:  92113<br />Day of Week: Tuesday","Day: 2005-01-04<br /># Vehicles in tunnel:  94312<br />Day of Week: Tuesday","Day: 2005-01-11<br /># Vehicles in tunnel: 104401<br />Day of Week: Tuesday","Day: 2005-01-18<br /># Vehicles in tunnel: 106606<br />Day of Week: Tuesday","Day: 2005-01-25<br /># Vehicles in tunnel:  98867<br />Day of Week: Tuesday","Day: 2005-02-01<br /># Vehicles in tunnel:  98135<br />Day of Week: Tuesday","Day: 2005-02-08<br /># Vehicles in tunnel: 102958<br />Day of Week: Tuesday","Day: 2005-02-15<br /># Vehicles in tunnel:  96739<br />Day of Week: Tuesday","Day: 2005-02-22<br /># Vehicles in tunnel: 101775<br />Day of Week: Tuesday","Day: 2005-03-01<br /># Vehicles in tunnel: 108108<br />Day of Week: Tuesday","Day: 2005-03-08<br /># Vehicles in tunnel: 104966<br />Day of Week: Tuesday","Day: 2005-03-15<br /># Vehicles in tunnel: 111848<br />Day of Week: Tuesday","Day: 2005-03-22<br /># Vehicles in tunnel: 116986<br />Day of Week: Tuesday","Day: 2005-03-29<br /># Vehicles in tunnel: 116328<br />Day of Week: Tuesday","Day: 2005-04-05<br /># Vehicles in tunnel: 115811<br />Day of Week: Tuesday","Day: 2005-04-12<br /># Vehicles in tunnel: 113554<br />Day of Week: Tuesday","Day: 2005-04-19<br /># Vehicles in tunnel: 113771<br />Day of Week: Tuesday","Day: 2005-04-26<br /># Vehicles in tunnel: 115921<br />Day of Week: Tuesday","Day: 2005-05-03<br /># Vehicles in tunnel: 115493<br />Day of Week: Tuesday","Day: 2005-05-10<br /># Vehicles in tunnel: 114948<br />Day of Week: Tuesday","Day: 2005-05-17<br /># Vehicles in tunnel: 117634<br />Day of Week: Tuesday","Day: 2005-05-24<br /># Vehicles in tunnel: 117490<br />Day of Week: Tuesday","Day: 2005-05-31<br /># Vehicles in tunnel: 116572<br />Day of Week: Tuesday","Day: 2005-06-07<br /># Vehicles in tunnel: 116348<br />Day of Week: Tuesday","Day: 2005-06-14<br /># Vehicles in tunnel: 116187<br />Day of Week: Tuesday","Day: 2005-06-21<br /># Vehicles in tunnel: 115261<br />Day of Week: Tuesday","Day: 2005-06-28<br /># Vehicles in tunnel: 115929<br />Day of Week: Tuesday","Day: 2005-07-05<br /># Vehicles in tunnel: 116471<br />Day of Week: Tuesday","Day: 2005-07-12<br /># Vehicles in tunnel: 111813<br />Day of Week: Tuesday","Day: 2005-07-19<br /># Vehicles in tunnel: 107705<br />Day of Week: Tuesday","Day: 2005-07-26<br /># Vehicles in tunnel: 104704<br />Day of Week: Tuesday","Day: 2005-08-02<br /># Vehicles in tunnel: 110359<br />Day of Week: Tuesday","Day: 2005-08-09<br /># Vehicles in tunnel: 113565<br />Day of Week: Tuesday","Day: 2005-08-16<br /># Vehicles in tunnel: 116287<br />Day of Week: Tuesday","Day: 2005-08-23<br /># Vehicles in tunnel: 119640<br />Day of Week: Tuesday","Day: 2005-08-30<br /># Vehicles in tunnel: 117562<br />Day of Week: Tuesday","Day: 2005-09-06<br /># Vehicles in tunnel: 114318<br />Day of Week: Tuesday","Day: 2005-09-13<br /># Vehicles in tunnel: 114575<br />Day of Week: Tuesday","Day: 2005-09-20<br /># Vehicles in tunnel: 115000<br />Day of Week: Tuesday","Day: 2005-09-27<br /># Vehicles in tunnel: 115827<br />Day of Week: Tuesday","Day: 2005-10-04<br /># Vehicles in tunnel: 111446<br />Day of Week: Tuesday","Day: 2005-10-11<br /># Vehicles in tunnel: 112019<br />Day of Week: Tuesday","Day: 2005-10-18<br /># Vehicles in tunnel: 114643<br />Day of Week: Tuesday","Day: 2005-10-25<br /># Vehicles in tunnel: 116713<br />Day of Week: Tuesday","Day: 2005-11-01<br /># Vehicles in tunnel: 117629<br />Day of Week: Tuesday","Day: 2005-11-08<br /># Vehicles in tunnel: 113682<br />Day of Week: Tuesday","Day: 2005-11-15<br /># Vehicles in tunnel: 114296<br />Day of Week: Tuesday"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(165,138,255,1)","dash":"solid"},"hoveron":"points","name":"Tuesday","legendgroup":"Tuesday","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1067990400,1068595200,1069200000,1069804800,1070409600,1071014400,1071619200,1072224000,1072828800,1073433600,1074038400,1074643200,1075248000,1075852800,1076457600,1077062400,1077667200,1078272000,1078876800,1079481600,1080086400,1080691200,1081296000,1081900800,1082505600,1083110400,1083715200,1084320000,1084924800,1085529600,1086134400,1086739200,1087344000,1087948800,1088553600,1089158400,1089763200,1090368000,1090972800,1091577600,1092182400,1092787200,1093392000,1093996800,1094601600,1095206400,1095811200,1096416000,1097020800,1097625600,1098230400,1098835200,1099440000,1100044800,1100649600,1101254400,1101859200,1102464000,1103068800,1103673600,1104278400,1104883200,1105488000,1106092800,1106697600,1107302400,1107907200,1108512000,1109116800,1109721600,1110326400,1110931200,1111536000,1112140800,1112745600,1113350400,1113955200,1114560000,1115164800,1115769600,1116374400,1116979200,1117584000,1118188800,1118793600,1119398400,1120003200,1120608000,1121212800,1121817600,1122422400,1123027200,1123632000,1124236800,1124841600,1125446400,1126051200,1126656000,1127260800,1127865600,1128470400,1129075200,1129680000,1130284800,1130889600,1131494400,1132099200],"y":[106569,105707,104951,108092,108085,106046,110116,85453,69097,93399,101949,102939,91359,100312,97897,102183,104769,106266,106943,109856,106992,112579,115853,78507,109132,108907,108400,109693,118356,108257,113571,110010,109912,108925,111202,108627,104933,100800,103401,106045,113653,115260,116264,116694,116836,115429,115786,113489,112265,116902,115333,118935,115475,114327,114939,114749,115702,118597,118018,115584,94076,100961,108275,107055,105962,101917,105418,100696,105425,110717,111765,118230,124493,121326,120461,116409,117451,120044,126497,119588,120835,124565,119382,120433,121635,123895,121116,117421,114745,108943,106882,110603,118494,120706,123666,119893,118455,116712,119110,122445,113284,113990,118033,121010,117854,116443,114690],"text":["Day: 2003-11-05<br /># Vehicles in tunnel: 106569<br />Day of Week: Wednesday","Day: 2003-11-12<br /># Vehicles in tunnel: 105707<br />Day of Week: Wednesday","Day: 2003-11-19<br /># Vehicles in tunnel: 104951<br />Day of Week: Wednesday","Day: 2003-11-26<br /># Vehicles in tunnel: 108092<br />Day of Week: Wednesday","Day: 2003-12-03<br /># Vehicles in tunnel: 108085<br />Day of Week: Wednesday","Day: 2003-12-10<br /># Vehicles in tunnel: 106046<br />Day of Week: Wednesday","Day: 2003-12-17<br /># Vehicles in tunnel: 110116<br />Day of Week: Wednesday","Day: 2003-12-24<br /># Vehicles in tunnel:  85453<br />Day of Week: Wednesday","Day: 2003-12-31<br /># Vehicles in tunnel:  69097<br />Day of Week: Wednesday","Day: 2004-01-07<br /># Vehicles in tunnel:  93399<br />Day of Week: Wednesday","Day: 2004-01-14<br /># Vehicles in tunnel: 101949<br />Day of Week: Wednesday","Day: 2004-01-21<br /># Vehicles in tunnel: 102939<br />Day of Week: Wednesday","Day: 2004-01-28<br /># Vehicles in tunnel:  91359<br />Day of Week: Wednesday","Day: 2004-02-04<br /># Vehicles in tunnel: 100312<br />Day of Week: Wednesday","Day: 2004-02-11<br /># Vehicles in tunnel:  97897<br />Day of Week: Wednesday","Day: 2004-02-18<br /># Vehicles in tunnel: 102183<br />Day of Week: Wednesday","Day: 2004-02-25<br /># Vehicles in tunnel: 104769<br />Day of Week: Wednesday","Day: 2004-03-03<br /># Vehicles in tunnel: 106266<br />Day of Week: Wednesday","Day: 2004-03-10<br /># Vehicles in tunnel: 106943<br />Day of Week: Wednesday","Day: 2004-03-17<br /># Vehicles in tunnel: 109856<br />Day of Week: Wednesday","Day: 2004-03-24<br /># Vehicles in tunnel: 106992<br />Day of Week: Wednesday","Day: 2004-03-31<br /># Vehicles in tunnel: 112579<br />Day of Week: Wednesday","Day: 2004-04-07<br /># Vehicles in tunnel: 115853<br />Day of Week: Wednesday","Day: 2004-04-14<br /># Vehicles in tunnel:  78507<br />Day of Week: Wednesday","Day: 2004-04-21<br /># Vehicles in tunnel: 109132<br />Day of Week: Wednesday","Day: 2004-04-28<br /># Vehicles in tunnel: 108907<br />Day of Week: Wednesday","Day: 2004-05-05<br /># Vehicles in tunnel: 108400<br />Day of Week: Wednesday","Day: 2004-05-12<br /># Vehicles in tunnel: 109693<br />Day of Week: Wednesday","Day: 2004-05-19<br /># Vehicles in tunnel: 118356<br />Day of Week: Wednesday","Day: 2004-05-26<br /># Vehicles in tunnel: 108257<br />Day of Week: Wednesday","Day: 2004-06-02<br /># Vehicles in tunnel: 113571<br />Day of Week: Wednesday","Day: 2004-06-09<br /># Vehicles in tunnel: 110010<br />Day of Week: Wednesday","Day: 2004-06-16<br /># Vehicles in tunnel: 109912<br />Day of Week: Wednesday","Day: 2004-06-23<br /># Vehicles in tunnel: 108925<br />Day of Week: Wednesday","Day: 2004-06-30<br /># Vehicles in tunnel: 111202<br />Day of Week: Wednesday","Day: 2004-07-07<br /># Vehicles in tunnel: 108627<br />Day of Week: Wednesday","Day: 2004-07-14<br /># Vehicles in tunnel: 104933<br />Day of Week: Wednesday","Day: 2004-07-21<br /># Vehicles in tunnel: 100800<br />Day of Week: Wednesday","Day: 2004-07-28<br /># Vehicles in tunnel: 103401<br />Day of Week: Wednesday","Day: 2004-08-04<br /># Vehicles in tunnel: 106045<br />Day of Week: Wednesday","Day: 2004-08-11<br /># Vehicles in tunnel: 113653<br />Day of Week: Wednesday","Day: 2004-08-18<br /># Vehicles in tunnel: 115260<br />Day of Week: Wednesday","Day: 2004-08-25<br /># Vehicles in tunnel: 116264<br />Day of Week: Wednesday","Day: 2004-09-01<br /># Vehicles in tunnel: 116694<br />Day of Week: Wednesday","Day: 2004-09-08<br /># Vehicles in tunnel: 116836<br />Day of Week: Wednesday","Day: 2004-09-15<br /># Vehicles in tunnel: 115429<br />Day of Week: Wednesday","Day: 2004-09-22<br /># Vehicles in tunnel: 115786<br />Day of Week: Wednesday","Day: 2004-09-29<br /># Vehicles in tunnel: 113489<br />Day of Week: Wednesday","Day: 2004-10-06<br /># Vehicles in tunnel: 112265<br />Day of Week: Wednesday","Day: 2004-10-13<br /># Vehicles in tunnel: 116902<br />Day of Week: Wednesday","Day: 2004-10-20<br /># Vehicles in tunnel: 115333<br />Day of Week: Wednesday","Day: 2004-10-27<br /># Vehicles in tunnel: 118935<br />Day of Week: Wednesday","Day: 2004-11-03<br /># Vehicles in tunnel: 115475<br />Day of Week: Wednesday","Day: 2004-11-10<br /># Vehicles in tunnel: 114327<br />Day of Week: Wednesday","Day: 2004-11-17<br /># Vehicles in tunnel: 114939<br />Day of Week: Wednesday","Day: 2004-11-24<br /># Vehicles in tunnel: 114749<br />Day of Week: Wednesday","Day: 2004-12-01<br /># Vehicles in tunnel: 115702<br />Day of Week: Wednesday","Day: 2004-12-08<br /># Vehicles in tunnel: 118597<br />Day of Week: Wednesday","Day: 2004-12-15<br /># Vehicles in tunnel: 118018<br />Day of Week: Wednesday","Day: 2004-12-22<br /># Vehicles in tunnel: 115584<br />Day of Week: Wednesday","Day: 2004-12-29<br /># Vehicles in tunnel:  94076<br />Day of Week: Wednesday","Day: 2005-01-05<br /># Vehicles in tunnel: 100961<br />Day of Week: Wednesday","Day: 2005-01-12<br /># Vehicles in tunnel: 108275<br />Day of Week: Wednesday","Day: 2005-01-19<br /># Vehicles in tunnel: 107055<br />Day of Week: Wednesday","Day: 2005-01-26<br /># Vehicles in tunnel: 105962<br />Day of Week: Wednesday","Day: 2005-02-02<br /># Vehicles in tunnel: 101917<br />Day of Week: Wednesday","Day: 2005-02-09<br /># Vehicles in tunnel: 105418<br />Day of Week: Wednesday","Day: 2005-02-16<br /># Vehicles in tunnel: 100696<br />Day of Week: Wednesday","Day: 2005-02-23<br /># Vehicles in tunnel: 105425<br />Day of Week: Wednesday","Day: 2005-03-02<br /># Vehicles in tunnel: 110717<br />Day of Week: Wednesday","Day: 2005-03-09<br /># Vehicles in tunnel: 111765<br />Day of Week: Wednesday","Day: 2005-03-16<br /># Vehicles in tunnel: 118230<br />Day of Week: Wednesday","Day: 2005-03-23<br /># Vehicles in tunnel: 124493<br />Day of Week: Wednesday","Day: 2005-03-30<br /># Vehicles in tunnel: 121326<br />Day of Week: Wednesday","Day: 2005-04-06<br /># Vehicles in tunnel: 120461<br />Day of Week: Wednesday","Day: 2005-04-13<br /># Vehicles in tunnel: 116409<br />Day of Week: Wednesday","Day: 2005-04-20<br /># Vehicles in tunnel: 117451<br />Day of Week: Wednesday","Day: 2005-04-27<br /># Vehicles in tunnel: 120044<br />Day of Week: Wednesday","Day: 2005-05-04<br /># Vehicles in tunnel: 126497<br />Day of Week: Wednesday","Day: 2005-05-11<br /># Vehicles in tunnel: 119588<br />Day of Week: Wednesday","Day: 2005-05-18<br /># Vehicles in tunnel: 120835<br />Day of Week: Wednesday","Day: 2005-05-25<br /># Vehicles in tunnel: 124565<br />Day of Week: Wednesday","Day: 2005-06-01<br /># Vehicles in tunnel: 119382<br />Day of Week: Wednesday","Day: 2005-06-08<br /># Vehicles in tunnel: 120433<br />Day of Week: Wednesday","Day: 2005-06-15<br /># Vehicles in tunnel: 121635<br />Day of Week: Wednesday","Day: 2005-06-22<br /># Vehicles in tunnel: 123895<br />Day of Week: Wednesday","Day: 2005-06-29<br /># Vehicles in tunnel: 121116<br />Day of Week: Wednesday","Day: 2005-07-06<br /># Vehicles in tunnel: 117421<br />Day of Week: Wednesday","Day: 2005-07-13<br /># Vehicles in tunnel: 114745<br />Day of Week: Wednesday","Day: 2005-07-20<br /># Vehicles in tunnel: 108943<br />Day of Week: Wednesday","Day: 2005-07-27<br /># Vehicles in tunnel: 106882<br />Day of Week: Wednesday","Day: 2005-08-03<br /># Vehicles in tunnel: 110603<br />Day of Week: Wednesday","Day: 2005-08-10<br /># Vehicles in tunnel: 118494<br />Day of Week: Wednesday","Day: 2005-08-17<br /># Vehicles in tunnel: 120706<br />Day of Week: Wednesday","Day: 2005-08-24<br /># Vehicles in tunnel: 123666<br />Day of Week: Wednesday","Day: 2005-08-31<br /># Vehicles in tunnel: 119893<br />Day of Week: Wednesday","Day: 2005-09-07<br /># Vehicles in tunnel: 118455<br />Day of Week: Wednesday","Day: 2005-09-14<br /># Vehicles in tunnel: 116712<br />Day of Week: Wednesday","Day: 2005-09-21<br /># Vehicles in tunnel: 119110<br />Day of Week: Wednesday","Day: 2005-09-28<br /># Vehicles in tunnel: 122445<br />Day of Week: Wednesday","Day: 2005-10-05<br /># Vehicles in tunnel: 113284<br />Day of Week: Wednesday","Day: 2005-10-12<br /># Vehicles in tunnel: 113990<br />Day of Week: Wednesday","Day: 2005-10-19<br /># Vehicles in tunnel: 118033<br />Day of Week: Wednesday","Day: 2005-10-26<br /># Vehicles in tunnel: 121010<br />Day of Week: Wednesday","Day: 2005-11-02<br /># Vehicles in tunnel: 117854<br />Day of Week: Wednesday","Day: 2005-11-09<br /># Vehicles in tunnel: 116443<br />Day of Week: Wednesday","Day: 2005-11-16<br /># Vehicles in tunnel: 114690<br />Day of Week: Wednesday"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(251,97,215,1)","dash":"solid"},"hoveron":"points","name":"Wednesday","legendgroup":"Wednesday","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":54.794520547945211},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1064422080,1135321920],"tickmode":"array","ticktext":["2004-01","2004-07","2005-01","2005-07"],"tickvals":[1072915200,1088640000,1104537600,1120176000],"categoryorder":"array","categoryarray":["2004-01","2004-07","2005-01","2005-07"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"y","title":{"text":"Day","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-6992,146832],"tickmode":"array","ticktext":["0e+00","5e+04","1e+05"],"tickvals":[0,50000,100000],"categoryorder":"array","categoryarray":["0e+00","5e+04","1e+05"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"x","title":{"text":"# Vehicles in tunnel","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Day of Week","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"55884a5007a6":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"55884a5007a6","visdat":{"55884a5007a6":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Plotly enables interactive filtering. Double click on <code>Day of Week</code> element in the legend to isolate a single day, subsequent clicks add additional days back to the displayed data. For example, by removing everything except Thursday and Saturday, you can reproduce the image below using the interactive plotly image above.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image/TunnelTrafic_plotly_example.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Example Plotly Image filtered by Day of Week</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="chapter-3---performance-evaluation" class="level1">
<h1>Chapter 3 - Performance Evaluation</h1>
<p>Scripts adapted from <a href="https://www.forecastingbook.com/resources/data-and-code">Practical Time Series Forecasting - Datasets &amp; R Code</a></p>
<section id="data-partitioning" class="level2">
<h2 class="anchored" data-anchor-id="data-partitioning">3.1 Data Partitioning</h2>
<section id="figure-3.1" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.1">Figure 3.1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>amtrak_csv <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Amtrak data.csv"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>Amtrak.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(amtrak_csv)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>ridership.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Amtrak.data<span class="sc">$</span>Ridership, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2004</span>, <span class="dv">3</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 3-1</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridership.ts, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2600</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">2004.25</span> <span class="sc">-</span> <span class="dv">3</span> , <span class="fl">2004.25</span> <span class="sc">-</span> <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3500</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">2004.25</span>, <span class="fl">2004.25</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3500</span>))</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">1996.25</span>, <span class="dv">2500</span>, <span class="st">"Training"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">2002.75</span>, <span class="dv">2500</span>, <span class="st">"Validation"</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">2005.25</span>, <span class="dv">2500</span>, <span class="st">"Future"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="dv">2004</span> <span class="sc">-</span> <span class="dv">3</span>,<span class="dv">2450</span>,<span class="fl">1991.25</span>,<span class="dv">2450</span>,<span class="at">code=</span><span class="dv">3</span>,<span class="at">length=</span><span class="fl">0.1</span>,<span class="at">lwd=</span><span class="dv">1</span>,<span class="at">angle=</span><span class="dv">30</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="fl">2004.5</span> <span class="sc">-</span> <span class="dv">3</span>,<span class="dv">2450</span>,<span class="dv">2004</span>,<span class="dv">2450</span>,<span class="at">code=</span><span class="dv">3</span>,<span class="at">length=</span><span class="fl">0.1</span>,<span class="at">lwd=</span><span class="dv">1</span>,<span class="at">angle=</span><span class="dv">30</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="fl">2004.5</span>,<span class="dv">2450</span>,<span class="dv">2006</span>,<span class="dv">2450</span>,<span class="at">code=</span><span class="dv">3</span>,<span class="at">length=</span><span class="fl">0.1</span>,<span class="at">lwd=</span><span class="dv">1</span>,<span class="at">angle=</span><span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Since the textbook omits the annotation in it’s examples beyond Figure 3.1 for clarity, there is a mismatch between the code and the graphics output. We’ll create a simple function t add the annotation to subsequent plots to keep the examples minimal. Here is Figure 3.1 reproduced with the annotation function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'code'</span>, <span class="st">'ptfs_functions.R'</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>amtrak_ts_annotations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (y = 2500, y_pad = 50) 
{
    lines(c(2004.25 - 3, 2004.25 - 3), c(-3500, 3500))
    lines(c(2004.25, 2004.25), c(-3500, 3500))
    text(1996.25, y, "Training")
    text(2002.75, y, "Validation")
    text(2005.25, y, "Future")
    arrows(2004 - 3, y - y_pad, 1991.25, y - y_pad, code = 3, 
        length = 0.1, lwd = 1, angle = 30)
    arrows(2004.5 - 3, y - y_pad, 2004, y - y_pad, code = 3, 
        length = 0.1, lwd = 1, angle = 30)
    arrows(2004.5, y - y_pad, 2006, y - y_pad, code = 3, length = 0.1, 
        lwd = 1, angle = 30)
}</code></pre>
</div>
</div>
</section>
<section id="updated-figure-3.1" class="level3">
<h3 class="anchored" data-anchor-id="updated-figure-3.1">Updated Figure 3.1</h3>
<p>Updating the code using the <code>tidyverse</code> and <code>tidyverts</code> frameworks requires an updated annotation function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ridership_annotation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (plt, y = 2500, trn_month = yearmonth("2001 Apr"), val_month = yearmonth("2004 Apr")) 
{
    y_txt &lt;- y + 75
    y_arrow &lt;- y
    tv_date &lt;- as.Date(trn_month)
    vf_date &lt;- as.Date(val_month)
    min_date &lt;- as.Date(min(plt$data$Month))
    max_date &lt;- as.Date(max(plt$data$Month))
    plt + geom_vline(xintercept = tv_date) + geom_vline(xintercept = as.Date(vf_date)) + 
        annotate("text", x = ymd("1999 Apr 01"), y = y_txt, label = "Training") + 
        annotate("text", x = ymd("2002 Oct 01"), y = y_txt, label = "Validation") + 
        annotate("text", x = ymd("2005 Apr 01"), y = y_txt, label = "Future") + 
        annotate("segment", arrow = arrow_look(), x = min_date + 
            days(30), y = y_arrow, xend = tv_date - days(30), 
            yend = y_arrow) + annotate("segment", arrow = arrow_look(), 
        x = tv_date + days(30), y = y_arrow, xend = vf_date - 
            days(30), yend = y_arrow) + annotate("segment", arrow = arrow_look(), 
        x = vf_date + days(30), y = y_arrow, xend = max_date - 
            days(30), yend = y_arrow) + theme_minimal()
}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>ridership <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Amtrak data.xls"</span>), </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"numeric"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">yearmonth</span>(Month)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Month)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>ridership_h <span class="ot">&lt;-</span> ridership <span class="sc">%&gt;%</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">append_row</span>(<span class="at">n =</span> <span class="dv">21</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>ridership_h <span class="sc">%&gt;%</span> </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Ridership)  <span class="sc">%&gt;%</span> </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ridership_annotation</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="figure-3.2" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.2">Figure 3.2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>stepsAhead <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> stepsAhead</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> stepsAhead))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>ridership.lm <span class="ot">&lt;-</span>  <span class="fu">tslm</span>(train.ts <span class="sc">~</span> trend <span class="sc">+</span> <span class="fu">I</span>(trend<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ridership.lm.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ridership.lm, <span class="at">h =</span> stepsAhead, <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 3-2</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridership.lm.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2600</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>, <span class="at">flty =</span> <span class="dv">2</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>))) </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ridership.lm<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">2500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="updated-figure-3.2" class="level3">
<h3 class="anchored" data-anchor-id="updated-figure-3.2">Updated Figure 3.2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fable) </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>ridership_trn <span class="ot">&lt;-</span> ridership_h <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">"1991 Jan"</span> <span class="sc">~</span> <span class="st">"2001 Mar"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ridership_val <span class="ot">&lt;-</span> ridership_h <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">"2001 Apr"</span> <span class="sc">~</span> <span class="st">"2004 Mar"</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>ridership_tslm <span class="ot">&lt;-</span> ridership_trn <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">tslm =</span> <span class="fu">TSLM</span>(Ridership <span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">trend</span>()<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># forecast the training and validation periods</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>ridership_fit <span class="ot">&lt;-</span> ridership_tslm <span class="sc">%&gt;%</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> <span class="fu">bind_rows</span>(ridership_trn, ridership_val)) <span class="sc">|&gt;</span> </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_training =</span> Month <span class="sc">&lt;=</span> <span class="fu">yearmonth</span>(<span class="st">"2001 Mar"</span>))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>ridership_h <span class="sc">%&gt;%</span> </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Ridership)  <span class="sc">%&gt;%</span> </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ridership_annotation</span>() <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># autolayer(ridership_fit, level = NULL)  </span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use ggplot functions to better match the original figure from the book</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ridership_fit,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> .mean, <span class="at">color =</span> is_training, <span class="at">linetype =</span> is_training))  <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"skyblue"</span>)) <span class="sc">+</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"dashed"</span>)) <span class="sc">+</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="measuring-predictive-accuracy" class="level2">
<h2 class="anchored" data-anchor-id="measuring-predictive-accuracy">3.3 Measuring Predictive Accuracy</h2>
<section id="table-3.1" class="level3">
<h3 class="anchored" data-anchor-id="table-3.1">Table 3.1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">round</span>(valid.ts <span class="sc">-</span> ridership.lm.pred<span class="sc">$</span>mean, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>table_3_1 <span class="ot">&lt;-</span><span class="fu">cbind</span>(ridership.lm.pred<span class="sc">$</span>mean, valid.ts, res) </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(table_3_1, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ridership.lm.pred$mean valid.ts     res
Apr 2001               1932.454 2023.792  91.338
May 2001               1939.508 2047.008 107.500
Jun 2001               1946.670 2072.913 126.243</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">'...'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(table_3_1, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ridership.lm.pred$mean valid.ts      res
Mar 2004               2243.161 2132.446 -110.715</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(ridership.lm.pred<span class="sc">$</span>mean, valid.ts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                ME     RMSE      MAE       MPE    MAPE      ACF1 Theil's U
Test set -83.96208 179.8494 133.7383 -4.725374 7.07573 0.4170651  1.062068</code></pre>
</div>
</div>
</section>
<section id="updated-table-3.1" class="level3">
<h3 class="anchored" data-anchor-id="updated-table-3.1">Updated Table 3.1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ridership_fc <span class="ot">&lt;-</span> ridership_tslm <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"3 years"</span>) </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(ridership_fc <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>          ridership_fc <span class="sc">|&gt;</span> <span class="fu">tail</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A fable: 4 x 4 [1M]
# Key:     .model [1]
  .model    Month      Ridership .mean
  &lt;chr&gt;     &lt;mth&gt;         &lt;dist&gt; &lt;dbl&gt;
1 tslm   2001 Apr N(1932, 23817) 1932.
2 tslm   2001 May N(1940, 23928) 1940.
3 tslm   2001 Jun N(1947, 24046) 1947.
4 tslm   2004 Mar N(2243, 33069) 2243.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># forecast accuracy for the validation period</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ridership_fc <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(ridership_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 10
  .model .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 tslm   Test  -84.0  180.  134. -4.73  7.08   NaN   NaN 0.417</code></pre>
</div>
</div>
</section>
<section id="figure-3.3" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.3">Figure 3.3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 3-3</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridership.lm.pred<span class="sc">$</span>residuals, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">400</span>, <span class="dv">500</span>),  <span class="at">ylab =</span> <span class="st">"Residuals"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts <span class="sc">-</span> ridership.lm.pred<span class="sc">$</span>mean, <span class="at">lwd =</span> <span class="dv">1</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="figure-3.4" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.4">Figure 3.4</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 3-4</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ridership.lm.pred<span class="sc">$</span>residuals,  <span class="at">ylab =</span> <span class="st">"Frequency"</span>, <span class="at">xlab =</span> <span class="st">"Forecast Error"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="updated-figures-3.3-3.4" class="level3">
<h3 class="anchored" data-anchor-id="updated-figures-3.3-3.4">Updated Figures 3.3 &amp; 3.4</h3>
<p>Rather than reproduce the textbook figures, we’ll use the <code>gg_tsresiduals()</code> function from the <code>fabletools</code> package to more easily create a common visualization of the residuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ridership_tslm  <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="figure-3.5" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.5">Figure 3.5</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>nValid <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> nValid</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> nValid))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>ridership.lm <span class="ot">&lt;-</span>  <span class="fu">tslm</span>(train.ts <span class="sc">~</span> trend <span class="sc">+</span> <span class="fu">I</span>(trend<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>ridership.lm.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ridership.lm, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridership.lm.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2600</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>, <span class="at">flty =</span> <span class="dv">2</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>))) </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ridership.lm<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">2500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="updated-figure-3.5" class="level3">
<h3 class="anchored" data-anchor-id="updated-figure-3.5">Updated Figure 3.5</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ridership_fc <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(ridership_h) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ridership_annotation</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="advanced-data-partitioning-roll-forward-validation" class="level2">
<h2 class="anchored" data-anchor-id="advanced-data-partitioning-roll-forward-validation">3.5 Advanced Data Partitioning: Roll-Forward Validation</h2>
<section id="figure-3.6" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.6">Figure 3.6</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>tumblr_csv <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>, <span class="st">'Tumblr.csv'</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>tumblr.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(tumblr_csv)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>people.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(tumblr.data<span class="sc">$</span>People.Worldwide) <span class="sc">/</span> <span class="dv">1000000</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Run three exponential smoothing models: AAN, MMN, and MMdN.</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># MMN stands for Multiplicative error, Multiplicative trend, and No seasonality. MMdN stands for Multiplicative error, Multiplicative damped trend, and No seasonality.</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>people.ets.AAN <span class="ot">&lt;-</span> <span class="fu">ets</span>(people.ts, <span class="at">model =</span> <span class="st">"AAN"</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>people.ets.MMN <span class="ot">&lt;-</span> <span class="fu">ets</span>(people.ts, <span class="at">model =</span> <span class="st">"MMN"</span>, <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>people.ets.MMdN <span class="ot">&lt;-</span> <span class="fu">ets</span>(people.ts, <span class="at">model =</span> <span class="st">"MMN"</span>, <span class="at">damped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create their prediction "cones" for 115 months into the future (Jun 2013 to Dec 2022).</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>people.ets.AAN.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(people.ets.AAN, <span class="at">h =</span> <span class="dv">115</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>people.ets.MMN.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(people.ets.MMN, <span class="at">h =</span> <span class="dv">115</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>))</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>people.ets.MMdN.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(people.ets.MMdN, <span class="at">h =</span> <span class="dv">115</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>))</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the three models' "forecast cones" visually.</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)) <span class="co"># This command sets the plot window to show 1 row of 3 plots.</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(people.ets.AAN.pred, <span class="at">xlab =</span> <span class="st">"Month"</span>, <span class="at">ylab =</span> <span class="st">"People (in millions)"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>))</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(people.ets.MMN.pred, <span class="at">xlab =</span> <span class="st">"Month"</span>, <span class="at">ylab=</span><span class="st">"People (in millions)"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>))</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(people.ets.MMdN.pred, <span class="at">xlab =</span> <span class="st">"Month"</span>, <span class="at">ylab=</span><span class="st">"People (in millions)"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the lower and upper limits of the MMN model's prediction cones.</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># people.ets.MMN.pred$lower %&gt;% head()</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># people.ets.MMN.pred$upper %&gt;% tail()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="updated-figure-3.6" class="level3">
<h3 class="anchored" data-anchor-id="updated-figure-3.6">Updated Figure 3.6</h3>
<p>NOTE:</p>
<p>This updated code uncovers a few issues with the <code>fable</code> package at the time of this run. 1. The <code>forecast.ETS()</code> function is slower than the <code>forecast.ets()</code> function for Multiplicative models. This chunck takes about 200 seconds on a MacBook Pro. 2. The level argument is not working (is ignored) for the <code>forecast.ETS()</code> function. 3. autoplot doesn’t display the prediction intervals if they exceed the plot y-axis limits.</p>
<div class="cell" data-hash="Practical-Time-Series-Forecasting---Figures-and-Tables_cache/html/unnamed-chunk-30_7c86ba1e8bec4cb4d99267cec3de95a3">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>tumblr_people <span class="ot">&lt;-</span> tumblr.data <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">id =</span> <span class="fu">row_number</span>(),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">people =</span> People.Worldwide <span class="sc">/</span> <span class="fl">1e6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> id)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#fit 3 ETS models to the data [AAN, MMN, MMdN]</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>tumblr_ets <span class="ot">&lt;-</span> tumblr_people <span class="sc">|&gt;</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ets_ann =</span> <span class="fu">ETS</span>(people <span class="sc">~</span> <span class="fu">error</span>(<span class="st">'A'</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">'A'</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">'N'</span>)),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ets_mmn =</span> <span class="fu">ETS</span>(people <span class="sc">~</span> <span class="fu">error</span>(<span class="st">'M'</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">'M'</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">'N'</span>)),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">ets_mmdn =</span> <span class="fu">ETS</span>(people <span class="sc">~</span> <span class="fu">error</span>(<span class="st">'M'</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">'Md'</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">'N'</span>)))</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">#forecast 115 months into the future</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tictoc)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>tumblr_fc <span class="ot">&lt;-</span> tumblr_ets <span class="sc">|&gt;</span> </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">115</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>))</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>tcapture <span class="ot">&lt;-</span> <span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>129.526 sec elapsed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(tumblr_fc, tumblr_people) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(. <span class="sc">~</span> .model) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">1000</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="st">'none'</span>, <span class="at">fill =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">rep</span>(<span class="st">'blue'</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rep</span>(<span class="st">'blue'</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="figure-3.7" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.7">Figure 3.7</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fixed.nValid <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fixed.nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> fixed.nValid</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, fixed.nTrain))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, fixed.nTrain <span class="sc">+</span> fixed.nValid))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>naive.fixed <span class="ot">&lt;-</span> <span class="fu">naive</span>(train.ts, <span class="at">h =</span> fixed.nValid)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>naive.roll <span class="ot">&lt;-</span> <span class="fu">ts</span>(Amtrak.data<span class="sc">$</span>Ridership[fixed.nTrain<span class="sc">:</span>(fixed.nTrain <span class="sc">+</span> fixed.nValid <span class="sc">-</span> <span class="dv">1</span>)], <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, fixed.nTrain <span class="sc">+</span> fixed.nValid), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 3-6</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.ts, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2600</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(naive.fixed<span class="sc">$</span>mean, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(naive.roll, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="updated-figure-3.7" class="level3">
<h3 class="anchored" data-anchor-id="updated-figure-3.7">Updated Figure 3.7</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a rolling forecast with the naive method</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>ridership_roll_naive <span class="ot">&lt;-</span> ridership <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">'2001 Mar'</span> <span class="sc">~</span> <span class="st">'2004 Mar'</span>) <span class="sc">|&gt;</span>  <span class="co"># only need the last point for naive forecast</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stretch_tsibble</span>(<span class="at">.init =</span> <span class="dv">1</span>, <span class="at">.step =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.id <span class="sc">!=</span> <span class="fu">max</span>(.id)) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">naive =</span> <span class="fu">NAIVE</span>(Ridership)) </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>ridership_roll_naive_fc1 <span class="ot">&lt;-</span> ridership_roll_naive <span class="sc">|&gt;</span> </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">1</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create a rolling forecast with the fixed method</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>ridership_naive_fixed <span class="ot">&lt;-</span> ridership_trn <span class="sc">|&gt;</span> </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">naive =</span> <span class="fu">NAIVE</span>(Ridership)) </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>ridership_naive_fixed_fc <span class="ot">&lt;-</span> ridership_naive_fixed <span class="sc">|&gt;</span> </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">36</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(ridership_h, Ridership) <span class="sc">|&gt;</span> </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ridership_annotation</span>() <span class="sc">+</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> ridership_roll_naive_fc1, <span class="fu">aes</span>(Month, .mean), <span class="at">color =</span> <span class="st">'blue'</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(ridership_naive_fixed_fc, <span class="at">level =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="st">'purple'</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="table-3.3" class="level3">
<h3 class="anchored" data-anchor-id="table-3.3">Table 3.3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tidyverse))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>fixed.nValid <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>fixed.nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> fixed.nValid</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>mae <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,fixed.nValid)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,fixed.nValid)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>mape <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,fixed.nValid)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">36</span>) {</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  stepsAhead <span class="ot">&lt;-</span> i</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  error <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, fixed.nValid <span class="sc">-</span> stepsAhead <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  percent.error <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, fixed.nValid <span class="sc">-</span> stepsAhead <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> fixed.nTrain<span class="sc">:</span>(fixed.nTrain <span class="sc">+</span> fixed.nValid <span class="sc">-</span> stepsAhead)) {</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, j))</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, j <span class="sc">+</span> stepsAhead), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, j <span class="sc">+</span> stepsAhead))</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    naive.pred <span class="ot">&lt;-</span> <span class="fu">naive</span>(train.ts, <span class="at">h =</span> stepsAhead)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    error[j <span class="sc">-</span> fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> valid.ts <span class="sc">-</span> naive.pred<span class="sc">$</span>mean[stepsAhead]</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    percent.error[j <span class="sc">-</span> fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> error[j <span class="sc">-</span> fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> valid.ts</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  mae[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(error))</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  rmse[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(error<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  mape[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(percent.error))</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co"># mean(mae)</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co"># mean(rmse)</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="co"># mean(mape)</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, fixed.nTrain))</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, fixed.nTrain <span class="sc">+</span> fixed.nValid))</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>naive.pred <span class="ot">&lt;-</span> <span class="fu">naive</span>(train.ts, <span class="at">h =</span> fixed.nValid)</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>snaive.pred <span class="ot">&lt;-</span> <span class="fu">snaive</span>(train.ts, <span class="at">h =</span> fixed.nValid)</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy(naive.pred, valid.ts)</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy(snaive.pred, valid.ts)</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>naive_acc <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">accuracy</span>(naive.pred, valid.ts)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>method_desc <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">'Rolling Forward %d-months ahead'</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mae))</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>table_3_3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Method =</span> method_desc, <span class="at">MAE =</span> mae, <span class="at">RMSE =</span> rmse, <span class="at">MAPE =</span> mape) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">Method =</span> <span class="st">'Roll Forward Overall'</span>,</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>                                                                                                    <span class="at">MAE =</span> <span class="fu">mean</span>(mae),</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>                                                                                                    <span class="at">RMSE =</span> <span class="fu">mean</span>(rmse),</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>                                                                                                    <span class="at">MAPE =</span> <span class="fu">mean</span>(mape)),</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>                                                                                             <span class="fu">tibble</span>(<span class="at">Method =</span> <span class="st">'Fixed Partition Overall'</span>,</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>                                                                                                    <span class="at">MAE =</span> naive_acc[<span class="st">'Test set'</span>, <span class="st">'MAE'</span>],</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>                                                                                                    <span class="at">RMSE =</span> naive_acc[<span class="st">'Test set'</span>, <span class="st">'RMSE'</span>],</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>                                                                                                    <span class="at">MAPE =</span> naive_acc[<span class="st">'Test set'</span>, <span class="st">'MAPE'</span>]))</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>table_3_3_abbr <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>  table_3_3[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ],</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">Method =</span> <span class="st">'...'</span>),</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>  table_3_3[<span class="dv">36</span><span class="sc">:</span><span class="dv">38</span>,]</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>table_3_3_abbr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  Method                            MAE  RMSE    MAPE
  &lt;chr&gt;                           &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 Rolling Forward 1-months ahead   119.  169.  0.0621
2 Rolling Forward 2-months ahead   160.  198.  0.0827
3 Rolling Forward 3-months ahead   168.  196.  0.0864
4 ...                               NA    NA  NA     
5 Rolling Forward 36-months ahead  125.  125.  0.0584
6 Roll Forward Overall             158.  190.  0.0797
7 Fixed Partition Overall          116.  143.  6.02  </code></pre>
</div>
</div>
</section>
<section id="updated-table-3.3" class="level3">
<h3 class="anchored" data-anchor-id="updated-table-3.3">Updated Table 3.3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ridership_roll_naive_fc <span class="ot">&lt;-</span> ridership_roll_naive <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">36</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(. <span class="sc">~</span> <span class="st">"2004 Apr"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.id) <span class="sc">|&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_fable</span>(<span class="at">response =</span> <span class="st">"Ridership"</span>, <span class="at">distribution =</span> Ridership)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>acc33_table <span class="ot">&lt;-</span> ridership_roll_naive_fc <span class="sc">|&gt;</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(ridership, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"h"</span>, <span class="st">".model"</span>)) </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>acc33_table <span class="sc">|&gt;</span> </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="fu">sprintf</span>(<span class="st">'Roll Forward %d-months ahead'</span>, h)) <span class="sc">|&gt;</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Method, RMSE, MAE, MAPE) <span class="sc">|&gt;</span> </span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">36</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  Method                        RMSE   MAE  MAPE
  &lt;chr&gt;                        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Roll Forward 1-months ahead   169.  119.  6.21
2 Roll Forward 2-months ahead   198.  160.  8.27
3 Roll Forward 3-months ahead   196.  168.  8.64
4 Roll Forward 36-months ahead  125.  125.  5.84</code></pre>
</div>
</div>
</section>
<section id="table-3.4" class="level3">
<h3 class="anchored" data-anchor-id="table-3.4">Table 3.4</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(lubridate))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>table_3_4 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> naive.pred <span class="sc">%&gt;%</span> as.data.frame <span class="sc">%&gt;%</span> <span class="fu">row.names.data.frame</span>(),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Actual =</span> valid.ts,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Naive Forecast</span><span class="st">`</span> <span class="ot">=</span> naive.pred<span class="sc">$</span>mean,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Seasonal Naive Forecast</span><span class="st">`</span> <span class="ot">=</span> snaive.pred<span class="sc">$</span>mean</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>table_3_4_disp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  table_3_4[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ],</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">Period =</span> <span class="st">'...'</span>),</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  table_3_4[<span class="fu">nrow</span>(table_3_4), ]</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>table_3_4_disp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  Period   Actual `Naive Forecast` `Seasonal Naive Forecast`
  &lt;chr&gt;     &lt;dbl&gt;            &lt;dbl&gt;                     &lt;dbl&gt;
1 Apr 2001  2024.            2008.                     1971.
2 May 2001  2047.            2008.                     1992.
3 Jun 2001  2073.            2008.                     2010.
4 ...         NA               NA                        NA 
5 Mar 2004  2132.            2008.                     2008.</code></pre>
</div>
</div>
</section>
<section id="table-3.5" class="level3">
<h3 class="anchored" data-anchor-id="table-3.5">Table 3.5</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>snaive.pred <span class="ot">&lt;-</span> <span class="fu">snaive</span>(train.ts, <span class="at">h =</span> fixed.nValid)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>snaive_acc <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">accuracy</span>(snaive.pred, valid.ts)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>table_3_5 <span class="ot">&lt;-</span>  <span class="fu">bind_rows</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">Method =</span> <span class="st">'Naive Forecast'</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">MAE =</span> naive_acc[<span class="st">'Test set'</span>, <span class="st">'MAE'</span>],</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">RMSE =</span> naive_acc[<span class="st">'Test set'</span>, <span class="st">'RMSE'</span>],</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">MAPE =</span> naive_acc[<span class="st">'Test set'</span>, <span class="st">'MAPE'</span>]),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">Method =</span> <span class="st">'Seasonal Naive Forecast'</span>,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">MAE =</span> snaive_acc[<span class="st">'Test set'</span>, <span class="st">'MAE'</span>],</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">RMSE =</span> snaive_acc[<span class="st">'Test set'</span>, <span class="st">'RMSE'</span>],</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">MAPE =</span> snaive_acc[<span class="st">'Test set'</span>, <span class="st">'MAPE'</span>]))</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>table_3_5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  Method                    MAE  RMSE  MAPE
  &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Naive Forecast          116.  143.   6.02
2 Seasonal Naive Forecast  84.1  95.6  4.25</code></pre>
</div>
</div>
</section>
<section id="table-3.5-1" class="level3">
<h3 class="anchored" data-anchor-id="table-3.5-1">Table 3.5</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fixed.nValid <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>fixed.nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> fixed.nValid</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>stepsAhead <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>error.naive <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, fixed.nValid <span class="sc">-</span> stepsAhead <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>percent.error.naive <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, fixed.nValid <span class="sc">-</span> stepsAhead <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>error.snaive <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, fixed.nValid <span class="sc">-</span> stepsAhead <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>percent.error.snaive <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, fixed.nValid <span class="sc">-</span> stepsAhead <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> fixed.nTrain<span class="sc">:</span>(fixed.nTrain <span class="sc">+</span> fixed.nValid <span class="sc">-</span> stepsAhead)) {</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, j))</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, j <span class="sc">+</span> stepsAhead), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, j <span class="sc">+</span> stepsAhead))</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  naive.pred <span class="ot">&lt;-</span> <span class="fu">naive</span>(train.ts, <span class="at">h =</span> stepsAhead)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  snaive.pred <span class="ot">&lt;-</span> <span class="fu">snaive</span>(train.ts, <span class="at">h =</span> stepsAhead)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  error.naive[j <span class="sc">-</span> fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> valid.ts <span class="sc">-</span> naive.pred<span class="sc">$</span>mean[stepsAhead]</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  percent.error.naive[j <span class="sc">-</span> fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> error.naive[j <span class="sc">-</span> fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> valid.ts</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  error.snaive[j <span class="sc">-</span> fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> valid.ts <span class="sc">-</span> snaive.pred<span class="sc">$</span>mean[stepsAhead]</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  percent.error.snaive[j <span class="sc">-</span> fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> error.snaive[j <span class="sc">-</span> fixed.nTrain <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> valid.ts</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>table_3_6 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Method =</span> <span class="fu">c</span>(<span class="st">'Naive Forecast'</span>, <span class="st">'Seasonal Naive Forecast'</span>),</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAE =</span> <span class="fu">c</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(error.naive)), <span class="fu">mean</span>(<span class="fu">abs</span>(error.snaive))),</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fu">mean</span>(error.naive<span class="sc">^</span><span class="dv">2</span>)), <span class="fu">sqrt</span>(<span class="fu">mean</span>(error.snaive<span class="sc">^</span><span class="dv">2</span>))),</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAPE =</span> <span class="fu">c</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(percent.error.naive)), <span class="fu">mean</span>(<span class="fu">abs</span>(percent.error.snaive)))</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>table_3_6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  Method                    MAE  RMSE   MAPE
  &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 Naive Forecast          119.  169.  0.0621
2 Seasonal Naive Forecast  78.5  98.2 0.0391</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="chapter-5---smoothing-methods" class="level1">
<h1>Chapter 5 - Smoothing Methods</h1>
<p>Scripts adapted from <a href="https://www.forecastingbook.com/resources/data-and-code">Practical Time Series Forecasting - Datasets &amp; R Code</a></p>
<section id="moving-average" class="level2">
<h2 class="anchored" data-anchor-id="moving-average">5.2 Moving Average</h2>
<section id="amtrak-fig-5-2.r" class="level3">
<h3 class="anchored" data-anchor-id="amtrak-fig-5-2.r">Amtrak Fig 5-2.R</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>amtrak_csv <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Amtrak data.csv"</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>Amtrak.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(amtrak_csv)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>ridership.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Amtrak.data<span class="sc">$</span>Ridership, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2004</span>, <span class="dv">3</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>ma.trailing <span class="ot">&lt;-</span> <span class="fu">rollmean</span>(ridership.ts, <span class="at">k =</span> <span class="dv">12</span>, <span class="at">align =</span> <span class="st">"right"</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>ma.centered <span class="ot">&lt;-</span> <span class="fu">ma</span>(ridership.ts, <span class="at">order =</span> <span class="dv">12</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 5-2</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridership.ts, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2200</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2004.25</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="fl">2004.25</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="fl">2004.25</span>, <span class="dv">1</span>)))</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ma.centered, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ma.trailing, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">1994</span>,<span class="dv">2200</span>, <span class="fu">c</span>(<span class="st">"Ridership"</span>,<span class="st">"Centered Moving Average"</span>, <span class="st">"Trailing Moving Average"</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">lwd=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">bty =</span> <span class="st">"n"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="amtrak-fig-5-3.r" class="level2">
<h2 class="anchored" data-anchor-id="amtrak-fig-5-3.r">Amtrak Fig 5-3.R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'code'</span>, <span class="st">'ptfs_functions.R'</span>))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>nValid <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> nValid</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain))</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> nValid))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>ma.trailing <span class="ot">&lt;-</span> <span class="fu">rollmean</span>(train.ts, <span class="at">k =</span> <span class="dv">12</span>, <span class="at">align =</span> <span class="st">"right"</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>last.ma <span class="ot">&lt;-</span> <span class="fu">tail</span>(ma.trailing, <span class="dv">1</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>ma.trailing.pred <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">rep</span>(last.ma, nValid), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> nValid), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 5-3</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.ts, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2600</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ma.trailing, <span class="at">lwd =</span> <span class="dv">2</span>) </span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ma.trailing.pred, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>) </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">2500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="differencing" class="level2">
<h2 class="anchored" data-anchor-id="differencing">5.3 Differencing</h2>
<section id="amtrak-fig-5-4.r" class="level3">
<h3 class="anchored" data-anchor-id="amtrak-fig-5-4.r">Amtrak Fig 5-4.R</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 5-4</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridership.ts, <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2004.25</span>), <span class="at">main =</span> <span class="st">"Ridership"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">diff</span>(ridership.ts, <span class="at">lag =</span> <span class="dv">12</span>), <span class="at">ylab =</span> <span class="st">"Lag-12"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2004.25</span>), <span class="at">main =</span> <span class="st">"Lag-12 Difference"</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">diff</span>(ridership.ts, <span class="at">lag =</span> <span class="dv">1</span>), <span class="at">ylab =</span> <span class="st">"Lag-1"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2004.25</span>), <span class="at">main =</span> <span class="st">"Lag-1 Difference"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(ridership.ts, <span class="at">lag =</span> <span class="dv">12</span>), <span class="at">lag =</span> <span class="dv">1</span>), <span class="at">ylab =</span> <span class="st">"Lag-12, then Lag-1"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2004.25</span>), <span class="at">main =</span> <span class="st">"Twice-Differenced (Lag-12, Lag-1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>ridership.deseasonalized <span class="ot">&lt;-</span> <span class="fu">diff</span>(ridership.ts, <span class="at">lag =</span> <span class="dv">12</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">tslm</span>(ridership.deseasonalized <span class="sc">~</span> trend))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
tslm(formula = ridership.deseasonalized ~ trend)

Residuals:
     Min       1Q   Median       3Q      Max 
-241.873  -56.022   -0.219   59.150  284.792 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -40.3641    15.0455  -2.683  0.00815 ** 
trend         0.8294     0.1764   4.702 5.93e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 90.74 on 145 degrees of freedom
Multiple R-squared:  0.1323,    Adjusted R-squared:  0.1263 
F-statistic: 22.11 on 1 and 145 DF,  p-value: 5.935e-06</code></pre>
</div>
</div>
</section>
</section>
<section id="advance-exponential-smoothing" class="level2">
<h2 class="anchored" data-anchor-id="advance-exponential-smoothing">5.5 Advance Exponential Smoothing</h2>
<section id="amtrak-fig-5-5" class="level3">
<h3 class="anchored" data-anchor-id="amtrak-fig-5-5">Amtrak Fig 5-5</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>diff.twice.ts <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">diff</span>(ridership.ts, <span class="at">lag =</span> <span class="dv">12</span>), <span class="at">lag =</span> <span class="dv">1</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>nValid <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(diff.twice.ts) <span class="sc">-</span> nValid</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(diff.twice.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1992</span>, <span class="dv">2</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1992</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(diff.twice.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1992</span>, nTrain <span class="sc">+</span> <span class="dv">2</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1992</span>, nTrain <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> nValid))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>ses <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.ts, <span class="at">model =</span> <span class="st">"ANN"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>ses.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ses, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 5-5</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ses.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">250</span>, <span class="dv">300</span>),  <span class="at">ylab =</span> <span class="st">"Ridership (Twice-Differenced)"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>, <span class="at">flty =</span> <span class="dv">2</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ses.pred<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">275</span>, <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="table-5.1" class="level3">
<h3 class="anchored" data-anchor-id="table-5.1">Table 5.1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 5.1</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>ses.opt <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.ts, <span class="at">model =</span> <span class="st">"ANN"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>ses.opt.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ses.opt, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>ses.opt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,N,N) 

Call:
 ets(y = train.ts, model = "ANN") 

  Smoothing parameters:
    alpha = 1e-04 

  Initial states:
    l = 1.4679 

  sigma:  83.5845

     AIC     AICc      BIC 
1494.723 1494.950 1502.825 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(ses.pred, valid.ts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     ME     RMSE      MAE       MPE     MAPE      MASE
Training set -0.9407425 90.82254 68.01782 181.35457 225.2854 0.6669040
Test set      5.7226043 75.99033 54.88964  55.92139 178.3106 0.5381843
                   ACF1 Theil's U
Training set -0.3678952        NA
Test set     -0.3665235     1.113</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(ses.opt.pred, valid.ts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     ME     RMSE      MAE      MPE     MAPE      MASE
Training set  0.1883115 82.82115 62.90072 100.5062 105.4250 0.6167316
Test set     -2.0924502 75.80343 53.05667 110.2116 110.2116 0.5202123
                   ACF1 Theil's U
Training set -0.3398587        NA
Test set     -0.3665235 0.9662741</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Miscellaneous calculations below.</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>ar1 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train.ts)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>ar1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: train.ts 
ARIMA(1,0,1)(0,0,1)[12] with non-zero mean 

Coefficients:
         ar1      ma1     sma1    mean
      0.3850  -0.8181  -0.7545  1.3775
s.e.  0.1529   0.1032   0.1100  0.7093

sigma^2 = 3894:  log likelihood = -614.1
AIC=1238.2   AICc=1238.78   BIC=1251.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>arima.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ar1, <span class="at">h =</span> nValid)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>diff.once.ts <span class="ot">&lt;-</span> <span class="fu">diff</span>(ridership.ts, <span class="at">lag =</span> <span class="dv">12</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>diff.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Time"</span> <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">time</span>(ridership.ts)), <span class="st">"None"</span> <span class="ot">=</span> <span class="fu">as.vector</span>(ridership.ts), <span class="st">"Once"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">12</span>), <span class="fu">as.vector</span>(diff.once.ts)), <span class="st">"Twice"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">13</span>), <span class="fu">as.vector</span>(diff.twice.ts)), <span class="st">"Pred"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> nValid), <span class="fu">as.vector</span>(ses.pred<span class="sc">$</span>mean)))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>rts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain))</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>rets <span class="ot">&lt;-</span> <span class="fu">ets</span>(rts)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>rets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,N,A) 

Call:
 ets(y = rts) 

  Smoothing parameters:
    alpha = 0.5157 
    gamma = 8e-04 

  Initial states:
    l = 1813.5087 
    s = 28.527 -16.1115 -3.9429 -121.4959 203.2382 154.7662
           30.7515 74.6798 50.5657 44.6936 -250.4517 -195.2199

  sigma:  0.0352

     AIC     AICc      BIC 
1437.993 1443.100 1478.500 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>rets.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(rets, <span class="at">h =</span> nValid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rets.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="figure-5.6" class="level3">
<h3 class="anchored" data-anchor-id="figure-5.6">Figure 5.6</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>ridership.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Amtrak.data<span class="sc">$</span>Ridership, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2004</span>, <span class="dv">3</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>nValid <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> nValid</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> nValid))</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>hwin <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.ts, <span class="at">model =</span> <span class="st">"MAA"</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>hwin.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(hwin, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 5.6</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hwin.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2600</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>, <span class="at">flty =</span> <span class="dv">2</span>)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(hwin.pred<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts)</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="table-5.2" class="level3">
<h3 class="anchored" data-anchor-id="table-5.2">Table 5.2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 5.2</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>hwin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,A,A) 

Call:
 ets(y = train.ts, model = "MAA") 

  Smoothing parameters:
    alpha = 0.5518 
    beta  = 1e-04 
    gamma = 1e-04 

  Initial states:
    l = 1838.577 
    b = 0.8081 
    s = 28.4454 -11.2187 -0.5337 -124.2766 200.1969 146.8103
           36.5908 76.044 60.153 44.1791 -249.4682 -206.9221

  sigma:  0.0342

     AIC     AICc      BIC 
1617.596 1623.424 1665.403 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>hwin<span class="sc">$</span>states[<span class="dv">1</span>, ]  <span class="co"># Initial states</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           l            b           s1           s2           s3           s4 
1838.5770301    0.8081064   28.4453626  -11.2186753   -0.5336870 -124.2766167 
          s5           s6           s7           s8           s9          s10 
 200.1968557  146.8102880   36.5907511   76.0439635   60.1530346   44.1790580 
         s11          s12 
-249.4681974 -206.9221371 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>hwin<span class="sc">$</span>states[<span class="fu">nrow</span>(hwin<span class="sc">$</span>states), ]  <span class="co"># Final states</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           l            b           s1           s2           s3           s4 
1944.5564806    0.8100101   44.1899049 -249.4709519 -206.9249239   28.4436406 
          s5           s6           s7           s8           s9          s10 
 -11.2161757   -0.5324645 -124.2747514  200.1936173  146.8106008   36.5892133 
         s11          s12 
  76.0565944   60.1377124 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#hwin$states</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="summary-of-exponential-smoothing-in-r-using-ets" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-exponential-smoothing-in-r-using-ets">5.6 Summary of Exponential Smoothing in R using <code>ets</code></h2>
<section id="automatic-model-selection-in-ets" class="level3">
<h3 class="anchored" data-anchor-id="automatic-model-selection-in-ets">Automatic Model Selection in <code>ets</code></h3>
</section>
<section id="table-5.4" class="level3">
<h3 class="anchored" data-anchor-id="table-5.4">Table 5.4</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 5.4</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>ets.opt <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.ts, <span class="at">restrict =</span> <span class="cn">FALSE</span>, <span class="at">allow.multiplicative.trend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>ets.opt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,N,A) 

Call:
 ets(y = train.ts, restrict = FALSE, allow.multiplicative.trend = TRUE) 

  Smoothing parameters:
    alpha = 0.555 
    gamma = 1e-04 

  Initial states:
    l = 1807.9214 
    s = 27.0154 -11.2593 0.0101 -121.9422 199.759 149.5166
           37.7252 75.4579 59.7349 47.1898 -252.1883 -211.019

  sigma:  0.0342

     AIC     AICc      BIC 
1615.746 1620.232 1657.929 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>ets.opt.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ets.opt, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ets.opt.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="table-5.5" class="level3">
<h3 class="anchored" data-anchor-id="table-5.5">Table 5.5</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 5.5</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(hwin.pred, valid.ts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     ME     RMSE      MAE         MPE     MAPE      MASE
Training set  0.1382018 56.49150 45.22527 -0.07920944 2.579613 0.5482385
Test set     33.6684422 76.65107 62.16977  1.58152634 3.122042 0.7536464
                   ACF1 Theil's U
Training set 0.06063493        NA
Test set     0.61655528 0.4430438</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(ets.opt.pred, valid.ts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   ME     RMSE      MAE        MPE     MAPE      MASE
Training set  1.98570 56.86248 45.21332 0.02883941 2.576978 0.5480937
Test set     49.72735 88.62810 73.96379 2.39118826 3.707185 0.8966182
                   ACF1 Theil's U
Training set 0.06113138        NA
Test set     0.65425349 0.5135193</code></pre>
</div>
</div>
</section>
</section>
<section id="extensions-of-exponential-smoothing" class="level2">
<h2 class="anchored" data-anchor-id="extensions-of-exponential-smoothing">5.7 Extensions of Exponential Smoothing</h2>
<section id="figure-5.7" class="level3">
<h3 class="anchored" data-anchor-id="figure-5.7">Figure 5.7</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(forecast)</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(lubridate))</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>bike_hourly_csv <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>, <span class="st">"BikeSharingHourly.csv"</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>bike.hourly.df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(bike_hourly_csv)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>nTotal <span class="ot">&lt;-</span> <span class="fu">length</span>(bike.hourly.df<span class="sc">$</span>cnt[<span class="dv">13004</span><span class="sc">:</span><span class="dv">13747</span>])  <span class="co"># 31 days * 24 hours/day = 744 hours</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>bike.hourly.msts <span class="ot">&lt;-</span> <span class="fu">msts</span>(bike.hourly.df<span class="sc">$</span>cnt[<span class="dv">13004</span><span class="sc">:</span><span class="dv">13747</span>], <span class="at">seasonal.periods =</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">168</span>), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>nTrain <span class="ot">&lt;-</span> <span class="dv">21</span> <span class="sc">*</span> <span class="dv">24</span>  <span class="co"># 21 days of hourly data</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>nValid <span class="ot">&lt;-</span> nTotal <span class="sc">-</span> nTrain  <span class="co"># 10 days of hourly data</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>yTrain.msts <span class="ot">&lt;-</span> <span class="fu">window</span>(bike.hourly.msts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">0</span>, nTrain))</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>yValid.msts <span class="ot">&lt;-</span> <span class="fu">window</span>(bike.hourly.msts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">0</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">0</span>, nTotal))</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>bike.hourly.dshw.pred <span class="ot">&lt;-</span> <span class="fu">dshw</span>(yTrain.msts, <span class="at">h =</span> nValid)</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>bike.hourly.dshw.pred.mean <span class="ot">&lt;-</span> <span class="fu">msts</span>(bike.hourly.dshw.pred<span class="sc">$</span>mean, <span class="at">seasonal.periods =</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">168</span>), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">0</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yTrain.msts, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">7</span>), <span class="at">ylab =</span> <span class="st">"Hourly Bike Rentals"</span>)</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(bike.hourly.dshw.pred.mean, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Practical-Time-Series-Forecasting---Figures-and-Tables_cache/html/unnamed-chunk-52_c730bb2f2d889c499f3fab09ebd3d8b3">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to stlm and tbats.</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>bike.hourly.stlm <span class="ot">&lt;-</span> <span class="fu">stlm</span>(yTrain.msts, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>bike.hourly.stlm.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(bike.hourly.stlm, <span class="at">h =</span> nValid)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>bike.hourly.tbats <span class="ot">&lt;-</span> <span class="fu">tbats</span>(yTrain.msts)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>bike.hourly.tbats.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(bike.hourly.tbats, <span class="at">h =</span> nValid) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Practical-Time-Series-Forecasting---Figures-and-Tables_cache/html/unnamed-chunk-53_8249b07ba0f4b3187a60753b63ed4bd9">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#par(mfrow = c(1, 3))</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yTrain.msts, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">7</span>), <span class="at">ylab =</span> <span class="st">"Hourly Bike Rentals"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>))</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(bike.hourly.dshw.pred.mean, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike.hourly.stlm.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>))</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike.hourly.tbats.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="figure-5.8" class="level3">
<h3 class="anchored" data-anchor-id="figure-5.8">Figure 5.8</h3>
<div class="cell" data-hash="Practical-Time-Series-Forecasting---Figures-and-Tables_cache/html/unnamed-chunk-54_2ae20937b636dd3f173b5d47846a59a2">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(forecast)</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>bike_daily_csv <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BikeSharingDaily.csv"</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>bike.daily.df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(bike_daily_csv)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>bike.daily.msts <span class="ot">&lt;-</span> <span class="fu">msts</span>(bike.daily.df<span class="sc">$</span>cnt, <span class="at">seasonal.periods =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="fl">365.25</span>))</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>bike.daily.tbats <span class="ot">&lt;-</span> <span class="fu">tbats</span>(bike.daily.msts)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>bike.daily.tbats.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(bike.daily.tbats, <span class="at">h =</span> <span class="dv">365</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>bike.daily.stlm <span class="ot">&lt;-</span> <span class="fu">stlm</span>(bike.daily.msts, <span class="at">s.window =</span> <span class="st">"periodic"</span>, <span class="at">method =</span> <span class="st">'ets'</span>)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>bike.daily.stlm.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(bike.daily.stlm, <span class="at">h =</span> <span class="dv">365</span>)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike.daily.tbats.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">9000</span>), <span class="at">xlab =</span> <span class="st">"Year"</span>, <span class="at">ylab =</span> <span class="st">"Daily Bike Rentals"</span>,<span class="at">main =</span> <span class="st">"TBATS"</span>)</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike.daily.stlm.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">9000</span>), <span class="at">xlab =</span> <span class="st">"Year"</span>, <span class="at">ylab =</span> <span class="st">"Daily Bike Rentals"</span>,<span class="at">main =</span> <span class="st">"STL + ETS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note … this code for <code>stlm</code> doesn’t appear to be adding the <code>Level</code> back to the forecast appropriately.</p>
</section>
</section>
</section>
<section id="chapter-6---regression-based-models-capturing-trend-and-seasonality" class="level1">
<h1>Chapter 6 - Regression-Based Models: Capturing Trend and Seasonality</h1>
<p>Scripts adapted from <a href="https://www.forecastingbook.com/resources/data-and-code">Practical Time Series Forecasting - Datasets &amp; R Code</a></p>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
</section>
<section id="model-with-trend" class="level2">
<h2 class="anchored" data-anchor-id="model-with-trend">6.1 Model with Trend</h2>
<section id="figure-6.2" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.2">Figure 6.2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'code'</span>, <span class="st">'ptfs_functions.R'</span>))</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>amtrak_csv <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Amtrak data.csv"</span>)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>Amtrak.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(amtrak_csv)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>ridership.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Amtrak.data<span class="sc">$</span>Ridership, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2004</span>, <span class="dv">3</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>nValid <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> nValid</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain))</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> nValid))</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>train.lm <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train.ts <span class="sc">~</span> trend)</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 6.2</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.ts, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2300</span>), <span class="at">bty =</span> <span class="st">"l"</span>)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.lm<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="figure-6.3" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.3">Figure 6.3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>train.lm.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(train.lm, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.lm.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2600</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>, <span class="at">flty =</span> <span class="dv">2</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.lm.pred<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>) </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">2500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="table-6.1" class="level3">
<h3 class="anchored" data-anchor-id="table-6.1">Table 6.1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 6.1</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train.lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
tslm(formula = train.ts ~ trend)

Residuals:
    Min      1Q  Median      3Q     Max 
-411.29 -114.02   16.06  129.28  306.35 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1750.3595    29.0729  60.206   &lt;2e-16 ***
trend          0.3514     0.4069   0.864     0.39    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 160.2 on 121 degrees of freedom
Multiple R-squared:  0.006125,  Adjusted R-squared:  -0.002089 
F-statistic: 0.7456 on 1 and 121 DF,  p-value: 0.3896</code></pre>
</div>
</div>
</section>
<section id="figure-6.4" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.4">Figure 6.4</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>train.lm.expo.trend <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train.ts <span class="sc">~</span> trend, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>train.lm.expo.trend.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(train.lm.expo.trend, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>train.lm.linear.trend <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train.ts <span class="sc">~</span> trend, <span class="at">lambda =</span> <span class="dv">1</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>train.lm.linear.trend.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(train.lm.linear.trend, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Figures 6-3/6-4</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.lm.expo.trend.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2600</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>, <span class="at">flty =</span> <span class="dv">2</span>)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.lm.expo.trend.pred<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)  <span class="co"># Added in 6-4</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.lm.linear.trend.pred<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.lm.linear.trend.pred<span class="sc">$</span>mean, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">2500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="table-6.2" class="level3">
<h3 class="anchored" data-anchor-id="table-6.2">Table 6.2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>train.lm.poly.trend <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train.ts <span class="sc">~</span> trend <span class="sc">+</span> <span class="fu">I</span>(trend<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train.lm.poly.trend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
tslm(formula = train.ts ~ trend + I(trend^2))

Residuals:
    Min      1Q  Median      3Q     Max 
-344.79 -101.86   40.89   98.54  279.81 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1888.88401   40.91521  46.166  &lt; 2e-16 ***
trend         -6.29780    1.52327  -4.134 6.63e-05 ***
I(trend^2)     0.05362    0.01190   4.506 1.55e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 148.8 on 120 degrees of freedom
Multiple R-squared:  0.1499,    Adjusted R-squared:  0.1358 
F-statistic: 10.58 on 2 and 120 DF,  p-value: 5.844e-05</code></pre>
</div>
</div>
</section>
</section>
<section id="model-with-seasonality" class="level2">
<h2 class="anchored" data-anchor-id="model-with-seasonality">6.2 Model with Seasonality</h2>
<section id="table-6.3" class="level3">
<h3 class="anchored" data-anchor-id="table-6.3">Table 6.3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 6.3</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>train.lm.season <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train.ts <span class="sc">~</span> season)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train.lm.season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
tslm(formula = train.ts ~ season)

Residuals:
     Min       1Q   Median       3Q      Max 
-276.165  -52.934    5.868   54.544  215.081 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1573.97      30.58  51.475  &lt; 2e-16 ***
season2       -42.93      43.24  -0.993   0.3230    
season3       260.77      43.24   6.030 2.19e-08 ***
season4       245.09      44.31   5.531 2.14e-07 ***
season5       278.22      44.31   6.279 6.81e-09 ***
season6       233.46      44.31   5.269 6.82e-07 ***
season7       345.33      44.31   7.793 3.79e-12 ***
season8       396.66      44.31   8.952 9.19e-15 ***
season9        75.76      44.31   1.710   0.0901 .  
season10      200.61      44.31   4.527 1.51e-05 ***
season11      192.36      44.31   4.341 3.14e-05 ***
season12      230.42      44.31   5.200 9.18e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 101.4 on 111 degrees of freedom
Multiple R-squared:  0.6348,    Adjusted R-squared:  0.5986 
F-statistic: 17.54 on 11 and 111 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>train.lm.season.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(train.lm.season, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="figure-6.6" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.6">Figure 6.6</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 6-6</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.lm.season.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2625</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>, <span class="at">flty =</span> <span class="dv">2</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.lm.season.pred<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">2500</span>)</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.lm.season.pred<span class="sc">$</span>residuals, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">400</span>, <span class="dv">550</span>),  <span class="at">ylab =</span> <span class="st">"Residuals"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.ts <span class="sc">-</span> train.lm.season.pred<span class="sc">$</span>fitted)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts <span class="sc">-</span> train.lm.season.pred<span class="sc">$</span>mean)</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="model-with-trend-and-seasonality" class="level2">
<h2 class="anchored" data-anchor-id="model-with-trend-and-seasonality">6.3 Model with Trend and Seasonality</h2>
<section id="table-6.4" class="level3">
<h3 class="anchored" data-anchor-id="table-6.4">Table 6.4</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>train.lm.trend.season <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train.ts <span class="sc">~</span> trend <span class="sc">+</span> <span class="fu">I</span>(trend<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> season)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>train.lm.trend.season.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(train.lm.trend.season, <span class="at">h =</span> nValid, <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 6-4</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train.lm.trend.season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
tslm(formula = train.ts ~ trend + I(trend^2) + season)

Residuals:
     Min       1Q   Median       3Q      Max 
-213.775  -39.363    9.711   42.422  152.187 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.697e+03  2.768e+01  61.318  &lt; 2e-16 ***
trend       -7.156e+00  7.293e-01  -9.812  &lt; 2e-16 ***
I(trend^2)   6.074e-02  5.698e-03  10.660  &lt; 2e-16 ***
season2     -4.325e+01  3.024e+01  -1.430  0.15556    
season3      2.600e+02  3.024e+01   8.598 6.60e-14 ***
season4      2.606e+02  3.102e+01   8.401 1.83e-13 ***
season5      2.938e+02  3.102e+01   9.471 6.89e-16 ***
season6      2.490e+02  3.102e+01   8.026 1.26e-12 ***
season7      3.606e+02  3.102e+01  11.626  &lt; 2e-16 ***
season8      4.117e+02  3.102e+01  13.270  &lt; 2e-16 ***
season9      9.032e+01  3.102e+01   2.911  0.00437 ** 
season10     2.146e+02  3.102e+01   6.917 3.29e-10 ***
season11     2.057e+02  3.103e+01   6.629 1.34e-09 ***
season12     2.429e+02  3.103e+01   7.829 3.44e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 70.92 on 109 degrees of freedom
Multiple R-squared:  0.8246,    Adjusted R-squared:  0.8037 
F-statistic: 39.42 on 13 and 109 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="figure-6.7" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.7">Figure 6.7</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 6-7</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.lm.trend.season.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">2625</span>),  <span class="at">ylab =</span> <span class="st">"Ridership"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>, <span class="at">flty =</span> <span class="dv">2</span>)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.lm.trend.season.pred<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">2500</span>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.lm.trend.season.pred<span class="sc">$</span>residuals, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">400</span>, <span class="dv">550</span>),  <span class="at">ylab =</span> <span class="st">"Residuals"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.ts <span class="sc">-</span> train.lm.trend.season.pred<span class="sc">$</span>fitted)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(valid.ts <span class="sc">-</span> train.lm.trend.season.pred<span class="sc">$</span>mean)</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="chapter-7---regression-based-models-autocorrelation-external-information" class="level1">
<h1>Chapter 7 - Regression-Based Models: Autocorrelation &amp; External Information</h1>
<p>Scripts adapted from <a href="https://www.forecastingbook.com/resources/data-and-code">Practical Time Series Forecasting - Datasets &amp; R Code</a></p>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
</section>
<section id="autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="autocorrelation">7.1 Autocorrelation</h2>
<section id="figure-7.2" class="level3">
<h3 class="anchored" data-anchor-id="figure-7.2">Figure 7.2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'code'</span>, <span class="st">'ptfs_functions.R'</span>))</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>amtrak_csv <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Amtrak data.csv"</span>)</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>Amtrak.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(amtrak_csv)</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>ridership.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Amtrak.data<span class="sc">$</span>Ridership, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2004</span>, <span class="dv">3</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>ridership.<span class="fl">24.</span>ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">24</span>))</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 7-2</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(ridership.<span class="fl">24.</span>ts, <span class="at">lag.max =</span> <span class="dv">12</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="figure-7.3" class="level3">
<h3 class="anchored" data-anchor-id="figure-7.3">Figure 7.3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>nValid <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>nTrain <span class="ot">&lt;-</span> <span class="fu">length</span>(ridership.ts) <span class="sc">-</span> nValid</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>train.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain))</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>valid.ts <span class="ot">&lt;-</span> <span class="fu">window</span>(ridership.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1991</span>, nTrain <span class="sc">+</span> nValid))</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>train.lm.trend.season <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train.ts <span class="sc">~</span> trend <span class="sc">+</span> <span class="fu">I</span>(trend<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> season)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 7-3</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(train.lm.trend.season<span class="sc">$</span>residuals, <span class="at">lag.max =</span> <span class="dv">12</span>, <span class="at">main =</span> <span class="st">""</span>)<span class="sc">$</span>acf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

            [,1]
 [1,] 1.00000000
 [2,] 0.60405883
 [3,] 0.44983171
 [4,] 0.33730830
 [5,] 0.25329034
 [6,] 0.21565844
 [7,] 0.15901326
 [8,] 0.17676683
 [9,] 0.17553762
[10,] 0.17140882
[11,] 0.10739472
[12,] 0.11976519
[13,] 0.08512942</code></pre>
</div>
</div>
</section>
</section>
<section id="improving-forecasts-by-capturing-autocorrelation-ar-and-arima-models" class="level2">
<h2 class="anchored" data-anchor-id="improving-forecasts-by-capturing-autocorrelation-ar-and-arima-models">7.2 Improving Forecasts by Capturing Autocorrelation: AR and ARIMA Models</h2>
<section id="figure-7.4" class="level3">
<h3 class="anchored" data-anchor-id="figure-7.4">Figure 7.4</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>train.res.arima <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train.lm.trend.season<span class="sc">$</span>residuals, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>train.res.arima.pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(train.res.arima, <span class="at">h =</span> nValid)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 7-4</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train.lm.trend.season<span class="sc">$</span>residuals, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">250</span>, <span class="dv">250</span>),  <span class="at">ylab =</span> <span class="st">"Residuals"</span>, </span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="fl">2006.25</span>), <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">2006</span>, <span class="dv">1</span>)))</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(train.res.arima.pred<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="fu">amtrak_ts_annotations</span>(<span class="dv">225</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train.res.arima)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: train.lm.trend.season$residuals 
ARIMA(1,0,0) with non-zero mean 

Coefficients:
         ar1     mean
      0.5998   0.3728
s.e.  0.0712  11.8408

sigma^2 = 2876:  log likelihood = -663.54
AIC=1333.08   AICc=1333.29   BIC=1341.52

Training set error measures:
                     ME     RMSE     MAE      MPE     MAPE      MASE
Training set -0.1223159 53.19141 39.8277 103.3885 175.2219 0.5721356
                    ACF1
Training set -0.07509305</code></pre>
</div>
</div>
</section>
<section id="figure-7.5" class="level3">
<h3 class="anchored" data-anchor-id="figure-7.5">Figure 7.5</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 7-5</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(train.res.arima<span class="sc">$</span>residuals, <span class="at">lag.max =</span> <span class="dv">12</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="table-7.2" class="level3">
<h3 class="anchored" data-anchor-id="table-7.2">Table 7.2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>bike_daily_csv <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BikeSharingDaily.csv"</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>bike.df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(bike_daily_csv)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>bike.df<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(bike.df<span class="sc">$</span>dteday, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>bike.df<span class="sc">$</span>Month <span class="ot">&lt;-</span> <span class="fu">month</span>(bike.df<span class="sc">$</span>Date, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>bike.df<span class="sc">$</span>DOW <span class="ot">&lt;-</span> <span class="fu">wday</span>(bike.df<span class="sc">$</span>Date, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>bike.df<span class="sc">$</span>WorkingDay <span class="ot">&lt;-</span> <span class="fu">factor</span>(bike.df<span class="sc">$</span>workingday, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Not_Working"</span>, <span class="st">"Working"</span>))</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>bike.df<span class="sc">$</span>Weather <span class="ot">&lt;-</span> <span class="fu">factor</span>(bike.df<span class="sc">$</span>weathersit, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Clear"</span>, <span class="st">"Mist"</span>, <span class="st">"Rain_Snow"</span>))</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dummy variables.</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>Month.dummies <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Month, <span class="at">data =</span> bike.df)</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>DOW.dummies <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> DOW, <span class="at">data =</span> bike.df)</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>WorkingDay_Weather.dummies <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> WorkingDay<span class="sc">:</span>Weather, <span class="at">data =</span> bike.df)</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the names of the dummy variables.</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Month.dummies) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Month"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(Month.dummies))</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(DOW.dummies) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"DOW"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(DOW.dummies))</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WorkingDay_Weather.dummies) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"WorkingDay"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(WorkingDay_Weather.dummies))</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WorkingDay_Weather.dummies) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Weather"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(WorkingDay_Weather.dummies))</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WorkingDay_Weather.dummies) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">":"</span>, <span class="st">"_"</span>, <span class="fu">colnames</span>(WorkingDay_Weather.dummies))</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up training and validation sets.</span></span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Month.dummies[, <span class="sc">-</span><span class="dv">12</span>], DOW.dummies[, <span class="sc">-</span><span class="dv">7</span>], WorkingDay_Weather.dummies[, <span class="sc">-</span><span class="dv">6</span>]))</span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> bike.df<span class="sc">$</span>cnt</span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>nTotal <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>nValid <span class="ot">&lt;-</span> <span class="dv">90</span></span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>nTrain <span class="ot">&lt;-</span> nTotal <span class="sc">-</span> nValid</span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>xTrain <span class="ot">&lt;-</span> x[<span class="dv">1</span><span class="sc">:</span>nTrain, ]</span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>yTrain <span class="ot">&lt;-</span> y[<span class="dv">1</span><span class="sc">:</span>nTrain]</span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>xValid <span class="ot">&lt;-</span> x[(nTrain <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>nTotal, ]</span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>yValid <span class="ot">&lt;-</span> y[(nTrain <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>nTotal]</span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit tslm.</span></span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>yTrain.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(yTrain)</span>
<span id="cb112-35"><a href="#cb112-35" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"yTrain.ts"</span>, <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">"trend"</span>, <span class="fu">colnames</span>(xTrain)), <span class="at">collapse =</span> <span class="st">"+"</span>), <span class="at">sep =</span> <span class="st">"~"</span>))</span>
<span id="cb112-36"><a href="#cb112-36" aria-hidden="true" tabindex="-1"></a>bike.tslm <span class="ot">&lt;-</span> <span class="fu">tslm</span>(formula, <span class="at">data =</span> xTrain, <span class="at">lambda =</span> <span class="dv">1</span>)</span>
<span id="cb112-37"><a href="#cb112-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-38"><a href="#cb112-38" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>, <span class="at">digits =</span> <span class="dv">6</span>)</span>
<span id="cb112-39"><a href="#cb112-39" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bike.tslm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
tslm(formula = formula, data = xTrain, lambda = 1)

Residuals:
   Min     1Q Median     3Q    Max 
 -3197   -390     47    450   3743 

Coefficients:
                      Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)            -483.43     330.21   -1.46               0.1437    
trend                     6.28       0.18   34.84 &lt; 0.0000000000000002 ***
Jan                     296.66     172.94    1.72               0.0868 .  
Feb                     542.60     174.94    3.10               0.0020 ** 
Mar                    1423.11     171.91    8.28  0.00000000000000078 ***
Apr                    2075.00     172.88   12.00 &lt; 0.0000000000000002 ***
May                    2682.19     171.03   15.68 &lt; 0.0000000000000002 ***
Jun                    2780.76     171.95   16.17 &lt; 0.0000000000000002 ***
Jul                    2406.31     171.51   14.03 &lt; 0.0000000000000002 ***
Aug                    2322.29     172.12   13.49 &lt; 0.0000000000000002 ***
Sep                    2418.41     172.19   14.04 &lt; 0.0000000000000002 ***
Oct                    1715.85     194.09    8.84 &lt; 0.0000000000000002 ***
Nov                     833.77     198.45    4.20  0.00003043204899398 ***
Sun                    -364.19     114.82   -3.17               0.0016 ** 
Mon                    -632.85     207.41   -3.05               0.0024 ** 
Tue                    -492.70     231.53   -2.13               0.0337 *  
Wed                    -495.55     229.81   -2.16               0.0314 *  
Thu                    -422.88     229.57   -1.84               0.0659 .  
Fri                    -413.30     227.78   -1.81               0.0701 .  
Not_Working_Clear      1492.13     293.09    5.09  0.00000047346122692 ***
Working_Clear          1969.21     219.67    8.96 &lt; 0.0000000000000002 ***
Not_Working_Mist        971.77     306.89    3.17               0.0016 ** 
Working_Mist           1279.92     222.83    5.74  0.00000001452898551 ***
Not_Working_Rain_Snow -1728.35     461.55   -3.74               0.0002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 773 on 617 degrees of freedom
Multiple R-squared:  0.844, Adjusted R-squared:  0.838 
F-statistic:  145 on 23 and 617 DF,  p-value: &lt;0.0000000000000002</code></pre>
</div>
</div>
</section>
<section id="figure-7.6" class="level3">
<h3 class="anchored" data-anchor-id="figure-7.6">Figure 7.6</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make tslm forecasts.</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>bike.tslm.pred <span class="ot">&lt;-</span>  <span class="fu">forecast</span>(bike.tslm, <span class="at">newdata =</span> xValid)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike.tslm.pred, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">9000</span>), <span class="at">xlab =</span> <span class="st">"Days"</span>, <span class="at">ylab =</span> <span class="st">"Daily Bike Rentals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="walmart-store-data" class="level3">
<h3 class="anchored" data-anchor-id="walmart-store-data">Walmart Store Data</h3>
<p>Figure 7.7 and 7.8 use data from https://www.kaggle.com/competitions/walmart-recruiting-store-sales-forecasting/data. The dataset is not included here as it would violate the terms of use.</p>
</section>
</section>
</section>
<section id="chapter-8---forecasting-binary-outcomes" class="level1">
<h1>Chapter 8 - Forecasting Binary Outcomes</h1>
<p>Scripts adapted from <a href="https://www.forecastingbook.com/resources/data-and-code">Practical Time Series Forecasting - Datasets &amp; R Code</a></p>
<section id="example-rainfall-in-melbourne-australia" class="level2">
<h2 class="anchored" data-anchor-id="example-rainfall-in-melbourne-australia">8.4 Example: Rainfall in Melbourne, Australia</h2>
<section id="figure-8.1" class="level3">
<h3 class="anchored" data-anchor-id="figure-8.1">Figure 8.1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>rain_xls <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"MelbourneRainfall.xls"</span>)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>rain.df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(rain_xls)</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rain.df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Date"</span>, <span class="st">"Rainfall"</span>)</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>rain_year <span class="ot">&lt;-</span> rain.df <span class="sc">%&gt;%</span> </span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rainy =</span> <span class="fu">ifelse</span>(Rainfall <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as_factor</span>(<span class="fu">month</span>(Date)),</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">year</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Month, Year) <span class="sc">%&gt;%</span> </span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p_rain =</span> <span class="fu">sum</span>(Rainy) <span class="sc">/</span> <span class="fu">n</span>()) </span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>rain_all <span class="ot">&lt;-</span> rain_year <span class="sc">%&gt;%</span> </span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span> </span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">p_rain =</span> <span class="fu">mean</span>(p_rain))</span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>rain_year <span class="sc">%&gt;%</span> </span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Month, p_rain)) <span class="sc">+</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> Year)) <span class="sc">+</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> rain_all, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">group =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical-Time-Series-Forecasting---Figures-and-Tables_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="table-8.1" class="level3">
<h3 class="anchored" data-anchor-id="table-8.1">Table 8.1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>rain_xls <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"MelbourneRainfall.xls"</span>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>rain.df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(rain_xls)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rain.df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Date"</span>, <span class="st">"Rainfall"</span>)</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>rain.df<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(rain.df<span class="sc">$</span>Date, <span class="at">format=</span><span class="st">"%m/%d/%Y"</span>)</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>rain.df<span class="sc">$</span>Rainy <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rain.df<span class="sc">$</span>Rainfall <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>nPeriods <span class="ot">&lt;-</span> <span class="fu">length</span>(rain.df<span class="sc">$</span>Rainy)</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>rain.df<span class="sc">$</span>Lag1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>,rain.df<span class="sc">$</span>Rainfall[<span class="dv">1</span><span class="sc">:</span>(nPeriods<span class="dv">-1</span>)])</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>rain.df<span class="sc">$</span>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, nPeriods, <span class="dv">1</span>)</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>rain.df<span class="sc">$</span>Seasonal_sine <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> rain.df<span class="sc">$</span>t <span class="sc">/</span> <span class="fl">365.25</span>)</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>rain.df<span class="sc">$</span>Seasonal_cosine <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> rain.df<span class="sc">$</span>t <span class="sc">/</span> <span class="fl">365.25</span>)</span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>train.df <span class="ot">&lt;-</span> rain.df[rain.df<span class="sc">$</span>Date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"12/31/2009"</span>, <span class="at">format=</span><span class="st">"%m/%d/%Y"</span>), ]</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>train.df <span class="ot">&lt;-</span> train.df[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>valid.df <span class="ot">&lt;-</span> rain.df[rain.df<span class="sc">$</span>Date <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"12/31/2009"</span>, <span class="at">format=</span><span class="st">"%m/%d/%Y"</span>), ]</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>xvalid <span class="ot">&lt;-</span> valid.df[, <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>)]</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rain.df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  Date       Rainfall Rainy  Lag1     t Seasonal_sine Seasonal_cosine
  &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;
1 2000-01-01      0.4     1  NA       1        0.0172           1.00 
2 2000-01-02      0       0   0.4     2        0.0344           0.999
3 2000-01-03      0       0   0       3        0.0516           0.999
4 2000-01-04      3.4     1   0       4        0.0688           0.998
5 2000-01-05      1.4     1   3.4     5        0.0859           0.996
6 2000-01-06      0       0   1.4     6        0.103            0.995</code></pre>
</div>
</div>
</section>
<section id="table-8.2" class="level3">
<h3 class="anchored" data-anchor-id="table-8.2">Table 8.2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>rainy.lr <span class="ot">&lt;-</span> <span class="fu">glm</span>(Rainy <span class="sc">~</span> Lag1 <span class="sc">+</span> Seasonal_sine <span class="sc">+</span> Seasonal_cosine, <span class="at">data =</span> train.df, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rainy.lr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Rainy ~ Lag1 + Seasonal_sine + Seasonal_cosine, 
    family = "binomial", data = train.df)

Coefficients:
                Estimate Std. Error z value             Pr(&gt;|z|)    
(Intercept)      -0.7689     0.0386  -19.93 &lt; 0.0000000000000002 ***
Lag1              0.1119     0.0114    9.84 &lt; 0.0000000000000002 ***
Seasonal_sine    -0.2688     0.0505   -5.32     0.00000010128789 ***
Seasonal_cosine  -0.3713     0.0507   -7.33     0.00000000000023 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4751.8  on 3651  degrees of freedom
Residual deviance: 4533.7  on 3648  degrees of freedom
AIC: 4542

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section>
<section id="table-8.3" class="level3">
<h3 class="anchored" data-anchor-id="table-8.3">Table 8.3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>rainy.lr.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rainy.lr, xvalid, <span class="at">type =</span> <span class="st">"response"</span>) </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(rainy.lr<span class="sc">$</span>fitted <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)), </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.factor</span>(train.df<span class="sc">$</span>Rainy), <span class="at">positive=</span><span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 2251 1115
         1  104  182
                                              
               Accuracy : 0.666               
                 95% CI : (0.651, 0.682)      
    No Information Rate : 0.645               
    P-Value [Acc &gt; NIR] : 0.00357             
                                              
                  Kappa : 0.117               
                                              
 Mcnemar's Test P-Value : &lt; 0.0000000000000002
                                              
            Sensitivity : 0.1403              
            Specificity : 0.9558              
         Pos Pred Value : 0.6364              
         Neg Pred Value : 0.6687              
             Prevalence : 0.3551              
         Detection Rate : 0.0498              
   Detection Prevalence : 0.0783              
      Balanced Accuracy : 0.5481              
                                              
       'Positive' Class : 1                   
                                              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(rainy.lr.pred <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)), </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.factor</span>(valid.df<span class="sc">$</span>Rainy), <span class="at">positive=</span><span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 373 220
         1  21  55
                                              
               Accuracy : 0.64                
                 95% CI : (0.602, 0.676)      
    No Information Rate : 0.589               
    P-Value [Acc &gt; NIR] : 0.00404             
                                              
                  Kappa : 0.165               
                                              
 Mcnemar's Test P-Value : &lt; 0.0000000000000002
                                              
            Sensitivity : 0.2000              
            Specificity : 0.9467              
         Pos Pred Value : 0.7237              
         Neg Pred Value : 0.6290              
             Prevalence : 0.4111              
         Detection Rate : 0.0822              
   Detection Prevalence : 0.1136              
      Balanced Accuracy : 0.5734              
                                              
       'Positive' Class : 1                   
                                              </code></pre>
</div>
</div>
</section>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2"></h2>
<p>Reference: <em>Practical Time Series Forecasting with R: A Hands-On Guide</em></p>
<p>by Galit Schmueli</p>
<p>ISBN-10: 0997847921</p>
</section>
<section id="section-3" class="level2">
<h2 class="anchored" data-anchor-id="section-3"></h2>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>